<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857143; overflow-x: hidden; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; tab-size: 4; background-position: inherit; background-repeat: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) { 
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror-linenumber { }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; position: relative !important; background-position: inherit; background-repeat: inherit; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; background-position: 0px 0px; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print { 
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background-color: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-top-left-radius: 10px; border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background-color: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; }
a.md-print-anchor { white-space: pre !important; border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; text-shadow: initial !important; background-position: 0px 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background-color: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print { 
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) { 
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) { 
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.428571429rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: "ï„¥"; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: "ï„£"; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left-width: 28px; border-left-style: solid; border-left-color: transparent; border-right-width: 28px; border-right-style: solid; border-right-color: transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: "ï„£"; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right-width: 8px; border-right-style: solid; border-right-color: transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "âˆ’"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; white-space: nowrap; background-position: inherit; background-repeat: inherit; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; border: none !important; background-position: 0px 0px !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: 0px 0px; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}


 @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}}
</style><title>The_workflow_of_single-cell_data_analysis</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><!-- TOC --><ul><li><p><a href='#å•ç»†èƒæ•°æ®åˆ†æ'><span>å•ç»†èƒæ•°æ®åˆ†æ</span></a></p><ul><li><p><a href='#ä¸Šæ¸¸åˆ†æ'><span>ä¸Šæ¸¸åˆ†æ</span></a></p><ul><li><p><a href='#æ•°æ®ä¸‹è½½'><span>æ•°æ®ä¸‹è½½</span></a></p><ul><li><a href='#è½¯ä»¶ç¯å¢ƒ'><span>è½¯ä»¶ç¯å¢ƒ</span></a></li><li><a href='#ä½¿ç”¨sratoolsä¸­çš„prefetch'><span>ä½¿ç”¨sratoolsä¸­çš„prefetch</span></a></li><li><a href='#åˆ©ç”¨ascpç”±ftpncbiä¸‹è½½æµ‹åºæ•°æ®'><span>åˆ©ç”¨ascpç”±ftp.ncbiä¸‹è½½æµ‹åºæ•°æ®</span></a></li><li><a href='#æå–fastqæ–‡ä»¶'><span>æå–fastqæ–‡ä»¶</span></a></li></ul></li><li><p><a href='#cell-ranger'><span>Cell Ranger</span></a></p><ul><li><a href='#cell-rangerè½¯ä»¶å®‰è£…'><span>Cell Rangerè½¯ä»¶å®‰è£…</span></a></li><li><a href='#å‚è€ƒåŸºå› ç»„åºåˆ—çš„ä¸‹è½½'><span>å‚è€ƒåŸºå› ç»„åºåˆ—çš„ä¸‹è½½</span></a></li><li><a href='#mkfastq-æ‹†åˆ†æ•°æ®'><span>mkfastq æ‹†åˆ†æ•°æ®</span></a></li><li><a href='#count-ç»†èƒå’ŒåŸºå› çš„å®šé‡'><span>ğŸ”ºcount ç»†èƒå’ŒåŸºå› çš„å®šé‡</span></a></li><li><a href='#aggrå¤šä¸ªæ–‡åº“çš„æ•´åˆ'><span>aggrå¤šä¸ªæ–‡åº“çš„æ•´åˆ</span></a></li></ul></li><li><p><a href='#å…³äºä¸Šæ¸¸åˆ†æå¾—åˆ°çš„æ•°æ®é›†'><span>å…³äºä¸Šæ¸¸åˆ†æå¾—åˆ°çš„æ•°æ®é›†</span></a></p></li></ul></li><li><p><a href='#æ•°æ®é¢„å¤„ç†å·¥ä½œæµç¨‹'><span>æ•°æ®é¢„å¤„ç†å·¥ä½œæµç¨‹</span></a></p><ul><li><a href='#qcè´¨é‡æ£€æµ‹'><span>QCè´¨é‡æ£€æµ‹</span></a></li><li><a href='#å½’ä¸€åŒ–æ•°æ®'><span>å½’ä¸€åŒ–æ•°æ®</span></a></li><li><a href='#è¯†åˆ«é«˜å¯å˜åŸºå› '><span>è¯†åˆ«é«˜å¯å˜åŸºå› </span></a></li><li><a href='#æ ‡å‡†åŒ–æ•°æ®'><span>æ ‡å‡†åŒ–æ•°æ®</span></a></li><li><a href='#æ‰§è¡Œçº¿æ€§é™ç»´'><span>æ‰§è¡Œçº¿æ€§é™ç»´</span></a></li><li><a href='#ç¡®å®šæ•°æ®é›†çš„ç»´åº¦'><span>ç¡®å®šæ•°æ®é›†çš„â€œç»´åº¦â€</span></a></li><li><a href='#ç»†èƒå‘¨æœŸè¯„åˆ†å’Œå›å½’é€‰æ‹©'><span>ç»†èƒå‘¨æœŸè¯„åˆ†å’Œå›å½’(é€‰æ‹©)</span></a></li></ul></li><li><p><a href='#æ•´åˆå¤šä¸ªscrna-seqæ•°æ®é›†'><span>æ•´åˆå¤šä¸ªscRNA-seqæ•°æ®é›†</span></a></p><ul><li><a href='#ä¸seuratæ ‡å‡†å¤„ç†æµç¨‹ä¸€è‡´'><span>ä¸seuratæ ‡å‡†å¤„ç†æµç¨‹ä¸€è‡´</span></a></li><li><a href='#ä½¿ç”¨-sctransform-è§„èŒƒåŒ–çš„æ•°æ®é›†æ‰§è¡Œæ•´åˆ'><span>ä½¿ç”¨ SCTransform è§„èŒƒåŒ–çš„æ•°æ®é›†æ‰§è¡Œæ•´åˆ</span></a></li></ul></li><li><p><a href='#å°†-seurat-ä¸å¤šæ¨¡å¼æ•°æ®ä¸€èµ·ä½¿ç”¨'><span>å°† Seurat ä¸å¤šæ¨¡å¼æ•°æ®ä¸€èµ·ä½¿ç”¨</span></a></p></li><li><p><a href='#ä¸‹æ¸¸åˆ†æ'><span>ä¸‹æ¸¸åˆ†æ</span></a></p><ul><li><p><a href='#ç»†èƒæ°´å¹³'><span>ç»†èƒæ°´å¹³</span></a></p><ul><li><p><a href='#ç°‡'><span>ç°‡</span></a></p><ul><li><a href='#èšç±»åˆ†æ'><span>èšç±»åˆ†æ</span></a></li><li><a href='#å¯¹ç°‡è¿›è¡Œç»†èƒç±»å‹æ³¨é‡Š'><span>å¯¹ç°‡è¿›è¡Œç»†èƒç±»å‹æ³¨é‡Š</span></a></li></ul></li><li><p><a href='#æ„å»ºå•ç»†èƒè½¨è¿¹'><span>æ„å»ºå•ç»†èƒè½¨è¿¹</span></a></p></li></ul></li><li><p><a href='#åŸºå› æ°´å¹³'><span>åŸºå› æ°´å¹³</span></a></p><ul><li><p><a href='#åŸºå› çš„å·®å¼‚è¡¨è¾¾åˆ†æ'><span>åŸºå› çš„å·®å¼‚è¡¨è¾¾åˆ†æ</span></a></p><ul><li><a href='#å¯»æ‰¾å·®å¼‚è¡¨è¾¾çš„ç‰¹å¾åŸºå› ç°‡ç”Ÿç‰©æ ‡å¿—ç‰©'><span>å¯»æ‰¾å·®å¼‚è¡¨è¾¾çš„ç‰¹å¾åŸºå› ï¼ˆç°‡ç”Ÿç‰©æ ‡å¿—ç‰©ï¼‰</span></a></li><li><a href='#ä¸ä¼ªæ—¶é—´åˆ†æç›¸å…³çš„å·®å¼‚è¡¨è¾¾åˆ†æ'><span>ä¸ä¼ªæ—¶é—´åˆ†æç›¸å…³çš„å·®å¼‚è¡¨è¾¾åˆ†æ</span></a></li></ul></li><li><p><a href='#åŸºå› é›†åˆ†æ'><span>åŸºå› é›†åˆ†æ</span></a></p><ul><li><a href='#è¡¨è§‚é—ä¼ åˆ†æ'><span>è¡¨è§‚é—ä¼ åˆ†æ</span></a></li><li><a href='#å¯Œé›†åˆ†æ'><span>å¯Œé›†åˆ†æ</span></a></li></ul></li><li><p><a href='#åŸºå› è°ƒæ§ç½‘ç»œåˆ†æ'><span>åŸºå› è°ƒæ§ç½‘ç»œåˆ†æ</span></a></p><ul><li><a href='#åŸºå› å…±è¡¨è¾¾'><span>åŸºå› å…±è¡¨è¾¾</span></a></li><li><a href='#è›‹ç™½è´¨äº’ä½œç½‘ç»œ'><span>è›‹ç™½è´¨äº’ä½œç½‘ç»œ</span></a></li><li><a href='#å›å½’æ¨¡å‹'><span>å›å½’æ¨¡å‹</span></a></li></ul></li></ul></li></ul></li></ul></li></ul><!-- /TOC --><h1 id='å•ç»†èƒæ•°æ®åˆ†æ'><span>å•ç»†èƒæ•°æ®åˆ†æ</span></h1><p><img src="images/2021-10-22-21-29-10.png" referrerpolicy="no-referrer">
<br><span>ä¸€ä¸ªæ²¹æ»´ (GEM)=ä¸€ä¸ªå•ç»†èƒ+ä¸€ä¸ªå‡èƒ¶å¾®ç =ä¸€ä¸ªscRNA-Seqï¼Œå¯ä»¥è¯´è¿™å°±æ˜¯10Xçš„åŸºæœ¬æŠ€æœ¯åŸç†ã€‚</span></p><p><img src="images/2021-10-22-21-37-28.png" referrerpolicy="no-referrer"></p><p><br><span> Gel beadsæ˜¯ç”±å‡èƒ¶ç£ç å’Œç£ç ä¸Šçš„ä¸€æ®µå¼•ç‰©æ„æˆï¼Œå¼•ç‰©åºåˆ—æ„æˆä¾æ¬¡ä¸ºï¼š</span></p><ul><li><span>å…¨é•¿Illumina TruSeq Read 1 æµ‹åºå¼•ç‰©ï¼ˆR1ï¼‰</span></li><li><span>16nt 10X Barcodeåºåˆ—(Barcode)ï¼ˆæ¯ä¸ªGel beadçš„10X Barcodeå‡ä¸ç›¸åŒï¼Œå½¢æˆGEMï¼ˆGel Beads-in-emulsionï¼‰åç”¨äºåŒºåˆ†ç»†èƒï¼‰</span></li><li><span>12 nt unique molecular identifier (UMI) ï¼ˆåŒºåˆ†åŒä¸€ç»†èƒçš„ä¸åŒè½¬å½•æœ¬å¹¶å»é™¤PCR Duplicationsï¼Œå®ç°ç»å¯¹å®šé‡ï¼‰</span></li><li><span>30 nt poly dTåè½¬å½•å¼•ç‰©</span></li></ul><h2 id='ä¸Šæ¸¸åˆ†æ'><span>ä¸Šæ¸¸åˆ†æ</span></h2><p><span>æœ€å¸¸ç”¨ä¸”æœ€å¸¸è§çš„çš„æ•°æ®é›†ä¸»è¦æ¥è‡ª10X Genomicså’ŒSmart-seq2ï¼Œç›®å‰å¤§éƒ¨åˆ†çš„å•ç»†èƒæ•°æ®éƒ½æ¥è‡ª10X Genomicsï¼Œå› æ­¤åç»­çš„æ•°æ®å¤„ç†å’Œåˆ†æä»¥è¿™è¯¥ç±»æ•°æ®ä¸ºä¾‹å­è¿›è¡Œè®²è§£ã€‚</span></p><h3 id='æ•°æ®ä¸‹è½½'><span>æ•°æ®ä¸‹è½½</span></h3><h4 id='è½¯ä»¶ç¯å¢ƒ'><span>è½¯ä»¶ç¯å¢ƒ</span></h4><p><span>åŸå§‹æ•°æ®ä¸€èˆ¬æ˜¯ä»¥SRRæ ¼å¼å­˜æ”¾ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸€èˆ¬éƒ½è¦å‡ ä¸ªGï¼Œäºæ˜¯ä¸‹è½½å™¨é¦–é€‰ascpï¼Œä½†æ˜¯ç›´æ¥ä½¿ç”¨ascpä¸‹è½½åˆéœ€è¦é…ç½®ä¸€äº›å‚æ•°ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œæœ€å¥½æ˜¯èƒ½æä¾›ä¸€ä¸ªIDï¼Œç„¶åç›´æ¥å°±ä¸‹è½½ï¼Œè¿™ä¸ªå°±éœ€è¦ç”¨åˆ°</span><code>prefetch</code><span> ä¸</span><code>ascp</code><span>çš„ç»„åˆäº†ã€‚</span></p><ol start='' ><li><p><span>prefetch</span>
<span>é»˜è®¤æƒ…å†µä¸‹ï¼Œ</span><code>prefetch</code><span>æ˜¯åˆ©ç”¨httpsæ–¹å¼å»ä¸‹è½½åŸå§‹æ•°æ®ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">conda install <span class="cm-attribute">-c</span> daler sratoolkit</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">prefetch <span class="cm-attribute">-h</span> <span class="cm-comment"># å¯ä»¥æ˜¾ç¤ºå¸®åŠ©æ–‡æ¡£å°±è¯´æ˜å®‰è£…æˆåŠŸ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å¦‚æœè¦ä¸‹è½½æ•°æ®æ¯”å¦‚SRRæ–‡ä»¶ï¼Œç›´æ¥åŠ IDå·ï¼ŒæŒ‡å®šè¾“å‡ºç›®å½•å°±å¥½</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">prefetch SRRxxxxxxx <span class="cm-attribute">-O</span> PATH</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre></li><li><p><span>ascp</span>
<code>prefetch</code><span>é€Ÿåº¦æœ‰ä¸€å®šçš„é™åˆ¶ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å…ˆå®‰è£…ä¸€æ¬¾å«åš&quot;aspera&quot;çš„ä¸‹è½½å·¥å…·ï¼Œå®ƒæ˜¯IBMæ——ä¸‹çš„å•†ä¸šé«˜é€Ÿæ–‡ä»¶ä¼ è¾“è½¯ä»¶ï¼Œä¸NCBIå’ŒEBIæœ‰åä½œåˆåŒã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">wget</span> http://download.asperasoft.com/download/sw/connect/3.7.4/aspera-connect-3.7.4.147727-linux-64.tar.gz</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">tar zxvf aspera-connect-3.7.4.147727-linux-64.tar.gz</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#å®‰è£…</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">bash</span> aspera-connect-3.7.4.147727-linux-64.sh</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ç„¶åcdåˆ°æ ¹ç›®å½•ä¸‹çœ‹çœ‹æ˜¯ä¸æ˜¯å­˜åœ¨äº†.asperaæ–‡ä»¶å¤¹ï¼Œæœ‰çš„è¯è¡¨ç¤ºå®‰è£…æˆåŠŸ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> &amp;&amp; <span class="cm-builtin">ls</span> <span class="cm-attribute">-a</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å°†asperaè½¯ä»¶åŠ å…¥ç¯å¢ƒå˜é‡ï¼Œå¹¶æ¿€æ´»</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-string">'export PATH=~/.aspera/connect/bin:$PATH'</span> &gt;&gt; ~/.bashrc</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">source</span> ~/.bashrc</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æœ€åæ£€æŸ¥ascpæ˜¯ä¸æ˜¯èƒ½ç”¨äº†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ascp <span class="cm-attribute">--help</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><p><span>å¦‚æœæŠ¥é”™ï¼š</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>â€‹</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ascp: Failed to open TCP connection <span class="cm-keyword">for</span> SSH, exiting.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Session Stop  (Error: Failed to open TCP connection <span class="cm-keyword">for</span> SSH)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å®˜ç½‘ç»™å‡ºçš„è§£å†³åŠæ³•æ˜¯ï¼šhttps://support.asperasoft.com/hc/en-us/articles/216126918-Error-44-UDP-session-initiation-fatal-error</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">On many Linux systems the default firewall can be configured with iptables. You will have to allow all incoming and outgoing traffic on UDP port <span class="cm-number">33001</span> (or whatever your Aspera UDP port is), which you can <span class="cm-keyword">do</span> with the following commands:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ä½¿ç”¨ä¸‹é¢è¿™ä¸¤ä¸ªå‘½ä»¤(ä½†éœ€è¦ç®¡ç†å‘˜æƒé™)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># iptables -I INPUT -p tcp --dport 33001 -j ACCEPT</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># iptables -I OUTPUT -p tcp --dport 33001 -j ACCEPT</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><h4 id='ä½¿ç”¨sratoolsä¸­çš„prefetch'><span>ä½¿ç”¨sratoolsä¸­çš„prefetch</span></h4><p><span>ä»¥GSE117988çš„æ•°æ®é›†ä¸ºä¾‹ã€‚</span></p><ol start='' ><li><span>æ‰“å¼€</span><a href='https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE117988' target='_blank' class='url'>https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE117988</a></li><li><span>ç‚¹å‡»SRAè¿™é‡Œçš„</span><code>SRP155988</code>
<img src="images/2021-10-22-21-04-05.png" referrerpolicy="no-referrer"></li><li><code>send to</code><span> =&gt; </span><code>Run Selector</code><span> =&gt; </span><code>Go</code><span> </span>
<img src="images/2021-10-22-21-04-47.png" referrerpolicy="no-referrer"></li><li><span>ä¸‹è½½Accession Listï¼Œç„¶åå°±å¾—åˆ°äº†ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œåˆ—å‡ºäº†6ä¸ªSRR IDå·</span>
<img src="images/2021-10-22-21-05-12.png" referrerpolicy="no-referrer"></li><li><span>ä¸‹è½½ä»£ç </span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">wkd</span><span class="cm-operator">=</span>/home/project/single-cell/MCC</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> <span class="cm-def">$wkd</span>/raw</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># for patient 2586-4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cat</span> &gt;SRR_Acc_List-2586-4.txt</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SRR7722937</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SRR7722938</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SRR7722939</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SRR7722940</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SRR7722941</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SRR7722942</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cat</span> SRR_Acc_List-2586-4.txt |while read i</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">do</span> prefetch <span class="cm-def">$i</span> <span class="cm-attribute">-O</span> <span class="cm-quote">`pwd`</span> &amp;&amp; <span class="cm-builtin">echo</span> <span class="cm-string">"** </span><span class="cm-def">${i}</span><span class="cm-string">.sra done **"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">done</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ä¸€èˆ¬2.6Gæ–‡ä»¶ä¸‹è½½2åˆ†é’Ÿå·¦å³</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><h4 id='åˆ©ç”¨ascpç”±ftpncbiä¸‹è½½æµ‹åºæ•°æ®'><span>åˆ©ç”¨ascpç”±ftp.ncbiä¸‹è½½æµ‹åºæ•°æ®</span></h4><ol start='' ><li><span>è¿›å…¥å®˜ç½‘</span><a href='https://www.ebi.ac.uk/ena' target='_blank' class='url'>https://www.ebi.ac.uk/ena</a><span> ï¼Œæœç´¢æƒ³ä¸‹è½½çš„SRAå·</span>
<img src="images/2021-10-22-21-07-38.png" referrerpolicy="no-referrer"></li><li><span>é€‰æ‹©SRRè¿™é‡Œ</span>
<img src="images/2021-10-22-21-07-56.png" referrerpolicy="no-referrer"></li><li><span>EBIå¯ä»¥ç›´æ¥ä¸‹è½½fastqæ ¼å¼æ–‡ä»¶ï¼ˆå·¦è¾¹æ–¹æ¡†ï¼‰ï¼Œå¦‚æœè¦ä¸‹è½½sraå°±å¤åˆ¶å³è¾¹çº¢è‰²æ–¹æ¡†ä¸­é“¾æ¥</span>
<img src="images/2021-10-22-21-08-39.png" referrerpolicy="no-referrer"></li><li><span>ç„¶ååˆ©ç”¨è¿™ä¸ªä»£ç ä¸‹è½½</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ascp <span class="cm-attribute">-QT</span> <span class="cm-attribute">-l</span> 300m <span class="cm-attribute">-P33001</span> <span class="cm-attribute">-i</span> ~/.aspera/connect/etc/asperaweb_id_dsa.openssh era-fasp@fasp.sra.ebi.ac.uk:vol1/srr/SRR772/009/SRR7722939 ./</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><h4 id='æå–fastqæ–‡ä»¶'><span>æå–fastqæ–‡ä»¶</span></h4><p><span>æˆ‘ä»¬ä½¿ç”¨fastq-dumpè¿™æ¬¾è½¯ä»¶ï¼Œå®ƒæ˜¯sra-toolä¸­çš„ä¸€ä¸ªå·¥å…·ï¼Œä½¿ç”¨condaå®‰è£…å³å¯ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">conda install <span class="cm-attribute">-c</span> bioconda sra-tools</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">wkd</span><span class="cm-operator">=</span>/home/project/single-cell/MCC ///è·¯å¾„</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cd</span> <span class="cm-def">$wkd</span>/raw/P2586-4</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cat</span> SRR_Acc_List-2586-4.txt |while read i</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">do</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">time fastq-dump <span class="cm-attribute">--gzip</span> <span class="cm-attribute">--split-files</span> <span class="cm-attribute">-A</span> <span class="cm-def">$i</span> <span class="cm-def">${i}</span>.sra &amp;&amp; <span class="cm-builtin">echo</span> <span class="cm-string">"** </span><span class="cm-def">${i}</span><span class="cm-string">.sra to fastq done **"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">done</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><ul><li><span>--gzipå°†ç”Ÿæˆçš„ç»“æœfastqæ–‡ä»¶è¿›è¡Œå‹ç¼©</span></li><li><span>--split-filesï¼šé¦–å…ˆå®ƒæ˜¯åˆ†å‰²çš„æ„æ€ï¼Œ-3å®é™…ä¸ŠæŒ‡çš„æ˜¯åˆ†æˆ3ä¸ªæ–‡ä»¶ã€‚</span></li><li><span>-AæŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶å</span></li></ul><p><span>æ ¹æ®Cell Rangerè¯´æ˜ä¹¦å¯¹æ‰¹é‡å¤„ç†å¾—åˆ°çš„ä¸‰ä¸ªæ–‡ä»¶æ›´æ”¹åå­—æ–¹ä¾¿åç»­åˆ†æï¼š</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æ¯”å¦‚ï¼Œå°†åŸæ¥çš„SRR7692286_1.fastq.gzæ”¹æˆSRR7692286_S1_L001_I1_001.fastq.gz</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ä¾æ¬¡ç±»æ¨ï¼Œå°†åŸæ¥_2çš„æ”¹æˆR1ï¼Œå°†_3æ”¹æˆR2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">cat</span> SRR_Acc_List-9245-3.txt | <span class="cm-keyword">while</span> read i ;do (mv <span class="cm-def">${i}</span>_1*.gz <span class="cm-def">${i}</span>_S1_L001_I1_001.fastq.gz;mv <span class="cm-def">${i}</span>_2*.gz <span class="cm-def">${i}</span>_S1_L001_R1_001.fastq.gz;mv <span class="cm-def">${i}</span>_3*.gz <span class="cm-def">${i}</span>_S1_L001_R2_001.fastq.gz);done</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><img src="images/2021-10-22-22-00-56.png" referrerpolicy="no-referrer">
<span>å…¶ä¸­ï¼Œ</span><mark><span>I1ä¸ºindexï¼ŒR1æ˜¯barcodeå’ŒUMIï¼ŒR2æ˜¯æµ‹åºreadï¼Œæ˜¯æœ€é•¿çš„ã€‚</span></mark></p><ul><li><p><strong><span>ä¸ºä»€ä¹ˆ10xå•ç»†èƒè½¬å½•ç»„è¡¨è¾¾çŸ©é˜µæœ‰3ä¸ªæ–‡ä»¶</span></strong></p><p><span>å› ä¸º10xå•ç»†èƒè½¬å½•ç»„è¡¨è¾¾çŸ©é˜µé‡Œé¢çš„0å€¼éå¸¸å¤šï¼Œæ‰€ä»¥æ¢æˆ3ä¸ªæ–‡ä»¶å­˜å‚¨æ›´èŠ‚çœç©ºé—´ã€‚</span></p></li></ul><h3 id='cell-ranger'><span>Cell Ranger</span></h3><p><img src="images/2021-10-23-09-25-49.png" referrerpolicy="no-referrer">
<span>å®ƒä¸»è¦åŒ…æ‹¬å››ä¸ªä¸»è¦åŸºå› è¡¨è¾¾åˆ†ææµç¨‹ï¼š</span></p><ul><li><code>mkfastq</code><span> ï¼š å®ƒå€Ÿé‰´äº†Illuminaçš„</span><code>bcl2fastq</code><span> ï¼Œå¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªlaneä¸­çš„æ··æ ·æµ‹åºæ ·æœ¬æŒ‰ç…§indexæ ‡ç­¾ç”Ÿæˆæ ·æœ¬å¯¹åº”çš„fastqæ–‡ä»¶</span></li><li><code>count</code><span>ï¼šåˆ©ç”¨</span><code>mkfastq</code><span>ç”Ÿæˆçš„fqæ–‡ä»¶ï¼Œè¿›è¡Œæ¯”å¯¹(åŸºäºSTAR)ã€è¿‡æ»¤ã€UMIè®¡æ•°ã€‚åˆ©ç”¨ç»†èƒçš„barcodeç”Ÿæˆgene-barcodeçŸ©é˜µï¼Œç„¶åè¿›è¡Œæ ·æœ¬åˆ†ç¾¤ã€åŸºå› è¡¨è¾¾åˆ†æã€‚</span></li><li><code>aggr</code><span> ï¼šæ¥å—cellranger countçš„è¾“å‡ºæ•°æ®ï¼Œå°†åŒä¸€ç»„çš„ä¸åŒæµ‹åºæ ·æœ¬çš„è¡¨è¾¾çŸ©é˜µæ•´åˆåœ¨ä¸€èµ·ï¼Œæ¯”å¦‚tumorç»„åŸæ¥æœ‰4ä¸ªæ ·æœ¬ï¼ŒPBMCç»„æœ‰ä¸¤ä¸ªæ ·æœ¬ï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨aggrç”Ÿæˆæœ€åçš„tumorå’ŒPBMCä¸¤ä¸ªçŸ©é˜µï¼Œå¹¶ä¸”è¿›è¡Œæ ‡å‡†åŒ–å»æ‰æµ‹åºæ·±åº¦çš„å½±å“</span></li><li><code>reanalyze</code><span> ï¼šæ¥å—cellranger </span><code>count</code><span>æˆ–cellranger </span><code>aggr</code><span>ç”Ÿæˆçš„gene-barcodeçŸ©é˜µï¼Œä½¿ç”¨ä¸åŒçš„å‚æ•°è¿›è¡Œé™ç»´ã€èšç±»</span></li></ul><p><span>å®ƒçš„ç»“æœä¸»è¦æ˜¯åŒ…å«æœ‰ç»†èƒä¿¡æ¯çš„BAM, MEX, CSV, HDF5 and HTMLæ–‡ä»¶</span></p><h4 id='cell-rangerè½¯ä»¶å®‰è£…'><span>Cell Rangerè½¯ä»¶å®‰è£…</span></h4><p><span>Cell Rangeré»˜è®¤åœ¨æœ¬åœ°è¿è¡Œ(æˆ–è€…ä½¿ç”¨</span><code>--jobmode=local</code><span>æŒ‡å®š)ï¼Œå®ƒä¼šå ç”¨90%çš„ç©ºä½™å†…å­˜ä»¥åŠæ‰€æœ‰ç©ºä½™çš„CPUã€‚å¦‚æœè¦è¿›è¡Œèµ„æºé™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨</span><code>â€”localmem</code><span>æˆ–è€…</span><code>--localcores</code></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 2.0ç‰ˆæœ¬ä¸‹è½½(732M)</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">curl</span> <span class="cm-attribute">-o</span> cellranger-2.0.2.tar.gz <span class="cm-string">"http://cf.10xgenomics.com/releases/cell-exp/cellranger-2.0.2.tar.gz?Expires=1557256518&amp;Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cDovL2NmLjEweGdlbm9taWNzLmNvbS9yZWxlYXNlcy9jZWxsLWV4cC9jZWxscmFuZ2VyLTIuMC4yLnRhci5neiIsIkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTU1NzI1NjUxOH19fV19&amp;Signature=HoJUuPo4iTFdQgzFU1GH7uKf3uGitQxTjB6WOA9qGPlejf7tNcBPjO65WuSUZ~w8WWdeAvky-oV7XGfheY-bUr2b7QHr7jQEqc84cyU~PLvT~fYjkgC7cG7nlpbJOT~b7U~YH9amvR~SCLlyynp7scPDIA~9~keCYrIPgevTf2QyktybuSyjNTwugefOic~~XFkc9lrS~WQ9MNA1CLl4ExlQKsxWS77PEB6mwrMZXX65obDnZW9fIs3dIny6H5YoadbkgmsT52jmLien6PsG1g2jpAO90pPuHoru8LL64Q9gmB3I0nJAqi3EmrO3GKnUpHUhGb6doKmjSN6XccpmsA__&amp;Key-Pair-Id=APKAI7S6A5RYOXBWRPDA"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 2.1ç‰ˆæœ¬ä¸‹è½½</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">curl</span> <span class="cm-attribute">-o</span> cellranger-2.1.1.tar.gz <span class="cm-string">"http://cf.10xgenomics.com/releases/cell-exp/cellranger-2.1.1.tar.gz?Expires=1557260110&amp;Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cDovL2NmLjEweGdlbm9taWNzLmNvbS9yZWxlYXNlcy9jZWxsLWV4cC9jZWxscmFuZ2VyLTIuMS4xLnRhci5neiIsIkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTU1NzI2MDExMH19fV19&amp;Signature=RNQd-gTASTQhtnUSBfQWrnqo6Pyy2wDXtV5tlxkG97727GvoRhMqFXbEsz4gJl2BMckdVvW3S1tZRwRo5pmxPzmhq-8RKxf99pGqlzo84HYqhbIRkxXlIbLbj-u3PUJqo8cesWpbSVSKkS2TCNS-9GMFNieQswqMS2-DN4BqoBOJnWr7T4wlOMd9hypXWwOsW2P2fqaM-WP2ooMyo-oIxm3y9gDghXdDEP5lvHU7GCQcFGGexkdIrD6S5p8JPJ1DB5XieGrtEuP1YVp6tLMGXFoRWXS8dQLI1egWDYlOuRaiQgLIb3o5ZxBg5NpzLPP5kDHMAVzJFdBpf~~rkyNYTA__&amp;Key-Pair-Id=APKAI7S6A5RYOXBWRPDA"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">### è§£å‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">tar zxvf cellranger-2.0.2.tar.gz</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 528px;"></div><div class="CodeMirror-gutters" style="display: none; height: 528px;"></div></div></div></pre><h4 id='\bå‚è€ƒåŸºå› ç»„åºåˆ—çš„ä¸‹è½½'><span>å‚è€ƒåŸºå› ç»„åºåˆ—çš„ä¸‹è½½</span></h4><ol start='' ><li><span>æ ¹æ®éœ€æ±‚ä¸‹è½½åŸºå› ç»„æ³¨é‡Šæ–‡ä»¶</span>
<span>ä»¥ä¸‹æ–‡ä»¶æ˜¯åŸºäºenseblæ•°æ®åº“çš„hg38äººç±»åŸºå› ç»„æ³¨é‡Šæ–‡ä»¶ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨ç½‘ç«™ä¸‹è½½çš„åŸºå› ç»„ä¸æ³¨é‡Šæ–‡ä»¶ï¼Œéœ€è¦è¿‡æ»¤ä¸€ä¸‹ã€‚</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">curl</span> <span class="cm-attribute">-O</span> http://cf.10xgenomics.com/supp/cell-exp/refdata-cellranger-GRCh38-1.2.0.tar.gz</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ç„¶åè§£å‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">tar <span class="cm-attribute">-xzvf</span> refdata-cellranger-GRCh38-1.2.0.tar.gz</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><ol start='2' ><li><span>è‡ªå·±å°è¯•æ„å»º(é‡ç‚¹å’Œéš¾ç‚¹)</span>
<span>ä½†æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œè‡ªå®šä¹‰ä¸€å¥—å‚è€ƒä¿¡æ¯ï¼Œä½†éœ€è¦æ³¨æ„ä»¥ä¸‹é—®é¢˜ï¼š</span></li></ol><ul><li><span>å‚è€ƒåºåˆ—åªèƒ½æœ‰å¾ˆå°‘çš„ overlapping gene annotationsï¼Œå› ä¸ºreadsæ¯”å¯¹åˆ°å¤šä¸ªåŸºå› ä¼šå¯¼è‡´æµç¨‹æ£€æµ‹çš„åˆ†å­æ•°æ›´å°‘(å®ƒåªè¦uniquely mappedçš„ç»“æœ)</span></li><li><span>FASTAä¸GTFæ¯”å¯¹å’ŒSTARå…¼å®¹ï¼ŒGTFæ–‡ä»¶çš„ç¬¬ä¸‰åˆ—ï¼ˆfeature typeï¼‰å¿…é¡»æœ‰exon</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ä¸‹è½½åŸºå› ç»„</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">wget</span> ftp://ftp.ensembl.org/pub/release-84/fasta/homo_sapiens/dna/Homo_sapiens.GRCh38.dna.primary_assembly.fa.gz</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gunzip Homo_sapiens.GRCh38.dna.primary_assembly.fa.gz</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ä¸‹è½½æ³¨é‡Š</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">wget</span> ftp://ftp.ensembl.org/pub/release-84/gtf/homo_sapiens/Homo_sapiens.GRCh38.84.gtf.gz</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gunzip Homo_sapiens.GRCh38.84.gtf.gz</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># è½¯ä»¶æ„å»ºæ³¨é‡Š</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># é¦–å…ˆåˆ©ç”¨mkgtfè¿‡æ»¤GTFæ–‡ä»¶</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># mkgtf &lt;input_gtf&gt; &lt;output_gtf&gt; [--attribute=KEY:VALUE...]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cellranger mkgtf Homo_sapiens.GRCh38.84.gtf Homo_sapiens.GRCh38.84.filtered.gtf \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:protein_coding \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:lincRNA \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:antisense \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:IG_LV_gene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:IG_V_gene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:IG_V_pseudogene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:IG_D_gene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:IG_J_gene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:IG_J_pseudogene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:IG_C_gene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:IG_C_pseudogene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:TR_V_gene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:TR_V_pseudogene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:TR_D_gene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:TR_J_gene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:TR_J_pseudogene \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--attribute</span><span class="cm-operator">=</span>gene_biotype:TR_C_gene</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># gene_biotypeï¼ˆä¹Ÿå°±æ˜¯åŸºå› çš„ç”Ÿç‰©ç±»å‹ï¼‰çš„é”®å€¼å¯¹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ cat</span> Homo_sapiens.GRCh38.84.filtered.gtf |grep <span class="cm-attribute">-v</span> <span class="cm-string">"#"</span> |awk <span class="cm-attribute">-v</span> <span class="cm-def">FS</span><span class="cm-operator">=</span><span class="cm-string">'gene_biotype '</span> <span class="cm-string">'NF&gt;1{print $2}'</span>|awk <span class="cm-attribute">-F</span> <span class="cm-string">";"</span> <span class="cm-string">'{print $1}'</span>|sort | uniq <span class="cm-attribute">-c</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">213</span> <span class="cm-string">"IG_C_gene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">33</span> <span class="cm-string">"IG_C_pseudogene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">152</span> <span class="cm-string">"IG_D_gene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">76</span> <span class="cm-string">"IG_J_gene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-number">9</span> <span class="cm-string">"IG_J_pseudogene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">1209</span> <span class="cm-string">"IG_V_gene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">646</span> <span class="cm-string">"IG_V_pseudogene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">125</span> <span class="cm-string">"TR_C_gene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">16</span> <span class="cm-string">"TR_D_gene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">316</span> <span class="cm-string">"TR_J_gene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-number">12</span> <span class="cm-string">"TR_J_pseudogene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">848</span> <span class="cm-string">"TR_V_gene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">110</span> <span class="cm-string">"TR_V_pseudogene"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-number">45662</span> <span class="cm-string">"antisense"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-number">58181</span> <span class="cm-string">"lincRNA"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2337766</span> <span class="cm-string">"protein_coding"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># åˆ©ç”¨mkrefæ„å»ºå‚è€ƒç´¢å¼•ï¼Œè½¯ä»¶åˆ©ç”¨æ„å»ºå¥½çš„æ³¨é‡Šï¼Œå»æ„å»ºéœ€è¦çš„åŸºå› ç»„</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cellranger mkref <span class="cm-attribute">--genome</span><span class="cm-operator">=</span>GRCh38 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--fasta</span><span class="cm-operator">=</span>Homo_sapiens.GRCh38.dna.primary_assembly.fa \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--genes</span><span class="cm-operator">=</span>Homo_sapiens.GRCh38.84.filtered.gtf \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--ref-version</span><span class="cm-operator">=</span><span class="cm-number">1</span>.2.0</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1232px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1232px;"></div></div></div></pre><h4 id='mkfastq-æ‹†åˆ†æ•°æ®'><span>mkfastq æ‹†åˆ†æ•°æ®</span></h4><p><mark><span>ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªæ­¥éª¤æˆ‘ä»¬ä¸ä¼šä½¿ç”¨ï¼Œä»æ•°æ®åº“ä¸‹è½½å¯ä»¥å¾—åˆ°fastqæ–‡ä»¶ï¼Œè€Œä¸”æ•°æ®åº“ä¸€èˆ¬ä¸ä¼šç»™å‡ºBCLsæ ¼å¼çš„åŸå§‹æ–‡ä»¶ã€‚</span>
<span>ç›®çš„ï¼š</span><mark><span>å°†æ¯ä¸ªflowcell çš„Illumina sequencer&#39;s base call files (BCLs)è½¬ä¸ºfastqæ–‡ä»¶</span></mark></p><p><span>ç‰¹è‰²ï¼š å®ƒå€Ÿé‰´äº†Illuminaå‡ºå“çš„</span><code>bcl2fastq</code><span>ï¼Œå¦å¤–å¢åŠ äº†ï¼š</span></p><ul><li><span>å°†10X æ ·æœ¬indexåç§°ä¸å››ç§å¯¡æ ¸è‹·é…¸å¯¹åº”èµ·æ¥ï¼Œæ¯”å¦‚A1å­”æ˜¯æ ·æœ¬SI-GA-A1ï¼Œç„¶åå¯¹åº”çš„å¯¡æ ¸è‹·é…¸æ˜¯GGTTTACT, CTAAACGG, TCGGCGTC, and AACCGTAA ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šå»indexæ–‡ä»¶ä¸­å°†å­˜åœ¨è¿™å››ç§å¯¡æ ¸è‹·é…¸çš„fastqç»„åˆåˆ°A1è¿™ä¸ªæ ·æœ¬</span></li><li><span>æä¾›è´¨æ§ç»“æœï¼ŒåŒ…æ‹¬barcode è´¨é‡ã€æ€»ä½“æµ‹åºè´¨é‡å¦‚Q30ã€R1å’ŒR2çš„Q30ç¢±åŸºå æ¯”ã€æµ‹åºreadsæ•°ç­‰</span></li><li><span>å¯ä»¥ä½¿ç”¨10Xç®€åŒ–ç‰ˆçš„æ ·æœ¬ä¿¡æ¯è¡¨</span>
<img src="images/2021-10-23-09-47-55.png" referrerpolicy="no-referrer"></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ç¬¬ä¸€ç§</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ cellranger</span> mkfastq <span class="cm-attribute">--id</span><span class="cm-operator">=</span>bcl \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--run</span><span class="cm-operator">=</span>/path/to/bcl \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--samplesheet</span><span class="cm-operator">=</span>samplesheet-1.2.0.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--jobmode</span><span class="cm-operator">=</span>local </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--localcores</span><span class="cm-operator">=</span><span class="cm-number">20</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--localmem</span><span class="cm-operator">=</span><span class="cm-number">80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ç¬¬äºŒç§</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ cellranger</span> mkfastq <span class="cm-attribute">--id</span><span class="cm-operator">=</span>bcl \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--run</span><span class="cm-operator">=</span>/path/to/bcl \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--csv</span><span class="cm-operator">=</span>simple-1.2.0.csv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--jobmode</span><span class="cm-operator">=</span>local </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--localcores</span><span class="cm-operator">=</span><span class="cm-number">20</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--localmem</span><span class="cm-operator">=</span><span class="cm-number">80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å…¶ä¸­idæŒ‡å®šè¾“å‡ºç›®å½•çš„åç§°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># runæŒ‡çš„æ˜¯ä¸‹æœºçš„åŸå§‹BCLæ–‡ä»¶ç›®å½•</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># -â€“samplesheet ï¼šæ ·å“ä¿¡æ¯åˆ—è¡¨--å…±ä¸‰åˆ—ï¼ˆlane id ,sample name ,index name)ï¼Œæ³¨æ„è¦æ§åˆ¶å¥½æ ¸å¿ƒæ•°å’Œå†…å­˜æ•°</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 396px;"></div><div class="CodeMirror-gutters" style="display: none; height: 396px;"></div></div></div></pre><h4 id='ğŸ”ºcount-ç»†èƒå’ŒåŸºå› çš„å®šé‡'><span>ğŸ”ºcount ç»†èƒå’ŒåŸºå› çš„å®šé‡</span></h4><p><span>è¿™ä¸ªè¿‡ç¨‹æ˜¯æœ€é‡è¦çš„ï¼Œå®ƒå®Œæˆç»†èƒä¸åŸºå› çš„å®šé‡ï¼Œå®ƒå°†æ¯”å¯¹ã€è´¨æ§ã€å®šé‡éƒ½åŒ…è£…äº†èµ·æ¥ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># è¿™æ˜¯ç¤ºä¾‹ï¼Œä¸æ˜¯çœŸå®æ•°æ® #</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cellranger count <span class="cm-attribute">--id</span><span class="cm-operator">=</span>sample345 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--transcriptome</span><span class="cm-operator">=</span>/opt/refdata-cellranger-GRCh38-1.2.0 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--fastqs</span><span class="cm-operator">=</span>/home/scRNA/runs/HAWT7ADXX/outs/fastq_path \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--sample</span><span class="cm-operator">=</span>mysample \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--expect-cells</span><span class="cm-operator">=</span><span class="cm-number">1000</span> \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">--nosecondary</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># idæŒ‡å®šè¾“å‡ºæ–‡ä»¶å­˜æ”¾ç›®å½•å</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># transcriptomeæŒ‡å®šä¸CellRangerå…¼å®¹çš„å‚è€ƒåŸºå› ç»„</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># fastqsæŒ‡å®šmkfastqæˆ–è€…è‡ªå®šä¹‰çš„æµ‹åºæ–‡ä»¶</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># sampleè¦å’Œfastqæ–‡ä»¶çš„å‰ç¼€ä¸­çš„sampleä¿æŒä¸€è‡´ï¼Œä½œä¸ºè½¯ä»¶è¯†åˆ«çš„æ ‡å¿—</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># expect-cellsæŒ‡å®šå¤ç°çš„ç»†èƒæ•°é‡ï¼Œè¿™ä¸ªè¦å’Œå®éªŒè®¾è®¡ç»“åˆèµ·æ¥</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># nosecondary åªè·å¾—è¡¨è¾¾çŸ©é˜µï¼Œä¸è¿›è¡Œåç»­çš„é™ç»´ã€èšç±»å’Œå¯è§†åŒ–åˆ†æ(å› ä¸ºåæœŸä¼šè‡ªè¡Œç”¨RåŒ…å»åš)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><span>è¾“å‡ºæ–‡ä»¶ï¼š</span></p><ul><li><span>web_summary.htmlï¼šå®˜æ–¹è¯´æ˜ summary HTML file </span></li><li><span>metrics_summary.csvï¼šCSVæ ¼å¼æ•°æ®æ‘˜è¦</span></li><li><span>possorted_genome_bam.bamï¼šæ¯”å¯¹æ–‡ä»¶</span></li><li><span>possorted_genome_bam.bam.baiï¼šç´¢å¼•æ–‡ä»¶</span></li><li><mark><span>filtered_gene_bc_matricesï¼šæ˜¯é‡è¦çš„ä¸€ä¸ªç›®å½•ï¼Œä¸‹é¢åˆåŒ…å«äº† barcodes.tsv.gzã€features.tsv.gzã€matrix.mtx.gzï¼Œæ˜¯ä¸‹æ¸¸Seuratã€Scaterã€Monocleç­‰åˆ†æçš„è¾“å…¥æ–‡ä»¶</span></mark></li><li><span>filtered_feature_bc_matrix.h5ï¼šè¿‡æ»¤æ‰çš„barcodeä¿¡æ¯HDF5 format</span></li><li><span>raw_feature_bc_matrixï¼šåŸå§‹barcodeä¿¡æ¯</span></li><li><span>raw_feature_bc_matrix.h5ï¼šåŸå§‹barcodeä¿¡æ¯HDF5 format</span></li><li><mark><span>analysisï¼šæ•°æ®åˆ†æç›®å½•ï¼Œä¸‹é¢åˆåŒ…å«èšç±»clusteringï¼ˆæœ‰graph-based &amp; k-meansï¼‰ã€å·®å¼‚åˆ†ædiffexpã€ä¸»æˆåˆ†çº¿æ€§é™ç»´åˆ†æpcaã€éçº¿æ€§é™ç»´tsne</span></mark></li><li><span>molecule_info.h5ï¼šä¸‹é¢è¿›è¡Œaggregateä½¿ç”¨çš„æ–‡ä»¶</span></li><li><span>cloupe.cloupeï¼šå®˜æ–¹å¯è§†åŒ–å·¥å…·Loupe Cell Browser è¾“å…¥æ–‡ä»¶</span></li></ul><h4 id='aggrå¤šä¸ªæ–‡åº“çš„æ•´åˆ'><span>aggrå¤šä¸ªæ–‡åº“çš„æ•´åˆ</span></h4><p><span>å½“å¤„ç†å¤šä¸ªç”Ÿç‰©å­¦æ ·æœ¬æˆ–è€…ä¸€ä¸ªæ ·æœ¬å­˜åœ¨å¤šä¸ªé‡å¤/æ–‡åº“æ—¶ï¼Œæœ€å¥½çš„æ“ä½œå°±æ˜¯å…ˆåˆ†åˆ«å¯¹æ¯ä¸ªæ–‡åº“è¿›è¡Œå•ç‹¬çš„countå®šé‡ï¼Œç„¶åå°†å®šé‡ç»“æœåˆ©ç”¨aggrç»„åˆèµ·æ¥ã€‚</span></p><ol start='' ><li><span>å¾—åˆ°countç»“æœ</span></li><li><span>æ„å»ºAggregation CSV</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># AGG123_libraries.csv</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">library_id,molecule_h5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">LV123,/opt/runs/LV123/outs/molecule_info.h5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">LB456,/opt/runs/LB456/outs/molecule_info.h5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">LP789,/opt/runs/LP789/outs/molecule_info.h5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å…¶ä¸­</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># molecule_h5ï¼šæ–‡ä»¶molecule_info.h5 fileçš„è·¯å¾„</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><ol start='3' ><li><span>è¿è¡Œaggr</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cellranger aggr <span class="cm-attribute">--id</span><span class="cm-operator">=</span>AGG123 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-attribute">--csv</span><span class="cm-operator">=</span>AGG123_libraries.csv \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-attribute">--normalize</span><span class="cm-operator">=</span>mapped</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ç»“æœè¾“å‡ºåˆ°AGG123è¿™ä¸ªç›®å½•ä¸­</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><h3 id='å…³äºä¸Šæ¸¸åˆ†æå¾—åˆ°çš„æ•°æ®é›†'><span>å…³äºä¸Šæ¸¸åˆ†æå¾—åˆ°çš„æ•°æ®é›†</span></h3><p><span>e.g.10X Genomics å…è´¹æä¾›çš„å¤–å‘¨è¡€å•æ ¸ç»†èƒ (PBMC) æ•°æ®é›†</span>
<img src="images/2021-10-24-21-32-14.png" referrerpolicy="no-referrer"></p><ul><li><span>barcodes.tsvï¼šæ¯ä¸ªç»†èƒçš„ç¼–ç ï¼Œç”±ATCGå››ä¸ªç¢±åŸºæ’åˆ—ç»„åˆå½¢æˆçš„ä¸åŒçš„14ä¸ªç¢±åŸºç»„åˆ</span></li><li><span>genes.tsvï¼šåŸºå› çš„ensembl ID å’Œgene symbol</span>
<img src="images/2021-10-24-21-32-37.png" referrerpolicy="no-referrer"></li><li><span>matrix.mtxï¼šæ¯ä¸ªç»†èƒä¸åŒåŸºå› æ‰€æµ‹å¾—çš„è¡¨è¾¾çŸ©é˜µï¼Œç¬¬ä¸€åˆ—æ˜¯åŸºå› IDï¼Œä¸genes.tsvè¿›è¡Œå¯¹åº”è½¬æ¢ï¼›ç¬¬äºŒåˆ—æ˜¯ç»†èƒçš„ç¼–å·ï¼Œä¸barcodes.tsvè¿›è¡ŒåŒ¹é…ï¼›ç¬¬ä¸‰åˆ—æ˜¯åŸºå› çš„è¡¨è¾¾é‡ï¼ˆTPMï¼‰ã€‚</span></li></ul><h2 id='æ•°æ®é¢„å¤„ç†å·¥ä½œæµç¨‹'><span>æ•°æ®é¢„å¤„ç†å·¥ä½œæµç¨‹</span></h2><p><strong><span>åŠ è½½SeuratåŒ…å’Œè¯»å–æ•°æ®</span></strong></p><p><span>ä½¿ç”¨Read10X()å‡½æ•°è¯»å–æ•°æ®æ–‡ä»¶ï¼Œå¹¶æ„å»ºæˆ</span><mark><span>è¡Œåä¸ºåŸºå› åï¼Œåˆ—åä¸ºç»†èƒçš„barcodeçš„ (UMI) è®¡æ•°çŸ©é˜µ</span></mark><span>ï¼Œå…¶ä¸­å¯å‚¨å­˜å•ç»†èƒæ•°æ®é›†çš„ç¨€ç–çŸ©é˜µå’Œåç»­åˆ†æç»“æœã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># BiocManager::install("Seurat")</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">dplyr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">Seurat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">patchwork</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Load the PBMC dataset</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc.data</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">Read10X</span>(<span class="cm-variable">data.dir</span><span class="cm-operator">=</span> <span class="cm-string">"../data/pbmc3k/filtered_gene_bc_matrices/hg19/"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Initialize the Seurat object with the raw (non-normalized data).</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CreateSeuratObject</span>(<span class="cm-variable">counts</span> <span class="cm-operator">=</span> <span class="cm-variable">pbmc.data</span>, <span class="cm-variable">project</span> <span class="cm-operator">=</span> <span class="cm-string">"pbmc3k"</span>, <span class="cm-variable">min.cells</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>, <span class="cm-variable">min.features</span> <span class="cm-operator">=</span> <span class="cm-number">200</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><h3 id='qcè´¨é‡æ£€æµ‹'><span>QCè´¨é‡æ£€æµ‹</span></h3><blockquote><p><span>QCè´¨é‡æŒ‡æ ‡ï¼š</span></p></blockquote><ul><li><p><span>æ¯ä¸ªç»†èƒæ£€æµ‹åˆ°çš„åŸºå› æ•°ç›®</span></p><ul><li><span>ä½è´¨é‡ç»†èƒæˆ–ç©ºæ¶²æ»´é€šå¸¸åªæœ‰å¾ˆå°‘çš„åŸºå› </span></li><li><span>ç»†èƒåŒè”ä½“æˆ–å¤šé‡è”ä½“å¯èƒ½è¡¨ç°å‡ºå¼‚å¸¸é«˜çš„åŸºå› è®¡æ•°</span></li></ul></li><li><p><span>æ¯ä¸ªç»†èƒä¸­æ£€æµ‹åˆ°çš„åˆ†å­æ€»æ•°</span></p></li><li><p><span>ä½è´¨é‡/å‚æ­»çš„ç»†èƒé€šå¸¸è¡¨ç°å‡ºå¹¿æ³›çš„çº¿ç²’ä½“æ±¡æŸ“ï¼Œæ‰€ä»¥ä½¿ç”¨è¯¥PercentageFeatureSet()å‡½æ•°è®¡ç®—çº¿ç²’ä½“ QC æŒ‡æ ‡ï¼Œå…¶ä¸­MT-å¼€å¤´çš„åŸºå› è®¤ä¸ºæ˜¯çº¿ç²’ä½“åŸºå› </span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">###### ç»†èƒè´¨æ§</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">### è®¡ç®—è´¨æ§æŒ‡æ ‡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># è®¡ç®—ç»†èƒä¸­çº¿ç²’ä½“åŸºå› æ¯”ä¾‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">pbmc</span>[[<span class="cm-string">"percent.mt"</span>]] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">PercentageFeatureSet</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">pattern</span> <span class="cm-operator">=</span> <span class="cm-string">"^MT-"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># è´¨æ§å‰å°æç´å›¾</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">plots</span> <span class="cm-operator">=</span> <span class="cm-builtin">list</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span>(<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-variable">seq_along</span>(<span class="cm-variable">plot.featrures</span>)){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">plots</span>[[<span class="cm-variable">i</span>]] <span class="cm-operator">=</span> <span class="cm-variable">VlnPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">group.by</span><span class="cm-operator">=</span><span class="cm-variable">group</span>, <span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">plot.featrures</span>[<span class="cm-variable">i</span>]) <span class="cm-operator">+</span> <span class="cm-variable">theme.set2</span> <span class="cm-operator">+</span> <span class="cm-variable">NoLegend</span>()}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">violin</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">wrap_plots</span>(<span class="cm-variable">plots</span> <span class="cm-operator">=</span> <span class="cm-variable">plots</span>, <span class="cm-variable">nrow</span><span class="cm-operator">=</span><span class="cm-number">2</span>) &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">ggsave</span>(<span class="cm-string">"QC/vlnplot_before_qc.pdf"</span>, <span class="cm-variable">plot</span> <span class="cm-operator">=</span> <span class="cm-variable">violin</span>, <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">9</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">8</span>) </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p><span>å› æ­¤ï¼Œæˆ‘ä»¬é€šè¿‡å°†QCæŒ‡æ ‡å¯è§†åŒ–ï¼Œå¹¶ä½¿ç”¨è¿™äº›æŒ‡æ ‡æ¥è¿‡æ»¤ä¸ç¬¦åˆæŒ‡æ ‡çš„ç»†èƒã€‚</span><br></p><p><img src="images/2021-10-24-21-49-22.png" referrerpolicy="no-referrer"></p><p><br><span>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°nFeature_RNAï¼ŒnCount_RNAå’Œpercent.mtçš„æ•°é‡å¤§éƒ¨åˆ†éƒ½åœ¨å°æç´å›¾çš„åº•éƒ¨ï¼Œå› æ­¤éœ€è¦è¿‡æ»¤ä½è´¨é‡çš„ç»†èƒï¼Œå…¶ä¸­nCount_RNAä¸ºæ¯ä¸ªç»†èƒçš„UMIæ•°ç›®ï¼ŒnFeature_RNAä¸ºæ¯ä¸ªç»†èƒæ‰€æ£€æµ‹åˆ°çš„åŸºå› æ•°ç›®ã€‚</span>
<br><mark><span>é€šå¸¸ï¼Œæˆ‘ä»¬è¿‡æ»¤å…·æœ‰è¶…è¿‡ 2,500 æˆ–å°‘äº 200 çš„åŸºå› æ•°ç›®çš„ç»†èƒå’Œçº¿ç²’ä½“è®¡æ•° &gt; 5% çš„ç»†èƒã€‚</span></mark></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">### è´¨æ§</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># è®¾ç½®è´¨æ§æ ‡å‡†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">minGene</span><span class="cm-operator">=</span><span class="cm-number">500</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">maxGene</span><span class="cm-operator">=</span><span class="cm-number">2500</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">maxUMI</span><span class="cm-operator">=</span><span class="cm-number">22000</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">pctMT</span><span class="cm-operator">=</span><span class="cm-number">5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># æ•°æ®è´¨æ§å¹¶ç»˜åˆ¶å°æç´å›¾</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">subset</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">subset</span> <span class="cm-operator">=</span> <span class="cm-variable">nFeature_RNA</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">minGene</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">nFeature_RNA</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">maxGene</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">nCount_RNA</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">maxUMI</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">percent.mt</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">pctMT</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plots</span> <span class="cm-operator">=</span> <span class="cm-builtin">list</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-variable">seq_along</span>(<span class="cm-variable">plot.featrures</span>)){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plots</span>[[<span class="cm-variable">i</span>]] <span class="cm-operator">=</span> <span class="cm-variable">VlnPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">group.by</span><span class="cm-operator">=</span><span class="cm-variable">group</span>, <span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">0.01</span>,<span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">plot.featrures</span>[<span class="cm-variable">i</span>]) <span class="cm-operator">+</span> <span class="cm-variable">theme.set2</span> <span class="cm-operator">+</span><span class="cm-variable">NoLegend</span>()}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">violin</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">wrap_plots</span>(<span class="cm-variable">plots</span> <span class="cm-operator">=</span> <span class="cm-variable">plots</span>, <span class="cm-variable">nrow</span><span class="cm-operator">=</span><span class="cm-number">1</span>) &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"QC/vlnplot_after_qc.pdf"</span>, <span class="cm-variable">plot</span> <span class="cm-operator">=</span> <span class="cm-variable">violin</span>, <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">9</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">8</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><p><img src="images/2021-10-24-21-53-23.png" referrerpolicy="no-referrer">
<span>å…³äºæ ¸ç³–ä½“å’Œçº¢ç»†èƒçš„è´¨æ§æ ¹æ®éœ€æ±‚é€‰æ‹©æ˜¯å¦éœ€è¦ï¼Œè‹¥éœ€è¦ï¼Œåœ¨ä¸Šä¸€æ­¥ä»£ç æ·»åŠ æ–°çš„è´¨æ§æŒ‡æ ‡ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># è®¡ç®—ç»†èƒä¸­æ ¸ç³–ä½“åŸºå› æ¯”ä¾‹</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">pbmc</span>[[<span class="cm-string">"percent.rb"</span>]] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">PercentageFeatureSet</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">pattern</span> <span class="cm-operator">=</span> <span class="cm-string">"^RP[LS]"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># è®¡ç®—çº¢ç»†èƒæ¯”ä¾‹ï¼Œæ£€æµ‹æ˜¯å¦æœ‰è¢«è¡€æ±¡æŸ“</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">HB.genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">c</span>(<span class="cm-string">"HBA1"</span>,<span class="cm-string">"HBA2"</span>,<span class="cm-string">"HBB"</span>,<span class="cm-string">"HBD"</span>,<span class="cm-string">"HBE1"</span>,<span class="cm-string">"HBG1"</span>,<span class="cm-string">"HBG2"</span>,<span class="cm-string">"HBM"</span>,<span class="cm-string">"HBQ1"</span>,<span class="cm-string">"HBZ"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">HB.genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CaseMatch</span>(<span class="cm-variable">HB.genes</span>, <span class="cm-variable">rownames</span>(<span class="cm-variable">pbmc</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">pbmc</span>[[<span class="cm-string">"percent.HB"</span>]]<span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">PercentageFeatureSet</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">features</span><span class="cm-operator">=</span><span class="cm-variable">HB.genes</span>) </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><blockquote><p><span>æ£€æµ‹doublets</span></p></blockquote><ul><li><span>Doubletsï¼šå•ä¸ªæ¶²æ»´(droplet)æ•è·ä¸€ä¸ªæ¡å½¢ç ç (barcode bead)å’Œå¤šä¸ªç»†èƒæ ¸ï¼Œå¯¼è‡´äº†å¼‚å¸¸é«˜çš„åŸºå› è®¡æ•°ã€‚</span></li><li><mark><span>ï¼ï¼ï¼</span></mark><span>ä¸€èˆ¬æ¥è¯´ï¼Œå»ºè®®æ£€æµ‹doubletsåœ¨QCçš„è´¨æ§nFeature_RNAæ­¥éª¤ä¹‹å‰ï¼Œå…ˆå»é™¤å¼‚å¸¸é«˜çš„åŸºå› è®¡æ•°å¯¹åç»­QCæ•ˆæœæ›´å¥½ã€‚ä¸”ä¸€èˆ¬åœ¨èšç±»æ­¥éª¤æˆ–è€…ç»†èƒç±»å‹æ³¨é‡Šä¹‹åå»é™¤doubletsæ•ˆæœæ›´å¥½ï¼Œå› ä¸ºè¿™æ ·èƒ½ä»å›¾ä¸­æ¸…æ¥šçœ‹åˆ°å“ªä¸€äº›ç»†èƒæ˜¯åœ¨ç°‡çš„è¾¹ç¼˜å’Œå±äºå“ªä¸€ç±»çš„ç»†èƒï¼Œè€Œè¿™ä¸€äº›è¾¹ç¼˜çš„ç»†èƒä¸€èˆ¬æ¥è¯´æ˜¯doubletsã€‚</span></li><li><mark><span>å»é™¤doubletsä¹‹åï¼Œå†å¯¹å…¶ä½™çš„åŸå§‹countsçŸ©é˜µè¿›è¡Œæ–°ä¸€è½®çš„Seuratçš„æ ‡å‡†åˆ†ææµç¨‹ã€‚</span></mark></li></ul><ol start='' ><li><span>DoubletFinderåŒ…</span>
<em><span>ï¼ˆä¸Seuratçš„äº¤äº’ï¼šåœ¨seuratæ ‡å‡†æµç¨‹è¿›è¡Œåˆ°t-SNEå’ŒUMAPé™ç»´ä¹‹åï¼ŒFindAllMarkersä¹‹å‰è¿›è¡ŒDoubletFinderæ“ä½œã€‚ï¼‰</span></em></li></ol><p><span>åŸç†ï¼šä»ç°æœ‰çš„çŸ©é˜µçš„ç»†èƒä¸­æ ¹æ®æˆ‘ä»¬é¢„å…ˆå®šä¹‰å¥½çš„ç»†èƒç±»å‹æ¨¡æ‹Ÿä¸€äº›åŒç»†èƒå‡ºæ¥ï¼ˆæ¯”å¦‚å•æ ¸å’ŒTç»†èƒçš„åŒç»†èƒã€Bç»†èƒå’Œä¸­æ€§ç²’ç»†èƒçš„åŒç»†èƒç­‰ç­‰ï¼‰ï¼Œå°†æ¨¡æ‹Ÿå‡ºçš„åŒç»†èƒå’ŒåŸæœ‰çŸ©é˜µçš„ç»†èƒæ··åˆåœ¨ä¸€èµ·ï¼Œè¿›è¡Œé™ç»´èšç±»ï¼ŒåŸåˆ™ä¸Šäººå·¥æ¨¡æ‹Ÿçš„doubletsä¼šä¸çœŸå®çš„doubletsè·ç¦»è¾ƒè¿‘ï¼Œå› æ­¤è®¡ç®—æ¯ä¸ªç»†èƒKæœ€è¿‘é‚»ç»†èƒä¸­äººå·¥æ¨¡æ‹Ÿdoubletsçš„æ¯”ä¾‹ (pANN)ï¼Œå°±å¯ä»¥æ ¹æ®pANNå€¼å¯¹æ¯ä¸ªbarcodeçš„doubletsæ¦‚ç‡è¿›è¡Œæ’åºã€‚å¦å¤–ä¾æ®æ³Šæ¾åˆ†å¸ƒçš„ç»Ÿè®¡åŸç†å¯ä»¥è®¡ç®—æ¯ä¸ªæ ·æœ¬ä¸­doubletsçš„æ•°é‡ï¼Œç»“åˆä¹‹å‰çš„ç»†èƒpANNå€¼æ’åºï¼Œå°±å¯ä»¥è¿‡æ»¤doubletsäº†ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">devtools</span><span class="cm-operator">::</span><span class="cm-variable">install_github</span>(<span class="cm-string">'chris-mcginnis-ucsf/DoubletFinder'</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">DoubletFinder</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">## æ£€æµ‹doublets</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">pc.num</span><span class="cm-operator">=</span><span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">10</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># å¯»æ‰¾æœ€ä¼˜pKå€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">sweep.res.list</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">paramSweep_v3</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">PCs</span> <span class="cm-operator">=</span> <span class="cm-variable">pc.num</span>, <span class="cm-variable">sct</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>) <span class="cm-comment">#ä½¿ç”¨logæ ‡å‡†åŒ–ï¼Œsctå‚æ•°è®¾ç½®ä¸º sct = Fï¼ˆé»˜è®¤ ï¼‰,å¦‚ä½¿ç”¨SCTæ ‡å‡†åŒ–æ–¹æ³•ï¼Œè®¾ç½®ä¸ºT</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">saveRDS</span>(<span class="cm-variable">sweep.res.list</span>, <span class="cm-string">"QC/sweep.res.list.rds"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å½“GTè®¾ç½®ä¸º TRUEæ—¶ï¼Œå¯ç”¨äºROCåˆ†æã€‚ é»˜è®¤è®¾ç½®ä¸º FALSEã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">sweep.stats</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">summarizeSweep</span>(<span class="cm-variable">sweep.res.list</span>, <span class="cm-variable">GT</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>) &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">bcmvn</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">find.pK</span>(<span class="cm-variable">sweep.stats</span>) <span class="cm-comment">#å¯ä»¥çœ‹åˆ°æœ€ä½³å‚æ•°çš„ç‚¹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># æå–æœ€ä½³pkå€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">pK_bcmvn</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">bcmvn</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">pK</span>[<span class="cm-variable">which.max</span>(<span class="cm-variable">bcmvn</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">BCmetric</span>)] <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">as.character</span>() <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">as.numeric</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># æ’é™¤ä¸èƒ½æ£€å‡ºçš„åŒæºdoubletsï¼Œä¼˜åŒ–æœŸæœ›çš„doubletsæ•°é‡ï¼ŒåŒç»†èƒæœ‰ä¸¤ç§ï¼ŒåŒæºåŒç»†èƒå’Œå¼‚æºåŒç»†èƒã€‚DoubletFinderåªèƒ½æ£€æµ‹å¼‚æºåŒç»†èƒã€‚æ‰€ä»¥éœ€è¦æŠŠåŒæºåŒç»†èƒå¯èƒ½çš„æ¯”ç‡å»é™¤æ‰ï¼Œä»¥ä¼˜åŒ–æœŸæœ›çš„doubletsæ•°é‡ã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æŒ‰æ¯å¢åŠ 1000ä¸ªç»†èƒï¼ŒåŒç»†èƒæ¯”ç‡å¢åŠ åƒåˆ†ä¹‹8æ¥è®¡ç®— </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DoubletRate</span> <span class="cm-operator">=</span> <span class="cm-variable">ncol</span>(<span class="cm-variable">pbmc</span>)<span class="cm-operator">*</span><span class="cm-number">8</span><span class="cm-operator">*</span><span class="cm-number">1e-6</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ä¼°è®¡åŒæºåŒç»†èƒæ¯”ä¾‹ï¼Œæ ¹æ®modelHomotypic()ä¸­çš„å‚æ•°ä¸ºäººä¸ºæ··åˆåŒç»†èƒã€‚è¿™é‡Œæ˜¯ä»seurat_clustersä¸­æ¥æ··åŒç»†èƒ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">homotypic.prop</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">modelHomotypic</span>(<span class="cm-variable">pbmc</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">SingleR</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># è¯¥éƒ¨åˆ†ä½¿ç”¨SingleRåçš„æ•°æ®æ˜¯ä¸ºäº†å¯è§†åŒ–å“ªäº›ç±»å‹çš„ç»†èƒä¸­æœ‰doublets </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">nExp_poi</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">round</span>(<span class="cm-variable">DoubletRate</span><span class="cm-operator">*</span><span class="cm-variable">ncol</span>(<span class="cm-variable">pbmc</span>)) &nbsp;<span class="cm-comment"># è®¡ç®—åŒç»†èƒæ¯”ä¾‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">nExp_poi.adj</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">round</span>(<span class="cm-variable">nExp_poi</span><span class="cm-operator">*</span>(<span class="cm-number">1</span><span class="cm-operator">-</span><span class="cm-variable">homotypic.prop</span>)) &nbsp;<span class="cm-comment"># ä½¿ç”¨åŒæºåŒç»†èƒæ¯”ä¾‹å¯¹è®¡ç®—çš„åŒç»†èƒæ¯”ä¾‹è¿›è¡Œæ ¡æ­£</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># ä½¿ç”¨ç¡®å®šå¥½çš„å‚æ•°é‰´å®šdoublets</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">doubletFinder_v3</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">PCs</span> <span class="cm-operator">=</span> <span class="cm-variable">pc.num</span>, <span class="cm-variable">pN</span> <span class="cm-operator">=</span> <span class="cm-number">0.25</span>, <span class="cm-variable">pK</span> <span class="cm-operator">=</span> <span class="cm-variable">pK_bcmvn</span>, <span class="cm-variable">nExp</span> <span class="cm-operator">=</span> <span class="cm-variable">nExp_poi.adj</span>, <span class="cm-variable">reuse.pANN</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>, <span class="cm-variable">sct</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å¯è§†åŒ–ç»“æœ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">names</span>(<span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span>) <span class="cm-operator">=</span> <span class="cm-variable">gsub</span>(<span class="cm-string">"DF.classifications.*"</span>, <span class="cm-string">"DF.classifications"</span>, <span class="cm-variable">colnames</span>(<span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span>)) &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">p1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-string">"DF.classifications"</span>) <span class="cm-operator">+</span> <span class="cm-variable">scale_color_manual</span>(<span class="cm-variable">values</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"red"</span>, <span class="cm-string">"gray"</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">p2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">p</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">p1</span><span class="cm-operator">|</span><span class="cm-variable">p2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ggsave</span>(<span class="cm-string">"QC/Doublets_DFpred.pdf"</span>, <span class="cm-variable">p</span>, <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">12</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 770px;"></div><div class="CodeMirror-gutters" style="display: none; height: 770px;"></div></div></div></pre><p><img src="images/2021-10-24-21-59-08.png" referrerpolicy="no-referrer">
<br></p><ol start='2' ><li><span>ScrubletåŒ…(python)</span>
<span>åŸç†ï¼šç»™å®šä¸€ä¸ªåŸå§‹çš„ï¼ˆæœªå½’ä¸€åŒ–çš„ï¼‰UMIçŸ©é˜µï¼Œä»¥ç»†èƒä¸ºè¡Œï¼ŒåŸºå› ä¸ºåˆ—çš„çŸ©é˜µcounts_matrixè®¡æ•°ï¼Œè®¡ç®—æ¯ä¸ªå•å…ƒçš„å¤šç»†èƒå¾—åˆ†ã€‚</span></li></ol><blockquote><p><span>æ³¨æ„äº‹é¡¹ï¼š</span></p></blockquote><ol start='' ><li><span>å¤„ç†æ¥è‡ªå¤šä¸ªæ ·æœ¬çš„æ•°æ®æ—¶ï¼Œè¯·åˆ†åˆ«å¯¹æ¯ä¸ªæ ·æœ¬è¿è¡ŒScrubletã€‚ å› ä¸ºScrubletæ—¨åœ¨æ£€æµ‹ç”±ä¸¤ä¸ªç»†èƒçš„éšæœºå…±å°è£…å½¢æˆçš„technical doubletsï¼Œæ‰€ä»¥åœ¨mergedæ•°æ®é›†ä¸Šå¯èƒ½ä¼šè¡¨ç°ä¸ä½³ï¼Œå› ä¸ºç»†èƒç±»å‹æ¯”ä¾‹ä¸ä»£è¡¨ä»»ä½•å•ä¸ªæ ·å“ï¼› </span></li><li><span>æ£€æŸ¥doublet scoreé˜ˆå€¼æ˜¯å¦åˆç†ï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œæ‰‹åŠ¨è°ƒæ•´ã€‚å¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µå‘ä¸‹doublet scoreçš„ç›´æ–¹åˆ†å¸ƒå›¾éƒ½æ˜¯å‘ˆç°æ ‡å‡†çš„åŒå³°ï¼› </span></li><li><span>UMAPæˆ–t-SNEå¯è§†åŒ–çš„ç»“æœä¸­ï¼Œé¢„æµ‹çš„åŒç»†èƒåº”è¯¥å¤§ä½“ä¸Šå…±å®šä½ï¼ˆå¯èƒ½åœ¨å¤šä¸ªç»†èƒç¾¤ä¸­ï¼‰ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™å¯èƒ½éœ€è¦è°ƒæ•´doublet scoreé˜ˆå€¼ï¼Œæˆ–æ›´æ”¹é¢„å¤„ç†å‚æ•°ä»¥æ›´å¥½åœ°è§£ææ•°æ®ä¸­å­˜åœ¨çš„ç»†èƒçŠ¶æ€ã€‚</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">scrublet</span> <span class="cm-keyword">as</span> <span class="cm-variable">scr</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">scipy</span>.<span class="cm-property">io</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">matplotlib</span>.<span class="cm-property">pyplot</span> <span class="cm-keyword">as</span> <span class="cm-variable">plt</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">numpy</span> <span class="cm-keyword">as</span> <span class="cm-variable">np</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">os</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">pandas</span> <span class="cm-keyword">as</span> <span class="cm-variable">pd</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">input_dir</span> <span class="cm-operator">=</span> <span class="cm-string">'.../pbmc3k_filtered_gene_bc_matrices/filtered_gene_bc_matrices/hg19'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">counts_matrix</span> <span class="cm-operator">=</span> <span class="cm-variable">scipy</span>.<span class="cm-property">io</span>.<span class="cm-property">mmread</span>(<span class="cm-variable">input_dir</span> <span class="cm-operator">+</span> <span class="cm-string">'/matrix.mtx'</span>).<span class="cm-property">T</span>.<span class="cm-property">tocsc</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">genes</span> <span class="cm-operator">=</span> <span class="cm-variable">np</span>.<span class="cm-property">array</span>(<span class="cm-variable">scr</span>.<span class="cm-property">load_genes</span>(<span class="cm-variable">input_dir</span> <span class="cm-operator">+</span> <span class="cm-string">'/genes.tsv'</span>, <span class="cm-variable">delimiter</span><span class="cm-operator">=</span><span class="cm-string">'\t'</span>, <span class="cm-variable">column</span><span class="cm-operator">=</span><span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">out_df</span> <span class="cm-operator">=</span> <span class="cm-variable">pd</span>.<span class="cm-property">read_csv</span>(<span class="cm-variable">input_dir</span> <span class="cm-operator">+</span> <span class="cm-string">'/barcodes.tsv'</span>, <span class="cm-variable">header</span> <span class="cm-operator">=</span> <span class="cm-keyword">None</span>, <span class="cm-variable">index_col</span><span class="cm-operator">=</span><span class="cm-keyword">None</span>, <span class="cm-variable">names</span><span class="cm-operator">=</span>[<span class="cm-string">'barcode'</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># åˆå§‹åŒ–Scrubletå¯¹è±¡ï¼Œexpected_doublet_rateé€šå¸¸ä¸º0.05-0.1ï¼Œç»“æœå¯¹è¯¥å‚æ•°ä¸æ•æ„Ÿ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scrub</span> <span class="cm-operator">=</span> <span class="cm-variable">scr</span>.<span class="cm-property">Scrublet</span>(<span class="cm-variable">counts_matrix</span>, <span class="cm-variable">expected_doublet_rate</span><span class="cm-operator">=</span><span class="cm-number">0.06</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># è®¡ç®—doublet score</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">doublet_scores</span>, <span class="cm-variable">predicted_doublets</span> <span class="cm-operator">=</span> <span class="cm-variable">scrub</span>.<span class="cm-property">scrub_doublets</span>(<span class="cm-variable">min_counts</span><span class="cm-operator">=</span><span class="cm-number">2</span>, <span class="cm-variable">min_cells</span><span class="cm-operator">=</span><span class="cm-number">3</span>, <span class="cm-variable">min_gene_variability_pctl</span><span class="cm-operator">=</span><span class="cm-number">85</span>, <span class="cm-variable">n_prin_comps</span><span class="cm-operator">=</span><span class="cm-number">30</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><p><img src="images/2021-10-24-22-00-53.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ç»˜åˆ¶doublet scoreåˆ†å¸ƒç›´æ–¹å›¾</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scrub</span>.<span class="cm-property">call_doublets</span>(<span class="cm-variable">threshold</span><span class="cm-operator">=</span><span class="cm-number">0.30</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å¦‚æœè‡ªåŠ¨é˜ˆå€¼æ£€æµ‹æ•ˆæœä¸ä½³ï¼Œåˆ™å¯ä»¥ä½¿ç”¨call_doublets()å‡½æ•°è°ƒæ•´é˜ˆå€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Doublet scoreåˆ†å¸ƒç›´æ–¹å›¾åŒ…æ‹¬è§‚å¯Ÿåˆ°çš„è½¬å½•ç»„å’Œæ¨¡æ‹Ÿçš„doubletï¼Œæ¨¡æ‹Ÿçš„doubletç›´æ–¹å›¾é€šå¸¸æ˜¯åŒå³°çš„ã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ç”»doublet scoreç›´æ–¹å›¾</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scrub</span>.<span class="cm-property">plot_histogram</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">### ç†æƒ³æƒ…å†µä¸‹ï¼Œé˜ˆå€¼åº”åœ¨æ¨¡æ‹Ÿdoubletç›´æ–¹å›¾çš„ä¸¤ç§æ¨¡å¼ä¹‹é—´è®¾ç½®æœ€å°å€¼</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><img src="images/2021-10-24-22-01-34.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># é™ç»´å¯è§†åŒ–</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">'Running UMAP...'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scrub</span>.<span class="cm-property">set_embedding</span>(<span class="cm-string">'UMAP'</span>, <span class="cm-variable">scr</span>.<span class="cm-property">get_umap</span>(<span class="cm-variable">scrub</span>.<span class="cm-property">manifold_obs_</span>, <span class="cm-number">10</span>, <span class="cm-variable">min_dist</span><span class="cm-operator">=</span><span class="cm-number">0.3</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span>(<span class="cm-string">'Done.'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">### UMAPå¯è§†åŒ–</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scrub</span>.<span class="cm-property">plot_embedding</span>(<span class="cm-string">'UMAP'</span>, <span class="cm-variable">order_points</span><span class="cm-operator">=</span><span class="cm-keyword">True</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><img src="images/2021-10-24-22-02-01.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># doubletså æ¯”</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span> (<span class="cm-variable">scrub</span>.<span class="cm-property">detected_doublet_rate_</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 0.014074074074074074</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æŠŠdoubletsé¢„æµ‹ç»“æœä¿å­˜åˆ°æ–‡ä»¶ï¼Œåç»­ç”¨Seuratç­‰è½¯ä»¶å¤„ç†çš„æ—¶å€™å¯ä»¥å¯¼å…¥doubletsçš„é¢„æµ‹ç»“æœå¯¹barcodeè¿›è¡Œç­›é€‰ã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">out_df</span>[<span class="cm-string">'doublet_scores'</span>] <span class="cm-operator">=</span> <span class="cm-variable">doublet_scores</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">out_df</span>[<span class="cm-string">'predicted_doublets'</span>] <span class="cm-operator">=</span> <span class="cm-variable">predicted_doublets</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">out_df</span>.<span class="cm-property">to_csv</span>(<span class="cm-variable">input_dir</span> <span class="cm-operator">+</span> <span class="cm-string">'/doublet.txt'</span>, <span class="cm-variable">index</span><span class="cm-operator">=</span><span class="cm-keyword">False</span>,<span class="cm-variable">header</span><span class="cm-operator">=</span><span class="cm-keyword">True</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">out_df</span>.<span class="cm-property">head</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><img src="images/2021-10-24-22-03-01.png" referrerpolicy="no-referrer"></p><h3 id='å½’ä¸€åŒ–æ•°æ®'><span>å½’ä¸€åŒ–æ•°æ®</span></h3><p><span>æˆ‘ä»¬é‡‡ç”¨</span><mark><span>å…¨å±€ç¼©æ”¾å½’ä¸€åŒ–æ–¹æ³•â€œLogNormalizeâ€</span></mark><span>ï¼Œè¯¥æ–¹æ³•å°†æ¯ä¸ªç»†èƒçš„ç‰¹å¾è¡¨è¾¾å¼æµ‹é‡å€¼ä¸æ€»è¡¨è¾¾å¼è¿›è¡Œå½’ä¸€åŒ–ï¼Œä¹˜ä»¥ä¸€ä¸ªæ¯”ä¾‹å› å­ï¼ˆé»˜è®¤ä¸º 10,000ï¼‰ï¼Œå¹¶å¯¹ç»“æœè¿›è¡Œå¯¹æ•°è½¬æ¢ã€‚å°†æœ‰é‡çº²çš„è¡¨è¾¾å¼ï¼Œç»è¿‡å˜æ¢ï¼ŒåŒ–ä¸ºæ— é‡çº²çš„è¡¨è¾¾å¼ï¼Œæ ‡å‡†åŒ–å€¼å­˜å‚¨åœ¨</span><code>pbmc[[&quot;RNA&quot;]]@data</code><span>ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">NormalizeData</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">normalization.method</span> <span class="cm-operator">=</span> <span class="cm-string">"LogNormalize"</span>, <span class="cm-variable">scale.factor</span> <span class="cm-operator">=</span> <span class="cm-number">10000</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><h3 id='è¯†åˆ«é«˜å¯å˜åŸºå› '><span>è¯†åˆ«é«˜å¯å˜åŸºå› </span></h3><ul><li><span>é«˜å¯å˜åŸºå› ï¼šåœ¨æŸäº›ç»†èƒä¸­é«˜åº¦è¡¨è¾¾ï¼Œè€Œåœ¨å…¶ä»–ç»†èƒä¸­è¡¨è¾¾ä½ï¼ˆåœ¨ä¸‹æ¸¸åˆ†æä¸­å…³æ³¨è¿™äº›åŸºå› æœ‰åŠ©äºçªå‡ºå•ç»†èƒæ•°æ®é›†ä¸­çš„ç”Ÿç‰©ä¿¡å·ã€‚ï¼‰</span></li><li><span>ä½¿ç”¨å‡å€¼ä¸æ–¹å·®ä¹‹é—´çš„å…³ç³»ï¼Œæ¥æŒ‘é€‰é«˜å˜åŸºå› ï¼Œé»˜è®¤è¿”å›å‰2000ä¸ªé«˜å˜åŸºå› è¿›å…¥ä¸‹æ¸¸åˆ†æï¼Œå¦‚PCAã€‚</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindVariableFeatures</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">selection.method</span> <span class="cm-operator">=</span> <span class="cm-string">"vst"</span>, <span class="cm-variable">nfeatures</span> <span class="cm-operator">=</span> <span class="cm-number">2000</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Identify the 10 most highly variable genes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">top10</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">head</span>(<span class="cm-variable">VariableFeatures</span>(<span class="cm-variable">pbmc</span>), <span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># plot variable features with and without labels</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">VariableFeaturePlot</span>(<span class="cm-variable">pbmc</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">LabelPoints</span>(<span class="cm-variable">plot</span> <span class="cm-operator">=</span> <span class="cm-variable">plot1</span>, <span class="cm-variable">points</span> <span class="cm-operator">=</span> <span class="cm-variable">top10</span>, <span class="cm-variable">repel</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot1</span> <span class="cm-operator">+</span> <span class="cm-variable">plot2</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><img src="images/2021-10-24-22-06-46.png" referrerpolicy="no-referrer"></p><h3 id='æ ‡å‡†åŒ–æ•°æ®'><span>æ ‡å‡†åŒ–æ•°æ®</span></h3><p><span>åœ¨é™ç»´æŠ€æœ¯ï¼ˆå¦‚ PCAï¼‰ä¹‹å‰çš„æ ‡å‡†é¢„å¤„ç†æ­¥éª¤ï¼Œä½¿ç”¨ScaleData()å‡½æ•°ï¼Œä½¿æ•°æ®ç¬¦åˆæ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œå› ä¸ºPCAåˆ†æé»˜è®¤æ•°æ®æ˜¯æœä»æ­£æ€åˆ†å¸ƒï¼Œå…¶ç»“æœå­˜å‚¨åœ¨pbmc[[&quot;RNA&quot;]]@scale.dataã€‚</span>
<span>ScaleData()å‡½æ•°ï¼š</span></p><ul><li><span>æ”¹å˜æ¯ä¸ªåŸºå› çš„è¡¨è¾¾ï¼Œä½¿è·¨ç»†èƒçš„å¹³å‡è¡¨è¾¾ä¸º 0</span></li><li><span>ç¼©æ”¾æ¯ä¸ªåŸºå› çš„è¡¨è¾¾ï¼Œä½¿ç»†èƒé—´çš„æ–¹å·®ä¸º 1</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">all.genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">pbmc</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">ScaleData</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">all.genes</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><blockquote><p><span>SCTransform()å‡½æ•°</span></p></blockquote><p><mark><span>å¯ä»¥ä»£æ›¿ä»¥ä¸Šä¸‰ä¸ªå¤„ç†æ­¥éª¤çš„å‡½æ•°ï¼ˆNormalizeData,</span>
<span>ScaleData,FindVariableFeaturesï¼‰çš„è¿è¡Œã€‚</span></mark><span>è¿™æ˜¯ä¸€ä¸ªç”¨æ–¹å·®ç¨³å®šå˜æ¢å¯¹å•ç»†èƒUMI count æ•°æ®æ ‡å‡†åŒ–çš„æ–¹æ³•ï¼Œæ–¹å·®ç¨³å®šå˜æ¢æ˜¯åŸºäºè´ŸäºŒé¡¹å›å½’ã€‚è¿™ä¸ªå‡½æ•°åœ¨å¯¹æ•°æ®è¿›è¡Œå‡ä¸€åŒ–çš„åŒæ—¶è¿˜å¯ä»¥å»é™¤çº¿ç²’ä½“çº¢ç»†èƒç­‰æ··æ‚å› ç´ çš„å½±å“ã€‚</span>
<span>ä¼˜ç‚¹ï¼š</span></p><ul><li><span>å¯¹æµ‹åºæ·±åº¦çš„æ ¡æ­£æ•ˆæœè¦å¥½äºlogå½’ä¸€åŒ–ã€‚ï¼ˆ10ä¸‡ä»¥å†…çš„ç»†èƒéƒ½å»ºè®®ä½¿ç”¨SCTæ ‡å‡†åŒ–ï¼‰</span></li><li><span>SCTransformå¯¹æµ‹åºæ·±åº¦çš„æ ¡æ­£æ•ˆæœå¾ˆå¥½ï¼Œä¹Ÿå¯ç”¨äºæ ¡æ­£çº¿ç²’ä½“ç­‰å› ç´ çš„å½±å“ï¼Œä½†ä¸èƒ½ç”¨äºæ‰¹æ¬¡æ ¡æ­£ã€‚</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">NormalizeData</span>(<span class="cm-variable">pbmc</span>) <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">FindVariableFeatures</span>(<span class="cm-variable">nfeatures</span> <span class="cm-operator">=</span> <span class="cm-number">2000</span>) <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">ScaleData</span>(<span class="cm-variable">vars.to.regress</span> <span class="cm-operator">=</span> <span class="cm-string">"percent.mt"</span>))</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SCTransform</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">vars.to.regress</span> <span class="cm-operator">=</span> <span class="cm-string">"percent.mt"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>ä»¥ä¸Šä¸¤è¡Œä»£ç åŠŸèƒ½ç›¸åŒã€‚</span></p><h3 id='æ‰§è¡Œçº¿æ€§é™ç»´'><span>æ‰§è¡Œçº¿æ€§é™ç»´</span></h3><ol start='' ><li><span>PCAä¸»æˆåˆ†åˆ†æ</span>
<span>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹æ ‡å‡†åŒ–åçš„æ•°æ®è¿›è¡ŒPCAåˆ†æã€‚é»˜è®¤çš„ï¼Œåªæ˜¯ç”¨å‰é¢å†³å®šçš„é«˜å˜åŸºå› è¿›è¡ŒPCAåˆ†æï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨featureså‚æ•°è®¾ç½®ç”¨æˆ·è‡ªå·±é€‰æ‹©çš„åŸºå› è¿›è¡ŒPCAåˆ†æã€‚</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunPCA</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">VariableFeatures</span>(<span class="cm-variable">object</span> <span class="cm-operator">=</span> <span class="cm-variable">pbmc</span>))</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Examine and visualize PCA results a few different ways</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">print</span>(<span class="cm-variable">pbmc</span>[[<span class="cm-string">"pca"</span>]], <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">5</span>, <span class="cm-variable">nfeatures</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">VizDimLoadings</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">2</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"pca"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"pca"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><img src="images/2021-10-24-22-13-00.png" referrerpolicy="no-referrer">
<img src="images/2021-10-24-22-13-18.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">### DimHeatmap()å…è®¸æˆ‘ä»¬æ¢ç´¢æ•°æ®ä¸­çš„æœ€åˆçš„å¼‚è´¨æ€§ï¼Œç„¶åå†³å®šä¸‹æ¸¸ä½¿ç”¨å¤šå°‘ä¸ªPCè¿›è¡Œåˆ†æã€‚</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimHeatmap</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>, <span class="cm-variable">cells</span> <span class="cm-operator">=</span> <span class="cm-number">500</span>, <span class="cm-variable">balanced</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimHeatmap</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">15</span>, <span class="cm-variable">cells</span> <span class="cm-operator">=</span> <span class="cm-number">500</span>, <span class="cm-variable">balanced</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><img src="images/2021-10-24-22-13-39.png" referrerpolicy="no-referrer"></p><ol start='2' ><li><span>NMFéè´ŸçŸ©é˜µåˆ†è§£</span></li></ol><p><mark><span>ï¼ˆä¸€èˆ¬åœ¨PCAåå†ä½¿ç”¨NMFï¼Œä½¿å¾—å› å­è§£é‡Šæ€§æ›´é«˜ï¼‰</span></mark>
<br><span>* çŸ©é˜µåˆ†è§£çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œå¦‚å¥‡å¼‚å€¼åˆ†è§£ (singular value decomposition, SVD) ã€ç‹¬ç«‹æˆåˆ†åˆ†æ (independent component analysis, ICA) ã€ä¸»æˆåˆ†åˆ†æ (principal component analysis, PCA) ç­‰ã€‚è¿™äº›æ–¹æ³•çš„å…±åŒç‰¹ç‚¹æ˜¯ï¼Œå³ä½¿åˆå§‹çŸ©é˜µVå…ƒç´ æ˜¯éè´Ÿçš„ï¼Œåˆ†è§£å‡ºæ¥çš„å› å­ W å’Œ H ä¸­çš„å…ƒç´ å¾€å¾€å«æœ‰è´Ÿå€¼å…ƒç´ ã€‚ä»è®¡ç®—ç§‘å­¦çš„è§’åº¦æ¥çœ‹ï¼Œåˆ†è§£å‡ºæ¥çš„å› å­ W å’Œ H ä¸­çš„å…ƒç´ å«æœ‰è´Ÿå€¼å…ƒç´ å¹¶æ²¡æœ‰é—®é¢˜ï¼Œ ä½†è´Ÿå€¼å…ƒç´ é€šå¸¸æ˜¯æ— æ³•è§£é‡Šçš„ã€‚</span>
<br><span>* éè´ŸçŸ©é˜µåˆ†è§£(Non-negative Matrix Factorization, NMF)æœ¬è´¨ä¸Šè¯´æ˜¯ä¸€ç§çŸ©é˜µåˆ†è§£çš„æ–¹æ³•ï¼Œæœ€é‡è¦çš„ç‰¹ç‚¹æ˜¯éè´Ÿæ€§çº¦æŸ,å¯¹äºä»»æ„ç»™å®šçš„ä¸€ä¸ªéè´ŸçŸ©é˜µVï¼ŒNMFç®—æ³•èƒ½å¤Ÿå¯»æ‰¾åˆ°ä¸€ä¸ªéè´ŸçŸ©é˜µWå’Œä¸€ä¸ªéè´ŸçŸ©é˜µHï¼Œä½¿å¾— Vâ‰ˆW</span><em><span>Hæˆç«‹ ï¼Œä»è€Œå°†ä¸€ä¸ªéè´Ÿçš„çŸ©é˜µåˆ†è§£ä¸ºå·¦å³ä¸¤ä¸ªéè´ŸçŸ©é˜µçš„ä¹˜ç§¯ã€‚</span>
<br></em><span> ç›¸æ¯”äºPCAçš„ä¼˜åŠ¿ï¼šè™½ç„¶NMFè¿è¡Œçš„æ—¶é—´æ¯”PCAæ—¶é—´æ›´é•¿ï¼Œä½†å®ƒåˆ†è§£çš„å› å­å¾ˆå®¹æ˜“ä¸ç»†èƒç±»å‹æˆ–è¡¨è¾¾æ¨¡å¼å¯¹åº”èµ·æ¥ï¼Œå³NMFçš„å› å­å¯è§£é‡Šæ€§æ›´å¼ºã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">### å…³äºNMFçš„å‡½æ•°</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">nmf</span>(<span class="cm-variable">x</span>, <span class="cm-variable">rank</span>, <span class="cm-variable">method</span>, <span class="cm-variable">seed</span>, <span class="cm-variable">nrun</span>, <span class="cm-keyword">...</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span>ï¼šå¾…åˆ†è§£éè´ŸçŸ©é˜µï¼Œæ•°æ®æ ¼å¼å¯ä»¥æ˜¯<span class="cm-variable">matrix</span>ï¼Œ<span class="cm-variable">data.frame</span>ï¼Œ <span class="cm-variable">ExpressionSet</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rank</span>ï¼šåˆ†è§£çš„åŸºæ•°é‡ï¼Œå¯¹äºå•ç»†èƒæ•°æ®ï¼Œå¯ä»¥è®¾ç½®ä¸ºæœŸæœ›çš„ç»†èƒç±»å‹æ•°é‡æˆ–è¡¨è¾¾æ¨¡å¼æ•°é‡</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">method</span>ï¼šå› å¼åˆ†è§£çš„å¸¸ç”¨æ–¹æ³•ï¼Œè¿™é‡Œä»‹ç»ä¸‰ç§å¸¸ç”¨çš„</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">1</span>ã€åŸºäº<span class="cm-variable">KL</span> æ•£åº¦è¿›è¡Œåº¦é‡ç›®æ ‡å‡½æ•°çš„å¤šé‡è¿­ä»£æ¢¯åº¦ä¸‹é™ç®—æ³•â€”â€”<span class="cm-variable">brunet</span>(é»˜è®¤ç®—æ³•)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2</span>ã€åŸºäºæ¬§å‡ é‡Œå¾—è·ç¦»åº¦é‡ç›®æ ‡å‡½æ•°çš„å¤šé‡è¿­ä»£æ¢¯åº¦ä¸‹é™ç®—æ³•â€”â€”<span class="cm-variable">lee</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">3</span>ã€äº¤æ›¿æœ€å°äºŒä¹˜æ³•(<span class="cm-variable">Alternating</span> <span class="cm-variable">Least</span> <span class="cm-variable">Squares</span>(<span class="cm-variable">ALS</span>))â€”â€”<span class="cm-variable">snmf</span><span class="cm-operator">/</span><span class="cm-variable">r</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">seed</span>ï¼šå› å¼åˆ†è§£çš„åˆå§‹åŒ–ç§å­ &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">nrun</span>ï¼šè¿è¡Œæ¬¡æ•° </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">è¿è¡Œä»£ç ï¼š</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å®‰è£…NMFåŸºç¡€åŒ…</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">BiocManager</span><span class="cm-operator">::</span><span class="cm-variable">install</span>(<span class="cm-string">'Biobase'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">install.packages</span>(<span class="cm-string">'NMF'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">Seurat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">tidyverse</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">NMF</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rm</span>(<span class="cm-builtin">list</span> <span class="cm-operator">=</span> <span class="cm-variable">ls</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">NormalizeData</span>(<span class="cm-variable">pbmc</span>) <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">FindVariableFeatures</span>() <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">ScaleData</span>(<span class="cm-variable">do.center</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)<span class="cm-comment">###é‡æ–°è¿›è¡Œæ ‡å‡†åŒ–å’Œå½’ä¸€åŒ–ï¼Œè®¾ç½®do.center = Få¯ä»¥ä¸ä¼šå‡ºç°è´Ÿå€¼</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">vm</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pbmc</span>@<span class="cm-variable">assays</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">RNA</span>@<span class="cm-variable">scale.data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">saveRDS</span>(<span class="cm-variable">vm</span>, <span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"pbmc_vm.rds"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">res</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">nmf</span>(<span class="cm-variable">vm</span>, <span class="cm-number">12</span>, <span class="cm-variable">method</span> <span class="cm-operator">=</span> <span class="cm-string">"snmf/r"</span>)<span class="cm-comment">#å¾ˆæ…¢ï¼Œrankå€¼é€‰æ‹©æ¯”ç›®çš„é¢„æœŸçš„ç»†èƒç±»å‹/ç»†èƒçŠ¶æ€ç¨å¤§çš„å€¼ï¼Œå› ä¸ºåˆ†è§£çš„ä¸€äº›å› å­å›å¤å³åˆ°çº¿ç²’ä½“æ ¸ç³–ä½“ç­‰å™ªéŸ³ï¼Œè€Œä¸ä¼šè½åˆ°ä¸€ä¸ªå…·ä½“çš„ç»†èƒäºšç¾¤ä¸Š</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">save</span>(<span class="cm-variable">res</span>, <span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"pbmc_nmf_res.rda"</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## åˆ†è§£ç»“æœè¿”å›sueratå¯¹è±¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span>@<span class="cm-variable">reductions</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">nmf</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pbmc</span>@<span class="cm-variable">reductions</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">pca</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span>@<span class="cm-variable">reductions</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">nmf</span>@<span class="cm-variable">cell.embeddings</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">t</span>(<span class="cm-variable">coef</span>(<span class="cm-variable">res</span>)) &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span>@<span class="cm-variable">reductions</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">nmf</span>@<span class="cm-variable">feature.loadings</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">basis</span>(<span class="cm-variable">res</span>) &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æå–åˆ†è§£å¾—åˆ°çš„æ¯ä¸ªå› å­</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#æ¯ä¸ªå› å­æå–30ä¸ª</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fs</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">extractFeatures</span>(<span class="cm-variable">res</span>, <span class="cm-number">30L</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fs</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">fs</span>, <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) <span class="cm-variable">rownames</span>(<span class="cm-variable">res</span>)[<span class="cm-variable">x</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fs</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">do.call</span>(<span class="cm-string">"rbind"</span>, <span class="cm-variable">fs</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rownames</span>(<span class="cm-variable">fs</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">paste0</span>(<span class="cm-string">"cluster"</span>, <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">12</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">write.csv</span>(<span class="cm-variable">t</span>(<span class="cm-variable">fs</span>), <span class="cm-string">"NMF_TopGenes. csv"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DT</span><span class="cm-operator">::</span><span class="cm-variable">datatable</span>(<span class="cm-variable">t</span>(<span class="cm-variable">fs</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># é€‰æ‹©ç”¨äºåç»­åˆ†æçš„å› å­ï¼Œä½¿ç”¨NMFè¿è¡Œçš„ç»“æœè¿›è¡Œé™ç»´èšç±»</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">###é€‰æ‹©ç”¨äºåç»­åˆ†æçš„å› å­</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">s.f</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">12</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#å› å­1ä¸»è¦æ˜¯çº¿ç²’ä½“å’Œæ ¸ç³–ä½“</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##é™ç»´</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cell1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">colnames</span>(<span class="cm-variable">pbmc</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cel12</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">colnames</span>(<span class="cm-variable">coef</span>(<span class="cm-variable">res</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cells</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">intersect</span>(<span class="cm-variable">cell1</span>, <span class="cm-variable">cel12</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span><span class="cm-operator cm-arrow">&lt;&lt;-</span><span class="cm-variable">pbmc</span>[,<span class="cm-variable">cells</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunPCA</span>(<span class="cm-variable">pbmc</span>,<span class="cm-variable">verbose</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span>@<span class="cm-variable">reductions</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">nmf</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pbmc</span>@<span class="cm-variable">reductions</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">pca</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span>@<span class="cm-variable">reductions</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">nmf</span>@<span class="cm-variable">cell.embeddings</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">t</span>(<span class="cm-variable">coef</span>(<span class="cm-variable">res</span>)[,<span class="cm-variable">cells</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span>@<span class="cm-variable">reductions</span> <span class="cm-operator cm-dollar">$</span><span class="cm-variable">nmf</span>@<span class="cm-variable">feature.loadings</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">basis</span>(<span class="cm-variable">res</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunUMAP</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">reduction</span><span class="cm-operator">=</span> <span class="cm-string">'nmf'</span>,<span class="cm-variable">dims</span><span class="cm-operator">=</span><span class="cm-variable">s.f</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##åŸºäºNMFé™ç»´çŸ©é˜µçš„èšç±»</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindNeighbors</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">reduction</span><span class="cm-operator">=</span> <span class="cm-string">'nmf'</span>, <span class="cm-variable">dims</span><span class="cm-operator">=</span><span class="cm-variable">s.f</span>) <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">FindClusters</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##åŸºäºå› å­æœ€å¤§è½½è·åˆ†ç±»</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cluster</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">apply</span>(<span class="cm-variable">NMF</span><span class="cm-operator">::</span><span class="cm-variable">coefficients</span>(<span class="cm-variable">res</span>)[<span class="cm-variable">s.f</span>,], <span class="cm-number">2</span>,<span class="cm-variable">which.max</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># é™ç»´èšç±»ç»“æœå¯è§†åŒ–</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>) <span class="cm-operator">+</span> <span class="cm-variable">ggtitle</span>(<span class="cm-string">"Clustered by Louvain"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-string">"cluster"</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>) <span class="cm-operator">+</span> <span class="cm-variable">ggtitle</span>(<span class="cm-string">"Clustered by maxloading"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">p1</span><span class="cm-operator">|</span><span class="cm-variable">p2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"</span> <span class="cm-string">pbmc_NMF_Cluster.pdf"</span>, <span class="cm-variable">pc</span>, <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1430px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1430px;"></div></div></div></pre><h3 id='ç¡®å®šæ•°æ®é›†çš„ç»´åº¦'><span>ç¡®å®šæ•°æ®é›†çš„â€œç»´åº¦â€</span></h3><p><span>ä¸ºäº†å…‹æœ scRNA-seq æ•°æ®çš„ä»»ä½•å•ä¸ªç‰¹å¾ä¸­çš„å¹¿æ³›æŠ€æœ¯å™ªéŸ³ï¼ŒSeurat æ ¹æ®å…¶ PCA åˆ†æ•°å¯¹ç»†èƒè¿›è¡Œèšç±»ï¼Œæ¯ä¸ª PC åŸºæœ¬ä¸Šä»£è¡¨ä¸€ä¸ªâ€œç»¼åˆç‰¹å¾â€ï¼Œè¯¥â€œç»¼åˆç‰¹å¾â€ç»„åˆäº†ç›¸å…³ç‰¹å¾é›†çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œé¡¶éƒ¨ä¸»æˆåˆ†ä»£è¡¨æ•°æ®é›†çš„ç¨³å¥å‹ç¼©çš„ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬åº”è¯¥é€‰æ‹©å¤šå°‘ä¸ªPCè¿›è¡Œåˆ†æï¼Ÿ</span></p><ol start='' ><li><span>JackStraw ç¨‹åºå¯å‘çš„é‡é‡‡æ ·æµ‹è¯•ã€‚æˆ‘ä»¬éšæœºç½®æ¢æ•°æ®çš„ä¸€ä¸ªå­é›†ï¼ˆé»˜è®¤ä¸º 1%ï¼‰å¹¶é‡æ–°è¿è¡Œ PCAï¼Œæ„å»ºç‰¹å¾åˆ†æ•°çš„â€œé›¶åˆ†å¸ƒâ€ï¼Œå¹¶é‡å¤æ­¤è¿‡ç¨‹ã€‚æˆ‘ä»¬å°†â€œæ˜¾ç€â€PC è¯†åˆ«ä¸ºé‚£äº›å…·æœ‰å¤§é‡ä½ p å€¼ç‰¹å¾çš„ PCã€‚</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># NOTE: This process can take a long time for big datasets, comment out for expediency. More</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># approximate techniques such as those implemented in ElbowPlot() can be used to reduce</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># computation time</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">JackStraw</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">num.replicate</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">ScoreJackStraw</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">20</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><ol start='2' ><li><span>è¯¥JackStrawPlot()å‡½æ•°æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–å·¥å…·ï¼Œç”¨äºå°†æ¯ä¸ª PC çš„ p å€¼åˆ†å¸ƒä¸å‡åŒ€åˆ†å¸ƒï¼ˆè™šçº¿ï¼‰è¿›è¡Œæ¯”è¾ƒã€‚â€œæ˜¾è‘—â€PC å°†æ˜¾ç¤ºå‡ºå¤§é‡å…·æœ‰ä½ p å€¼çš„ç‰¹å¾ï¼ˆè™šçº¿ä¸Šæ–¹çš„å®çº¿ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨å‰ 10-12 ä¸ª PC ä¹‹åï¼Œé‡è¦æ€§ä¼¼ä¹æ€¥å‰§ä¸‹é™ã€‚</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">JackStrawPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">15</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><img src="images/2021-10-24-22-18-04.png" referrerpolicy="no-referrer"></p><ol start='3' ><li><span>è‚˜å›¾ï¼ˆç¢çŸ³å›¾ï¼‰ï¼šåŸºäºæ¯ä¸ªï¼ˆElbowPlot()å‡½æ•°ï¼‰è§£é‡Šçš„æ–¹å·®ç™¾åˆ†æ¯”å¯¹ä¸»æˆåˆ†è¿›è¡Œæ’åã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ° PC9-10 å‘¨å›´çš„â€œè‚˜éƒ¨â€ï¼Œè¿™è¡¨æ˜å¤§éƒ¨åˆ†çœŸå®ä¿¡å·æ˜¯åœ¨å‰ 10 ä¸ª PC ä¸­æ•è·çš„ã€‚</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ElbowPlot</span>(<span class="cm-variable">pbmc</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><img src="images/2021-10-24-22-18-34.png" referrerpolicy="no-referrer"></p><h3 id='ç»†èƒå‘¨æœŸè¯„åˆ†å’Œå›å½’é€‰æ‹©'><span>ç»†èƒå‘¨æœŸè¯„åˆ†å’Œå›å½’(é€‰æ‹©)</span></h3><ol start='' ><li><span>åˆ†é…ç»†èƒå‘¨æœŸåˆ†æ•°</span>
<mark><span>å¦‚ä½•é€šè¿‡åŸºäºè§„èŒƒæ ‡è®°è®¡ç®—ç»†èƒå‘¨æœŸé˜¶æ®µåˆ†æ•°å¹¶åœ¨é¢„å¤„ç†æœŸé—´å°†è¿™äº›ä»æ•°æ®ä¸­å›å½’æ¥å‡è½» scRNA-seq æ•°æ®ä¸­ç»†èƒå‘¨æœŸå¼‚è´¨æ€§çš„å½±å“ã€‚</span></mark>
<span>åœ¨å°é¼ é€ è¡€ç¥–ç»†èƒæ•°æ®é›†ä¸Šæ¼”ç¤ºäº†è¿™ä¸€ç‚¹ï¼ˆ</span><a href='http://www.bloodjournal.org/content/early/2016/06/30/blood-2016-05-716480?sso-checked=true'><span>Nestorowa</span><em><span>ç­‰äºº</span></em><span>ï¼ŒBlood 2016 ï¼‰ã€‚å¯ä»¥åœ¨</span></a><a href='https://www.dropbox.com/s/3dby3bjsaf5arrw/cell_cycle_vignette_files.zip?dl=1'><span>æ­¤å¤„</span></a><span>ä¸‹è½½è¿è¡Œæ­¤å°æ’æ›²æ‰€éœ€çš„æ–‡ä»¶ã€‚</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">Seurat</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Read in the expression matrix The first row is a header row, the first column is rownames</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">exp.mat</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.table</span>(<span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"../data/nestorawa_forcellcycle_expressionMatrix.txt"</span>, <span class="cm-variable">header</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">as.is</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>, <span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># A list of cell cycle markers, from Tirosh et al, 2015, is loaded with Seurat.  We can</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># segregate this list into markers of G2/M phase and markers of S phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">s.genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cc.genes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">s.genes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">g2m.genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cc.genes</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">g2m.genes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Create our Seurat object and complete the initalization steps</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CreateSeuratObject</span>(<span class="cm-variable">counts</span> <span class="cm-operator">=</span> <span class="cm-variable">exp.mat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">NormalizeData</span>(<span class="cm-variable">marrow</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindVariableFeatures</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">selection.method</span> <span class="cm-operator">=</span> <span class="cm-string">"vst"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">ScaleData</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">marrow</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 418px;"></div><div class="CodeMirror-gutters" style="display: none; height: 418px;"></div></div></div></pre><p><span>å¦‚æœæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„Seuratobjectä¸Šè¿è¡Œ PCAï¼Œä½¿ç”¨æˆ‘ä»¬åœ¨ä¸Šé¢æ‰¾åˆ°çš„å¯å˜åŸºå› </span><code>[FindVariableFeatures()](https://satijalab.org/seurat/reference/FindVariableFeatures.html)</code><span>ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è™½ç„¶å¤§å¤šæ•°å·®å¼‚å¯ä»¥ç”¨è°±ç³»æ¥è§£é‡Šï¼Œä½† PC8 å’Œ PC10 åœ¨åŒ…æ‹¬</span><em><span>TOP2A</span></em><span>å’Œ</span><em><span>MKI67</span></em><span>åœ¨å†…çš„ç»†èƒå‘¨æœŸåŸºå› ä¸Šåˆ†è£‚ã€‚æˆ‘ä»¬å°†å°è¯•ä»æ•°æ®ä¸­å›å½’æ­¤ä¿¡å·ï¼Œä»¥ä¾¿ç»†èƒå‘¨æœŸå¼‚è´¨æ€§ä¸ä¼šæœ‰åŠ©äº PCA æˆ–ä¸‹æ¸¸åˆ†æã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunPCA</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">VariableFeatures</span>(<span class="cm-variable">marrow</span>), <span class="cm-variable">ndims.print</span> <span class="cm-operator">=</span> <span class="cm-number">6</span><span class="cm-operator">:</span><span class="cm-number">10</span>, <span class="cm-variable">nfeatures.print</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimHeatmap</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-number">8</span>, <span class="cm-number">10</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><img src="images/justification-1.png" referrerpolicy="no-referrer"></p><p><span>é¦–å…ˆï¼Œæˆ‘ä»¬</span><mark><span>æ ¹æ®å…¶ G2/M å’Œ S æœŸæ ‡è®°çš„è¡¨è¾¾ä¸ºæ¯ä¸ªç»†èƒåˆ†é…ä¸€ä¸ªåˆ†æ•°ã€‚</span></mark><span>è¿™äº›æ ‡è®°ç»„çš„è¡¨è¾¾æ°´å¹³åº”è¯¥æ˜¯åç›¸å…³çš„ï¼Œè¡¨è¾¾ä¸¤è€…çš„ç»†èƒå¯èƒ½ä¸ä¼šå¾ªç¯å¹¶å¤„äº G1 æœŸã€‚</span>
<span>æˆ‘ä»¬åœ¨å‡½æ•°ä¸­åˆ†é…åˆ†æ•°ï¼Œè¯¥</span><code>[CellCycleScoring()](https://satijalab.org/seurat/reference/CellCycleScoring.html)</code><span>å‡½æ•°å°† S å’Œ G2/M åˆ†æ•°å­˜å‚¨åœ¨å¯¹è±¡å…ƒæ•°æ®ä¸­ï¼Œä»¥åŠæ¯ä¸ªç»†èƒåœ¨ G2Mã€S æˆ– G1 é˜¶æ®µçš„é¢„æµ‹åˆ†ç±»ã€‚</span><code>[CellCycleScoring()](https://satijalab.org/seurat/reference/CellCycleScoring.html)</code><span>è¿˜å¯ä»¥é€šè¿‡ä¼ é€’å°†Seuratå¯¹è±¡çš„èº«ä»½è®¾ç½®ä¸ºç»†èƒå‘¨æœŸé˜¶æ®µ</span><code>set.ident = TRUE</code><span>ï¼ˆåŸå§‹èº«ä»½å­˜å‚¨ä¸º</span><code>old.ident</code><span>ï¼‰ã€‚è¯·æ³¨æ„ï¼ŒSeurat åœ¨ä¸‹æ¸¸ç»†èƒå‘¨æœŸå›å½’ä¸­ä¸ä½¿ç”¨ç¦»æ•£åˆ†ç±» (G2M/G1/S)ã€‚ç›¸åï¼Œå®ƒä½¿ç”¨ G2M å’Œ S é˜¶æ®µçš„å®šé‡åˆ†æ•°ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬ä¼šæä¾›æˆ‘ä»¬çš„é¢„æµ‹åˆ†ç±»ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CellCycleScoring</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">s.features</span> <span class="cm-operator">=</span> <span class="cm-variable">s.genes</span>, <span class="cm-variable">g2m.features</span> <span class="cm-operator">=</span> <span class="cm-variable">g2m.genes</span>, <span class="cm-variable">set.ident</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># view cell cycle scores and phase assignments</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">head</span>(<span class="cm-variable">marrow</span>[[]])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Visualize the distribution of cell cycle markers across</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">RidgePlot</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"PCNA"</span>, <span class="cm-string">"TOP2A"</span>, <span class="cm-string">"MCM6"</span>, <span class="cm-string">"MKI67"</span>), <span class="cm-variable">ncol</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><img src="images/cc_score-1.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Running a PCA on cell cycle genes reveals, unsurprisingly, that cells separate entirely by</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunPCA</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-variable">s.genes</span>, <span class="cm-variable">g2m.genes</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">marrow</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><img src="images/cc_score-2.png" referrerpolicy="no-referrer"></p><ol start='2' ><li><span>åœ¨æ•°æ®ç¼©æ”¾æœŸé—´å›å½’ç»†èƒå‘¨æœŸåˆ†æ•°</span>
<span>ç°åœ¨å°è¯•ä»æ•°æ®ä¸­å‡å»ï¼ˆâ€œå›å½’â€ï¼‰è¿™ç§å¼‚è´¨æ€§æ¥æºã€‚å¯¹äº Seurat v1.4 çš„ç”¨æˆ·ï¼Œè¿™æ˜¯åœ¨</span><code>RegressOut</code><span>.Â ä½†æ˜¯ï¼Œç”±äºæ­¤è¿‡ç¨‹çš„ç»“æœå­˜å‚¨åœ¨ç¼©æ”¾çš„æ•°æ®æ§½ä¸­ï¼ˆå› æ­¤ä¼šè¦†ç›– çš„è¾“å‡º</span><code>[ScaleData()](https://satijalab.org/seurat/reference/ScaleData.html)</code><span>ï¼‰ï¼Œæˆ‘ä»¬ç°åœ¨å°†æ­¤åŠŸèƒ½åˆå¹¶åˆ°</span><code>[ScaleData()](https://satijalab.org/seurat/reference/ScaleData.html)</code><span>å‡½æ•°æœ¬èº«ä¸­ã€‚</span>
<mark><span>å¯¹äºæ¯ä¸ªåŸºå› ï¼ŒSeurat æ¨¡æ‹Ÿäº†åŸºå› è¡¨è¾¾ä¸ S å’Œ G2M ç»†èƒå‘¨æœŸè¯„åˆ†ä¹‹é—´çš„å…³â€‹â€‹ç³»ã€‚è¯¥æ¨¡å‹çš„ç¼©æ”¾æ®‹å·®ä»£è¡¨ä¸€ä¸ªâ€œæ ¡æ­£çš„â€è¡¨è¾¾çŸ©é˜µï¼Œå¯ç”¨äºä¸‹æ¸¸é™ç»´ã€‚</span></mark></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">ScaleData</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">vars.to.regress</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"S.Score"</span>, <span class="cm-string">"G2M.Score"</span>), <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">marrow</span>))</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Now, a PCA on the variable genes no longer returns components associated with cell cycle</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunPCA</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">VariableFeatures</span>(<span class="cm-variable">marrow</span>), <span class="cm-variable">nfeatures.print</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># When running a PCA on only cell cycle genes, cells no longer separate by cell-cycle phase</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunPCA</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-variable">s.genes</span>, <span class="cm-variable">g2m.genes</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">marrow</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p><img src="images/pca3-1.png" referrerpolicy="no-referrer"></p><ol start='3' ><li><span>å¤‡ç”¨å·¥ä½œæµç¨‹</span>
<span>ä¸Šè¿°ç¨‹åºåˆ é™¤äº†ä¸ç»†èƒå‘¨æœŸç›¸å…³çš„æ‰€æœ‰ä¿¡å·ã€‚</span><strong><span>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‘ç°è¿™ä¼šå¯¹ä¸‹æ¸¸åˆ†æäº§ç”Ÿè´Ÿé¢å½±å“ï¼Œå°¤å…¶æ˜¯åœ¨å¹²ç»†èƒå¤„äºé™æ­¢çŠ¶æ€è€Œåˆ†åŒ–ç»†èƒæ­£åœ¨å¢æ®–ï¼ˆåä¹‹äº¦ç„¶ï¼‰çš„åˆ†åŒ–è¿‡ç¨‹ï¼ˆå¦‚å°é¼ é€ è¡€ï¼‰ä¸­ã€‚</span></strong><span> </span><em><span>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¶ˆé™¤æ‰€æœ‰ç»†èƒå‘¨æœŸæ•ˆåº”ä¹Ÿä¼šæ¨¡ç³Šå¹²ç»†èƒå’Œç¥–ç»†èƒä¹‹é—´çš„åŒºåˆ«ã€‚</span></em>
<mark><span>ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼Œæˆ‘ä»¬å»ºè®®å›å½’G2M å’Œ S é˜¶æ®µåˆ†æ•°ä¹‹é—´çš„</span><strong><span>å·®å¼‚ã€‚</span></strong></mark><span>è¿™æ„å‘³ç€å°†ä¿æŒåˆ†ç¦»éå¾ªç¯ç»†èƒå’Œå¾ªç¯ç»†èƒçš„ä¿¡å·ï¼Œä½†å¢æ®–ç»†èƒä¹‹é—´çš„ç»†èƒå‘¨æœŸé˜¶æ®µå·®å¼‚ï¼ˆé€šå¸¸æ˜¯æ— è¶£çš„ï¼‰å°†ä»æ•°æ®ä¸­å›å½’ã€‚</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">CC.Difference</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">marrow</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">S.Score</span> <span class="cm-operator">-</span> <span class="cm-variable">marrow</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">G2M.Score</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">ScaleData</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">vars.to.regress</span> <span class="cm-operator">=</span> <span class="cm-string">"CC.Difference"</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">marrow</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># cell cycle effects strongly mitigated in PCA</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunPCA</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">VariableFeatures</span>(<span class="cm-variable">marrow</span>), <span class="cm-variable">nfeatures.print</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># when running a PCA on cell cycle genes, actively proliferating cells remain distinct from G1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># cells however, within actively proliferating cells, G2M and S phase cells group together</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marrow</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunPCA</span>(<span class="cm-variable">marrow</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-variable">s.genes</span>, <span class="cm-variable">g2m.genes</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">marrow</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><img src="images/pca5-1.png" referrerpolicy="no-referrer"></p><h2 id='æ•´åˆå¤šä¸ªscrna-seqæ•°æ®é›†'><span>æ•´åˆå¤šä¸ªscRNA-seqæ•°æ®é›†</span></h2><hr /><h4 id='ä¸seuratæ ‡å‡†å¤„ç†æµç¨‹ä¸€è‡´'><span>ä¸seuratæ ‡å‡†å¤„ç†æµç¨‹ä¸€è‡´</span></h4><p><mark><span>ä¸¤ä¸ªæˆ–å¤šä¸ªå•ç»†èƒæ•°æ®é›†çš„è”åˆåˆ†æã€‚</span></mark><span>åœ¨æ ‡å‡†å·¥ä½œæµç¨‹ä¸‹ï¼Œè¯†åˆ«å­˜åœ¨äºå¤šä¸ªæ•°æ®é›†ä¸­çš„ç»†èƒç¾¤å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚Seurat v4 åŒ…æ‹¬ä¸€ç»„æ–¹æ³•æ¥åŒ¹é…ï¼ˆæˆ–â€œå¯¹é½â€ï¼‰è·¨æ•°æ®é›†çš„å…±äº«ç»†èƒç¾¤ã€‚è¿™äº›æ–¹æ³•é¦–å…ˆè¯†åˆ«å¤„äºåŒ¹é…ç”Ÿç‰©å­¦çŠ¶æ€ï¼ˆâ€œé”šâ€ï¼‰çš„è·¨æ•°æ®é›†ç»†èƒå¯¹ï¼Œæ—¢å¯ç”¨äºæ ¡æ­£æ•°æ®é›†ä¹‹é—´çš„æŠ€æœ¯å·®å¼‚ï¼ˆå³æ‰¹é‡æ•ˆåº”æ ¡æ­£ï¼‰ï¼Œä¹Ÿå¯ç”¨äºè¿›è¡Œæ¯”è¾ƒçš„ scRNA-seq åˆ†æè·¨å®éªŒæ¡ä»¶ã€‚</span></p><p><span>æˆ‘ä»¬å±•ç¤ºäº†</span><a href='https://www.cell.com/cell/fulltext/S0092-8674(19)30559-8'><span>Stuart</span><em><span>ã€Butler</span></em><span> ç­‰äºº 2019 å¹´</span></a><span>æ‰€è¿°çš„ scRNA-seq æ•´åˆæ–¹æ³•ï¼Œä»¥å¯¹å¤„äº</span><a href='https://www.nature.com/articles/nbt.4042'><span>é™æ¯æˆ–å¹²æ‰°ç´ åˆºæ¿€çŠ¶æ€</span></a><span>çš„äººç±»å…ç–«ç»†èƒ (PBMC) è¿›è¡Œæ¯”è¾ƒåˆ†æã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Setup the Seurat objects</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">Seurat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">SeuratData</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">patchwork</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># load dataset</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">LoadData</span>(<span class="cm-string">"ifnb"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># load seurat data(a sample)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dir</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">dir</span>(<span class="cm-string">"data/"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dir</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">paste0</span>(<span class="cm-string">"data/"</span>, <span class="cm-variable">dir</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">samples_name</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">'ctrl'</span>, <span class="cm-string">'stim'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##ä½¿ç”¨å¾ªç¯å‘½ä»¤æ‰¹é‡åˆ›å»ºseuratå¯¹è±¡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scRNAlist</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-builtin">list</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-variable">length</span>(<span class="cm-variable">dir</span>)){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Insufficient data values to produce 24 bins.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">counts</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">Read10X</span>(<span class="cm-variable">data.dir</span> <span class="cm-operator">=</span> <span class="cm-variable">dir</span>[<span class="cm-variable">i</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scRNAlist</span>[[<span class="cm-variable">i</span>]] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">Read10X</span>(<span class="cm-variable">data.dir</span> <span class="cm-operator">=</span> <span class="cm-variable">dir</span>[<span class="cm-variable">i</span>]) <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">CreateSeuratObject</span>(<span class="cm-variable">project</span><span class="cm-operator">=</span><span class="cm-variable">samples_name</span>[<span class="cm-variable">i</span>],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">#min.cells=3,#å¯ä»¥æŒ‡å®šæ¯ä¸ªæ ·æœ¬æœ€å°‘çš„ç»†èƒæ•°ç›®</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">min.features</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#ç»™ç»†èƒbarcodeåŠ ä¸ªå‰ç¼€ï¼Œé˜²æ­¢åˆå¹¶åbarcodeé‡å</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">scRNAlist</span>[[<span class="cm-variable">i</span>]] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RenameCells</span>(<span class="cm-variable">scRNAlist</span>[[<span class="cm-variable">i</span>]], <span class="cm-variable">add.cell.id</span> <span class="cm-operator">=</span> <span class="cm-variable">samples_name</span>[<span class="cm-variable">i</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#ç»™åˆ—è¡¨å‘½åå¹¶ä¿å­˜æ•°æ®</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">names</span>(<span class="cm-variable">scRNAlist</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">samples_name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æ£€æŸ¥åˆå¹¶çš„å¯¹è±¡æ˜¯å¦å…·æœ‰é€‚å½“çš„ç‰¹å®šäºæ ·æœ¬çš„å‰ç¼€</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">head</span>(<span class="cm-variable">scRNAlist</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">ctrl</span>@<span class="cm-variable">meta.data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">head</span>(<span class="cm-variable">scRNAlist</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">stim</span>@<span class="cm-variable">meta.data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># split the dataset into a list of two seurat objects (stim and CTRL)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ifnb.list</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SplitObject</span>(<span class="cm-variable">ifnb</span>, <span class="cm-variable">split.by</span> <span class="cm-operator">=</span> <span class="cm-string">"stim"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># normalize and identify variable features for each dataset independently</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ifnb.list</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">X</span> <span class="cm-operator">=</span> <span class="cm-variable">ifnb.list</span>, <span class="cm-variable">FUN</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-variable">x</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">NormalizeData</span>(<span class="cm-variable">x</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindVariableFeatures</span>(<span class="cm-variable">x</span>, <span class="cm-variable">selection.method</span> <span class="cm-operator">=</span> <span class="cm-string">"vst"</span>, <span class="cm-variable">nfeatures</span> <span class="cm-operator">=</span> <span class="cm-number">2000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># select features that are repeatedly variable across datasets for integration</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">features</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SelectIntegrationFeatures</span>(<span class="cm-variable">object.list</span> <span class="cm-operator">=</span> <span class="cm-variable">ifnb.list</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Perform integration</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.anchors</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindIntegrationAnchors</span>(<span class="cm-variable">object.list</span> <span class="cm-operator">=</span> <span class="cm-variable">ifnb.list</span>, <span class="cm-variable">anchor.features</span> <span class="cm-operator">=</span> <span class="cm-variable">features</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># this command creates an 'integrated' data assay</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.combined</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">IntegrateData</span>(<span class="cm-variable">anchorset</span> <span class="cm-operator">=</span> <span class="cm-variable">immune.anchors</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Perform an integrated analysis</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># specify that we will perform downstream analysis on the corrected data note that the</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># original unmodified data still resides in the 'RNA' assay</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DefaultAssay</span>(<span class="cm-variable">immune.combined</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"integrated"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Run the standard workflow for visualization and clustering</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.combined</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">ScaleData</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">verbose</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.combined</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunPCA</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">npcs</span> <span class="cm-operator">=</span> <span class="cm-number">30</span>, <span class="cm-variable">verbose</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.combined</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunUMAP</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"pca"</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">30</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.combined</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindNeighbors</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"pca"</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">30</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.combined</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindClusters</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">resolution</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Visualization</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"umap"</span>, <span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-string">"stim"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"umap"</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>, <span class="cm-variable">repel</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator">+</span> <span class="cm-variable">p2</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1452px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1452px;"></div></div></div></pre><p><img src="images/viz-1.png" referrerpolicy="no-referrer"></p><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"umap"</span>, <span class="cm-variable">split.by</span> <span class="cm-operator">=</span> <span class="cm-string">"stim"</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><img src="images/split.dim-1.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Identify conserved cell type markers</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># For performing differential expression after integration, we switch back to the original</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DefaultAssay</span>(<span class="cm-variable">immune.combined</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"RNA"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">nk.markers</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindConservedMarkers</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">ident.1</span> <span class="cm-operator">=</span> <span class="cm-number">6</span>, <span class="cm-variable">grouping.var</span> <span class="cm-operator">=</span> <span class="cm-string">"stim"</span>, <span class="cm-variable">verbose</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">head</span>(<span class="cm-variable">nk.markers</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FeaturePlot</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"CD3D"</span>, <span class="cm-string">"SELL"</span>, <span class="cm-string">"CREM"</span>, <span class="cm-string">"CD8A"</span>, <span class="cm-string">"GNLY"</span>, <span class="cm-string">"CD79A"</span>, <span class="cm-string">"FCGR3A"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"CCL2"</span>, <span class="cm-string">"PPBP"</span>), <span class="cm-variable">min.cutoff</span> <span class="cm-operator">=</span> <span class="cm-string">"q9"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><p><span>è¯¥æ­¥éª¤ä¸ºäº†</span><mark><span>è¯†åˆ«è·¨æ¡ä»¶ä¿å®ˆçš„å…¸å‹ç»†èƒç±»å‹æ ‡è®°åŸºå› </span></mark><span>mark&gt;ï¼Œæˆ‘ä»¬æä¾›äº†è¯¥</span><code>FindConservedMarkers()</code><span>åŠŸèƒ½ã€‚æ­¤å‡½æ•°å¯¹æ¯ä¸ªæ•°æ®é›†/ç»„æ‰§è¡Œå·®å¼‚åŸºå› è¡¨è¾¾æµ‹è¯•ï¼Œå¹¶ä½¿ç”¨ MetaDE R åŒ…ä¸­çš„å…ƒåˆ†ææ–¹æ³•ç»„åˆ p å€¼ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—åœ¨ç°‡ 6ï¼ˆNK ç»†èƒï¼‰ä¸­æ— è®ºåˆºæ¿€æ¡ä»¶å¦‚ä½•éƒ½æ˜¯ä¿å®ˆæ ‡è®°çš„åŸºå› ã€‚</span></p><p><img src="images/annotate-1.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.combined</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RenameIdents</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable-3">`0`</span> <span class="cm-operator">=</span> <span class="cm-string">"CD14 Mono"</span>, <span class="cm-variable-3">`1`</span> <span class="cm-operator">=</span> <span class="cm-string">"CD4 Naive T"</span>, <span class="cm-variable-3">`2`</span> <span class="cm-operator">=</span> <span class="cm-string">"CD4 Memory T"</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">`3`</span> <span class="cm-operator">=</span> <span class="cm-string">"CD16 Mono"</span>, <span class="cm-variable-3">`4`</span> <span class="cm-operator">=</span> <span class="cm-string">"B"</span>, <span class="cm-variable-3">`5`</span> <span class="cm-operator">=</span> <span class="cm-string">"CD8 T"</span>, <span class="cm-variable-3">`6`</span> <span class="cm-operator">=</span> <span class="cm-string">"NK"</span>, <span class="cm-variable-3">`7`</span> <span class="cm-operator">=</span> <span class="cm-string">"T activated"</span>, <span class="cm-variable-3">`8`</span> <span class="cm-operator">=</span> <span class="cm-string">"DC"</span>, <span class="cm-variable-3">`9`</span> <span class="cm-operator">=</span> <span class="cm-string">"B Activated"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">`10`</span> <span class="cm-operator">=</span> <span class="cm-string">"Mk"</span>, <span class="cm-variable-3">`11`</span> <span class="cm-operator">=</span> <span class="cm-string">"pDC"</span>, <span class="cm-variable-3">`12`</span> <span class="cm-operator">=</span> <span class="cm-string">"Eryth"</span>, <span class="cm-variable-3">`13`</span> <span class="cm-operator">=</span> <span class="cm-string">"Mono/Mk Doublets"</span>, <span class="cm-variable-3">`14`</span> <span class="cm-operator">=</span> <span class="cm-string">"HSPC"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><img src="images/annotate-2.png" referrerpolicy="no-referrer"></p><p><code>DotPlot()</code><span>å¸¦æœ‰</span><code>split.by</code><span>å‚æ•°çš„å‡½æ•°å¯ç”¨äºæŸ¥çœ‹è·¨æ¡ä»¶çš„ä¿å®ˆç»†èƒç±»å‹æ ‡è®°ï¼Œæ˜¾ç¤ºè¡¨è¾¾æ°´å¹³å’Œè¡¨è¾¾ä»»ä½•ç»™å®šåŸºå› çš„ç°‡ä¸­ç»†èƒçš„ç™¾åˆ†æ¯”ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸º 14 ä¸ªèšç±»ä¸­çš„æ¯ä¸€ä¸ªç»˜åˆ¶äº† 2-3 ä¸ªå¼ºæ ‡è®°åŸºå› ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Idents</span>(<span class="cm-variable">immune.combined</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">factor</span>(<span class="cm-variable">Idents</span>(<span class="cm-variable">immune.combined</span>), <span class="cm-variable">levels</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"HSPC"</span>, <span class="cm-string">"Mono/Mk Doublets"</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"pDC"</span>, <span class="cm-string">"Eryth"</span>, <span class="cm-string">"Mk"</span>, <span class="cm-string">"DC"</span>, <span class="cm-string">"CD14 Mono"</span>, <span class="cm-string">"CD16 Mono"</span>, <span class="cm-string">"B Activated"</span>, <span class="cm-string">"B"</span>, <span class="cm-string">"CD8 T"</span>, <span class="cm-string">"NK"</span>, <span class="cm-string">"T activated"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"CD4 Naive T"</span>, <span class="cm-string">"CD4 Memory T"</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">markers.to.plot</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">c</span>(<span class="cm-string">"CD3D"</span>, <span class="cm-string">"CREM"</span>, <span class="cm-string">"HSPH1"</span>, <span class="cm-string">"SELL"</span>, <span class="cm-string">"GIMAP5"</span>, <span class="cm-string">"CACYBP"</span>, <span class="cm-string">"GNLY"</span>, <span class="cm-string">"NKG7"</span>, <span class="cm-string">"CCL5"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"CD8A"</span>, <span class="cm-string">"MS4A1"</span>, <span class="cm-string">"CD79A"</span>, <span class="cm-string">"MIR155HG"</span>, <span class="cm-string">"NME1"</span>, <span class="cm-string">"FCGR3A"</span>, <span class="cm-string">"VMO1"</span>, <span class="cm-string">"CCL2"</span>, <span class="cm-string">"S100A9"</span>, <span class="cm-string">"HLA-DQA1"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"GPR183"</span>, <span class="cm-string">"PPBP"</span>, <span class="cm-string">"GNG11"</span>, <span class="cm-string">"HBA2"</span>, <span class="cm-string">"HBB"</span>, <span class="cm-string">"TSPAN13"</span>, <span class="cm-string">"IL3RA"</span>, <span class="cm-string">"IGJ"</span>, <span class="cm-string">"PRSS57"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DotPlot</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">markers.to.plot</span>, <span class="cm-variable">cols</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"blue"</span>, <span class="cm-string">"red"</span>), <span class="cm-variable">dot.scale</span> <span class="cm-operator">=</span> <span class="cm-number">8</span>, <span class="cm-variable">split.by</span> <span class="cm-operator">=</span> <span class="cm-string">"stim"</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">RotatedAxis</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><img src="images/splitdotplot-1.png" referrerpolicy="no-referrer"></p><ul><li><span>è·¨æ¡ä»¶è¯†åˆ«å·®å¼‚è¡¨è¾¾åŸºå› </span></li></ul><p><span>ç°åœ¨æˆ‘ä»¬å·²ç»å¯¹é½äº†å—åˆºæ¿€å’Œæ§åˆ¶ç»†èƒï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹è¿›è¡Œæ¯”è¾ƒåˆ†æå¹¶æŸ¥çœ‹åˆºæ¿€å¼•èµ·çš„å·®å¼‚ã€‚å¹¿æ³›è§‚å¯Ÿè¿™äº›å˜åŒ–çš„ä¸€ç§æ–¹æ³•æ˜¯ç»˜åˆ¶å—åˆºæ¿€ç»†èƒå’Œå¯¹ç…§ç»†èƒçš„å¹³å‡è¡¨è¾¾ï¼Œå¹¶åœ¨æ•£ç‚¹å›¾ä¸Šå¯»æ‰¾è§†è§‰å¼‚å¸¸å€¼çš„åŸºå› ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å–å—åˆºæ¿€å’Œå¯¹ç…§å¹¼ç¨š T ç»†èƒå’Œ CD14 å•æ ¸ç»†èƒç¾¤çš„å¹³å‡è¡¨è¾¾ï¼Œå¹¶ç”Ÿæˆæ•£ç‚¹å›¾ï¼Œçªå‡ºæ˜¾ç¤ºå¯¹å¹²æ‰°ç´ åˆºæ¿€æœ‰æ˜¾ç€ååº”çš„åŸºå› ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">cowplot</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">theme_set</span>(<span class="cm-variable">theme_cowplot</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">t.cells</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">subset</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">idents</span> <span class="cm-operator">=</span> <span class="cm-string">"CD4 Naive T"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Idents</span>(<span class="cm-variable">t.cells</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"stim"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">avg.t.cells</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">as.data.frame</span>(<span class="cm-variable">log1p</span>(<span class="cm-variable">AverageExpression</span>(<span class="cm-variable">t.cells</span>, <span class="cm-variable">verbose</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">RNA</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">avg.t.cells</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">gene</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">avg.t.cells</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cd14.mono</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">subset</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">idents</span> <span class="cm-operator">=</span> <span class="cm-string">"CD14 Mono"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Idents</span>(<span class="cm-variable">cd14.mono</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"stim"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">avg.cd14.mono</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">as.data.frame</span>(<span class="cm-variable">log1p</span>(<span class="cm-variable">AverageExpression</span>(<span class="cm-variable">cd14.mono</span>, <span class="cm-variable">verbose</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">RNA</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">avg.cd14.mono</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">gene</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">avg.cd14.mono</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">genes.to.label</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"ISG15"</span>, <span class="cm-string">"LY6E"</span>, <span class="cm-string">"IFI6"</span>, <span class="cm-string">"ISG20"</span>, <span class="cm-string">"MX1"</span>, <span class="cm-string">"IFIT2"</span>, <span class="cm-string">"IFIT1"</span>, <span class="cm-string">"CXCL10"</span>, <span class="cm-string">"CCL8"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">ggplot</span>(<span class="cm-variable">avg.t.cells</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">CTRL</span>, <span class="cm-variable">STIM</span>)) <span class="cm-operator">+</span> <span class="cm-variable">geom_point</span>() <span class="cm-operator">+</span> <span class="cm-variable">ggtitle</span>(<span class="cm-string">"CD4 Naive T Cells"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">LabelPoints</span>(<span class="cm-variable">plot</span> <span class="cm-operator">=</span> <span class="cm-variable">p1</span>, <span class="cm-variable">points</span> <span class="cm-operator">=</span> <span class="cm-variable">genes.to.label</span>, <span class="cm-variable">repel</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">ggplot</span>(<span class="cm-variable">avg.cd14.mono</span>, <span class="cm-variable">aes</span>(<span class="cm-variable">CTRL</span>, <span class="cm-variable">STIM</span>)) <span class="cm-operator">+</span> <span class="cm-variable">geom_point</span>() <span class="cm-operator">+</span> <span class="cm-variable">ggtitle</span>(<span class="cm-string">"CD14 Monocytes"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">LabelPoints</span>(<span class="cm-variable">plot</span> <span class="cm-operator">=</span> <span class="cm-variable">p2</span>, <span class="cm-variable">points</span> <span class="cm-operator">=</span> <span class="cm-variable">genes.to.label</span>, <span class="cm-variable">repel</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator">+</span> <span class="cm-variable">p2</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 506px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><p><img src="images/scatterplots-1.png" referrerpolicy="no-referrer"></p><p><span>åœ¨ä¸åŒæ¡ä»¶ä¸‹è¯†åˆ«å‡ºå¸¸è§çš„ç»†èƒç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥</span><mark><span>è¯¢é—®ç›¸åŒç±»å‹ç»†èƒåœ¨ä¸åŒæ¡ä»¶ä¸‹å“ªäº›åŸºå› ä¼šå‘ç”Ÿå˜åŒ–</span></mark><span>ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ meta.data æ§½ä¸­åˆ›å»ºä¸€ä¸ªåˆ—æ¥ä¿å­˜ç»†èƒç±»å‹å’Œåˆºæ¿€ä¿¡æ¯ï¼Œå¹¶å°†å½“å‰æ ‡è¯†åˆ‡æ¢åˆ°è¯¥åˆ—ã€‚ç„¶åæˆ‘ä»¬</span><code>FindMarkers()</code><span>ç”¨æ¥å¯»æ‰¾åˆºæ¿€å’Œå¯¹ç…§ B ç»†èƒä¹‹é—´ä¸åŒçš„åŸºå› ã€‚è¯·æ³¨æ„ï¼Œæ­¤å¤„æ˜¾ç¤ºçš„è®¸å¤šé¡¶çº§åŸºå› ä¸æˆ‘ä»¬ä¹‹å‰ç»˜åˆ¶çš„æ ¸å¿ƒå¹²æ‰°ç´ ååº”åŸºå› ç›¸åŒã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ CXCL10 ç­‰ç‰¹å®šäºå•æ ¸ç»†èƒå’Œ B ç»†èƒå¹²æ‰°ç´ ååº”çš„åŸºå› åœ¨æ­¤åˆ—è¡¨ä¸­ä¹Ÿæ˜¾ç¤ºå‡ºéå¸¸é‡è¦çš„æ„ä¹‰ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.combined</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">celltype.stim</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">paste</span>(<span class="cm-variable">Idents</span>(<span class="cm-variable">immune.combined</span>), <span class="cm-variable">immune.combined</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">stim</span>, <span class="cm-variable">sep</span> <span class="cm-operator">=</span> <span class="cm-string">"_"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.combined</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">celltype</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">Idents</span>(<span class="cm-variable">immune.combined</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Idents</span>(<span class="cm-variable">immune.combined</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"celltype.stim"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">b.interferon.response</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindMarkers</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">ident.1</span> <span class="cm-operator">=</span> <span class="cm-string">"B_STIM"</span>, <span class="cm-variable">ident.2</span> <span class="cm-operator">=</span> <span class="cm-string">"B_CTRL"</span>, <span class="cm-variable">verbose</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">head</span>(<span class="cm-variable">b.interferon.response</span>, <span class="cm-variable">n</span> <span class="cm-operator">=</span> <span class="cm-number">15</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><span>å¯è§†åŒ–åœ¨åŸºå› è¡¨è¾¾çš„è¿™äº›å˜åŒ–çš„å¦ä¸€ç§æœ‰ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨</span><code>split.by</code><span>é€‰é¡¹ç»™</span><code>FeaturePlot()</code><span>æˆ–</span><code>VlnPlot()</code><span>åŠŸèƒ½ã€‚è¿™å°†æ˜¾ç¤ºç»™å®šåŸºå› åˆ—è¡¨çš„ç‰¹å¾å›¾ï¼ŒæŒ‰åˆ†ç»„å˜é‡ï¼ˆæ­¤å¤„ä¸ºåˆºæ¿€æ¡ä»¶ï¼‰æ‹†åˆ†ã€‚CD3D å’Œ GNLY ç­‰åŸºå› æ˜¯å…¸å‹çš„ç»†èƒç±»å‹æ ‡è®°ï¼ˆç”¨äº T ç»†èƒå’Œ NK/CD8 T ç»†èƒï¼‰ï¼Œå®ƒä»¬å‡ ä¹ä¸å—å¹²æ‰°ç´ åˆºæ¿€çš„å½±å“ï¼Œå¹¶ä¸”åœ¨å¯¹ç…§ç»„å’Œå—åˆºæ¿€ç»„ä¸­æ˜¾ç¤ºå‡ºç›¸ä¼¼çš„åŸºå› è¡¨è¾¾æ¨¡å¼ã€‚å¦ä¸€æ–¹é¢ï¼ŒIFI6 å’Œ ISG15 æ˜¯æ ¸å¿ƒå¹²æ‰°ç´ ååº”åŸºå› ï¼Œå¹¶åœ¨æ‰€æœ‰ç»†èƒç±»å‹ä¸­ç›¸åº”ä¸Šè°ƒã€‚æœ€åï¼ŒCD14 å’Œ CXCL10 æ˜¯æ˜¾ç¤ºç»†èƒç±»å‹ç‰¹å¼‚æ€§å¹²æ‰°ç´ ååº”çš„åŸºå› ã€‚åˆºæ¿€ CD14 å•æ ¸ç»†èƒå CD14 è¡¨è¾¾é™ä½ï¼Œè¿™å¯èƒ½å¯¼è‡´ç›‘ç£åˆ†ææ¡†æ¶ä¸­çš„é”™è¯¯åˆ†ç±»ï¼Œå¼ºè°ƒäº†ç»¼åˆåˆ†æçš„ä»·å€¼ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FeaturePlot</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"CD3D"</span>, <span class="cm-string">"GNLY"</span>, <span class="cm-string">"IFI6"</span>), <span class="cm-variable">split.by</span> <span class="cm-operator">=</span> <span class="cm-string">"stim"</span>, <span class="cm-variable">max.cutoff</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">cols</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"grey"</span>, <span class="cm-string">"red"</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plots</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">VlnPlot</span>(<span class="cm-variable">immune.combined</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"LYZ"</span>, <span class="cm-string">"ISG15"</span>, <span class="cm-string">"CXCL10"</span>), <span class="cm-variable">split.by</span> <span class="cm-operator">=</span> <span class="cm-string">"stim"</span>, <span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-string">"celltype"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-variable">combine</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">wrap_plots</span>(<span class="cm-variable">plots</span> <span class="cm-operator">=</span> <span class="cm-variable">plots</span>, <span class="cm-variable">ncol</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><img src="images/splitvln-1.png" referrerpolicy="no-referrer"></p><h4 id='ä½¿ç”¨-sctransform-è§„èŒƒåŒ–çš„æ•°æ®é›†æ‰§è¡Œæ•´åˆ'><span>ä½¿ç”¨ SCTransform è§„èŒƒåŒ–çš„æ•°æ®é›†æ‰§è¡Œæ•´åˆ</span></h4><p><span>åœ¨</span><a href='https://genomebiology.biomedcentral.com/articles/10.1186/s13059-019-1874-1'><span>Hafemeister å’Œ Satijaï¼Œ2019 å¹´</span></a><span>ï¼Œä»‹ç»äº†ä¸€ç§åŸºäºæ­£åˆ™åŒ–è´ŸäºŒé¡¹å¼å›å½’çš„æ”¹è¿›çš„ scRNA-seq æ ‡å‡†åŒ–æ–¹æ³•ã€‚è¯¥æ–¹æ³•è¢«å‘½åä¸ºâ€œsctransformâ€ï¼Œå¹¶é¿å…äº†æ ‡å‡†è§„èŒƒåŒ–å·¥ä½œæµç¨‹çš„ä¸€äº›ç¼ºé™·ï¼ŒåŒ…æ‹¬æ·»åŠ ä¼ªè®¡æ•°å’Œå¯¹æ•°è½¬æ¢ã€‚</span></p><p><span>æœ‰ä¸€äº›å…³é”®åŒºåˆ«ï¼š</span></p><ul><li><span>é€šè¿‡ å•ç‹¬è§„èŒƒåŒ–æ•°æ®é›†</span><code>SCTransform()</code><span>ï¼Œè€Œä¸æ˜¯</span><code>NormalizeData()</code><span>åœ¨é›†æˆä¹‹å‰</span></li><li><span>æ­£å¦‚æˆ‘ä»¬åœ¨</span><a href='https://satijalab.org/seurat/articles/sctransform_vignette.html'><span>SCTransform å°æ’å›¾ä¸­</span></a><span>è¿›ä¸€æ­¥è®¨è®ºçš„</span><a href='https://satijalab.org/seurat/articles/sctransform_vignette.html'><span>é‚£æ ·</span></a><span>ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ 3,000 ä¸ªæˆ–æ›´å¤šç‰¹å¾æ¥åˆ†æ sctransform çš„ä¸‹æ¸¸ã€‚</span></li><li><code>PrepSCTIntegration()</code><span>åœ¨è¯†åˆ«é”šç‚¹ä¹‹å‰è¿è¡Œå‡½æ•°</span></li><li><span>è¿è¡Œ</span><code>FindIntegrationAnchors()</code><span>æ—¶</span><code>IntegrateData()</code><span>ï¼Œè®¾ç½®</span><code>normalization.method</code><span>å‚æ•°ä¸ºå€¼</span><code>SCT</code><span>ã€‚</span></li><li><span>è¿è¡ŒåŸºäº sctransform çš„å·¥ä½œæµï¼ˆåŒ…æ‹¬é›†æˆï¼‰æ—¶ï¼Œè¯·å‹¿è¿è¡Œè¯¥</span><code>ScaleData()</code><span>å‡½æ•°</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">LoadData</span>(<span class="cm-string">"ifnb"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ifnb.list</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SplitObject</span>(<span class="cm-variable">ifnb</span>, <span class="cm-variable">split.by</span> <span class="cm-operator">=</span> <span class="cm-string">"stim"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ifnb.list</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">X</span> <span class="cm-operator">=</span> <span class="cm-variable">ifnb.list</span>, <span class="cm-variable">FUN</span> <span class="cm-operator">=</span> <span class="cm-variable">SCTransform</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">features</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SelectIntegrationFeatures</span>(<span class="cm-variable">object.list</span> <span class="cm-operator">=</span> <span class="cm-variable">ifnb.list</span>, <span class="cm-variable">nfeatures</span> <span class="cm-operator">=</span> <span class="cm-number">3000</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ifnb.list</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">PrepSCTIntegration</span>(<span class="cm-variable">object.list</span> <span class="cm-operator">=</span> <span class="cm-variable">ifnb.list</span>, <span class="cm-variable">anchor.features</span> <span class="cm-operator">=</span> <span class="cm-variable">features</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">### è¿è¡ŒFindIntegrationAnchors()æ—¶IntegrateData()ï¼Œè®¾ç½®normalization.methodå‚æ•°ä¸ºå€¼SCTã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.anchors</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindIntegrationAnchors</span>(<span class="cm-variable">object.list</span> <span class="cm-operator">=</span> <span class="cm-variable">ifnb.list</span>, <span class="cm-variable">normalization.method</span> <span class="cm-operator">=</span> <span class="cm-string">"SCT"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">anchor.features</span> <span class="cm-operator">=</span> <span class="cm-variable">features</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.combined.sct</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">IntegrateData</span>(<span class="cm-variable">anchorset</span> <span class="cm-operator">=</span> <span class="cm-variable">immune.anchors</span>, <span class="cm-variable">normalization.method</span> <span class="cm-operator">=</span> <span class="cm-string">"SCT"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.combined.sct</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunPCA</span>(<span class="cm-variable">immune.combined.sct</span>, <span class="cm-variable">verbose</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">immune.combined.sct</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunUMAP</span>(<span class="cm-variable">immune.combined.sct</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"pca"</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">30</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">immune.combined.sct</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"umap"</span>, <span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-string">"stim"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">immune.combined.sct</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"umap"</span>, <span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-string">"seurat_annotations"</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">repel</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator">+</span> <span class="cm-variable">p2</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 396px;"></div><div class="CodeMirror-gutters" style="display: none; height: 396px;"></div></div></div></pre><p><img src="images/immunesca.cca.sct.split.dims-1.png" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h2 id='å°†-seurat-ä¸å¤šæ¨¡å¼æ•°æ®ä¸€èµ·ä½¿ç”¨'><span>å°† Seurat ä¸å¤šæ¨¡å¼æ•°æ®ä¸€èµ·ä½¿ç”¨</span></h2><p><span>ä»åŒä¸€ä¸ªç»†èƒåŒæ—¶æµ‹é‡å¤šç§æ•°æ®ç±»å‹çš„èƒ½åŠ›ï¼Œç§°ä¸ºå¤šæ¨¡æ€åˆ†æã€‚é¦–å…ˆï¼ŒåŠ è½½ä¸¤ä¸ªè®¡æ•°çŸ©é˜µï¼šä¸€ä¸ªç”¨äº RNA æµ‹é‡ï¼Œä¸€ä¸ªç”¨äºæŠ—ä½“è¡ç”Ÿæ ‡ç­¾ (ADT)ã€‚</span></p><ol start='' ><li><span>åŠ è½½æ•°æ®</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">Seurat</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">patchwork</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Load in the RNA UMI matrix</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Note that this dataset also contains ~5% of mouse cells, which we can use as negative</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># controls for the protein measurements. For this reason, the gene expression matrix has</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># HUMAN_ or MOUSE_ appended to the beginning of each gene.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc.rna</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">as.sparse</span>(<span class="cm-variable">read.csv</span>(<span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"../data/GSE100866_CBMC_8K_13AB_10X-RNA_umi.csv.gz"</span>, <span class="cm-variable">sep</span> <span class="cm-operator">=</span> <span class="cm-string">","</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">header</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>, <span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># To make life a bit easier going forward, we're going to discard all but the top 100 most</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># highly expressed mouse genes, and remove the 'HUMAN_' from the CITE-seq prefix</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc.rna</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CollapseSpeciesExpressionMatrix</span>(<span class="cm-variable">cbmc.rna</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Load in the ADT UMI matrix</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc.adt</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">as.sparse</span>(<span class="cm-variable">read.csv</span>(<span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"../data/GSE100866_CBMC_8K_13AB_10X-ADT_umi.csv.gz"</span>, <span class="cm-variable">sep</span> <span class="cm-operator">=</span> <span class="cm-string">","</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">header</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>, <span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Note that since measurements were made in the same cells, the two matrices have identical column names</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">all.equal</span>(<span class="cm-variable">colnames</span>(<span class="cm-variable">cbmc.rna</span>), <span class="cm-variable">colnames</span>(<span class="cm-variable">cbmc.adt</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 616px;"></div><div class="CodeMirror-gutters" style="display: none; height: 616px;"></div></div></div></pre><ol start='' ><li><span>è®¾ç½® Seurat å¯¹è±¡ï¼Œæ·»åŠ  RNA å’Œè›‹ç™½è´¨æ•°æ®</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># creates a Seurat object based on the scRNA-seq data</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CreateSeuratObject</span>(<span class="cm-variable">counts</span> <span class="cm-operator">=</span> <span class="cm-variable">cbmc.rna</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># We can see that by default, the cbmc object contains an assay storing RNA measurement</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Assays</span>(<span class="cm-variable">cbmc</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># create a new assay to store ADT information</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">adt_assay</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CreateAssayObject</span>(<span class="cm-variable">counts</span> <span class="cm-operator">=</span> <span class="cm-variable">cbmc.adt</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># add this assay to the previously created Seurat object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc</span>[[<span class="cm-string">"ADT"</span>]] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">adt_assay</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Validate that the object now contains multiple assays</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Assays</span>(<span class="cm-variable">cbmc</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Switch the default to ADT(switch)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DefaultAssay</span>(<span class="cm-variable">cbmc</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"ADT"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DefaultAssay</span>(<span class="cm-variable">cbmc</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 418px;"></div><div class="CodeMirror-gutters" style="display: none; height: 418px;"></div></div></div></pre><ol start='' ><li><span>åŸºäºå®ƒä»¬çš„ scRNA-seq çš„æ•°æ®å¯¹ç»†èƒè¿›è¡Œèšç±»</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Note that all operations below are performed on the RNA assay Set and verify that the</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># default assay is RNA</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DefaultAssay</span>(<span class="cm-variable">cbmc</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"RNA"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DefaultAssay</span>(<span class="cm-variable">cbmc</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># perform visualization and clustering steps</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">NormalizeData</span>(<span class="cm-variable">cbmc</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindVariableFeatures</span>(<span class="cm-variable">cbmc</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">ScaleData</span>(<span class="cm-variable">cbmc</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunPCA</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">verbose</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindNeighbors</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">30</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindClusters</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">resolution</span> <span class="cm-operator">=</span> <span class="cm-number">0.8</span>, <span class="cm-variable">verbose</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunUMAP</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">30</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><p><img src="images/cluster1-1.png" referrerpolicy="no-referrer"></p><ol start='' ><li><span>å¹¶æ’æ˜¾ç¤ºå¤šç§æ¨¡å¼çš„ç»“æœ</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Normalize ADT data,</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DefaultAssay</span>(<span class="cm-variable">cbmc</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"ADT"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">NormalizeData</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">normalization.method</span> <span class="cm-operator">=</span> <span class="cm-string">"CLR"</span>, <span class="cm-variable">margin</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DefaultAssay</span>(<span class="cm-variable">cbmc</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"RNA"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Note that the following command is an alternative but returns the same result</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">NormalizeData</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">normalization.method</span> <span class="cm-operator">=</span> <span class="cm-string">"CLR"</span>, <span class="cm-variable">margin</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>, <span class="cm-variable">assay</span> <span class="cm-operator">=</span> <span class="cm-string">"ADT"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Now, we will visualize CD14 levels for RNA and protein By setting the default assay, we can</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># visualize one or the other</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DefaultAssay</span>(<span class="cm-variable">cbmc</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"ADT"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FeaturePlot</span>(<span class="cm-variable">cbmc</span>, <span class="cm-string">"CD19"</span>, <span class="cm-variable">cols</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"lightgrey"</span>, <span class="cm-string">"darkgreen"</span>)) <span class="cm-operator">+</span> <span class="cm-variable">ggtitle</span>(<span class="cm-string">"CD19 protein"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DefaultAssay</span>(<span class="cm-variable">cbmc</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"RNA"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FeaturePlot</span>(<span class="cm-variable">cbmc</span>, <span class="cm-string">"CD19"</span>) <span class="cm-operator">+</span> <span class="cm-variable">ggtitle</span>(<span class="cm-string">"CD19 RNA"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># place plots side-by-side</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator">|</span> <span class="cm-variable">p2</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 418px;"></div><div class="CodeMirror-gutters" style="display: none; height: 418px;"></div></div></div></pre><p><img src="images/vis-1.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Alternately, we can use specific assay keys to specify a specific modality Identify the key</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># for the RNA and protein assays</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Key</span>(<span class="cm-variable">cbmc</span>[[<span class="cm-string">"RNA"</span>]])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Key</span>(<span class="cm-variable">cbmc</span>[[<span class="cm-string">"ADT"</span>]])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Now, we can include the key in the feature name, which overrides the default assay</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FeaturePlot</span>(<span class="cm-variable">cbmc</span>, <span class="cm-string">"adt_CD19"</span>, <span class="cm-variable">cols</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"lightgrey"</span>, <span class="cm-string">"darkgreen"</span>)) <span class="cm-operator">+</span> <span class="cm-variable">ggtitle</span>(<span class="cm-string">"CD19 protein"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FeaturePlot</span>(<span class="cm-variable">cbmc</span>, <span class="cm-string">"rna_CD19"</span>) <span class="cm-operator">+</span> <span class="cm-variable">ggtitle</span>(<span class="cm-string">"CD19 RNA"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator">|</span> <span class="cm-variable">p2</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 220px;"></div><div class="CodeMirror-gutters" style="display: none; height: 220px;"></div></div></div></pre><p><img src="images/vis-2.png" referrerpolicy="no-referrer"></p><ol start='' ><li><span>è¯†åˆ« scRNA-seq ç°‡çš„ç»†èƒè¡¨é¢æ ‡è®°</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># as we know that CD19 is a B cell marker, we can identify cluster 6 as expressing CD19 on the</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># surface</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">VlnPlot</span>(<span class="cm-variable">cbmc</span>, <span class="cm-string">"adt_CD19"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># we can also identify alternative protein and RNA markers for this cluster through</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># differential expression</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">adt_markers</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindMarkers</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">ident.1</span> <span class="cm-operator">=</span> <span class="cm-number">6</span>, <span class="cm-variable">assay</span> <span class="cm-operator">=</span> <span class="cm-string">"ADT"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rna_markers</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindMarkers</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">ident.1</span> <span class="cm-operator">=</span> <span class="cm-number">6</span>, <span class="cm-variable">assay</span> <span class="cm-operator">=</span> <span class="cm-string">"RNA"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">head</span>(<span class="cm-variable">adt_markers</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><img src="images/markers-1.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># we can also identify alternative protein and RNA markers for this cluster through</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># differential expression</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">adt_markers</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindMarkers</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">ident.1</span> <span class="cm-operator">=</span> <span class="cm-number">6</span>, <span class="cm-variable">assay</span> <span class="cm-operator">=</span> <span class="cm-string">"ADT"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rna_markers</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindMarkers</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">ident.1</span> <span class="cm-operator">=</span> <span class="cm-number">6</span>, <span class="cm-variable">assay</span> <span class="cm-operator">=</span> <span class="cm-string">"RNA"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">head</span>(<span class="cm-variable">adt_markers</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><ol start='' ><li><span>å¤šæ¨¡å¼æ•°æ®çš„å…¶ä»–å¯è§†åŒ–</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Draw ADT scatter plots (like biaxial plots for FACS). Note that you can even 'gate' cells if</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># desired by using HoverLocator and FeatureLocator</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FeatureScatter</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">feature1</span> <span class="cm-operator">=</span> <span class="cm-string">"adt_CD19"</span>, <span class="cm-variable">feature2</span> <span class="cm-operator">=</span> <span class="cm-string">"adt_CD3"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><img src="images/viz.cite.two-1.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># view relationship between protein and RNA</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FeatureScatter</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">feature1</span> <span class="cm-operator">=</span> <span class="cm-string">"adt_CD3"</span>, <span class="cm-variable">feature2</span> <span class="cm-operator">=</span> <span class="cm-string">"rna_CD3E"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><img src="images/viz.cite.two-2.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FeatureScatter</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">feature1</span> <span class="cm-operator">=</span> <span class="cm-string">"adt_CD4"</span>, <span class="cm-variable">feature2</span> <span class="cm-operator">=</span> <span class="cm-string">"adt_CD8"</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><img src="images/viz.cite.two-3.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Let's look at the raw (non-normalized) ADT counts. You can see the values are quite high,</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># particularly in comparison to RNA values. This is due to the significantly higher protein</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># copy number in cells, which significantly reduces 'drop-out' in ADT data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FeatureScatter</span>(<span class="cm-variable">cbmc</span>, <span class="cm-variable">feature1</span> <span class="cm-operator">=</span> <span class="cm-string">"adt_CD4"</span>, <span class="cm-variable">feature2</span> <span class="cm-operator">=</span> <span class="cm-string">"adt_CD8"</span>, <span class="cm-variable">slot</span> <span class="cm-operator">=</span> <span class="cm-string">"counts"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><img src="images/viz.cite.two-4.png" referrerpolicy="no-referrer"></p><ol start='' ><li><span>ä» 10X å¤šæ¨¡æ€å®éªŒä¸­åŠ è½½æ•°æ®</span></li></ol><p><span>Seurat è¿˜èƒ½å¤Ÿåˆ†ææ¥è‡ªä½¿ç”¨ CellRanger v3 å¤„ç†çš„å¤šæ¨¡å¼ 10X å®éªŒçš„æ•°æ®ï¼›ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ 7,900 ä¸ªå¤–å‘¨è¡€å•ä¸ªæ ¸ç»†èƒ (PBMC) çš„æ•°æ®é›†é‡æ–°åˆ›å»ºäº†ä¸Šé¢çš„å›¾ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc10k.data</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">Read10X</span>(<span class="cm-variable">data.dir</span> <span class="cm-operator">=</span> <span class="cm-string">"../data/pbmc10k/filtered_feature_bc_matrix/"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rownames</span>(<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">pbmc10k.data</span>[[<span class="cm-string">"Antibody Capture"</span>]]) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">gsub</span>(<span class="cm-variable">pattern</span> <span class="cm-operator">=</span> <span class="cm-string">"_[control_]*TotalSeqB"</span>, <span class="cm-variable">replacement</span> <span class="cm-operator">=</span> <span class="cm-string">""</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">pbmc10k.data</span>[[<span class="cm-string">"Antibody Capture"</span>]]))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc10k</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CreateSeuratObject</span>(<span class="cm-variable">counts</span> <span class="cm-operator">=</span> <span class="cm-variable">pbmc10k.data</span>[[<span class="cm-string">"Gene Expression"</span>]], <span class="cm-variable">min.cells</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>, <span class="cm-variable">min.features</span> <span class="cm-operator">=</span> <span class="cm-number">200</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc10k</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">NormalizeData</span>(<span class="cm-variable">pbmc10k</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc10k</span>[[<span class="cm-string">"ADT"</span>]] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CreateAssayObject</span>(<span class="cm-variable">pbmc10k.data</span>[[<span class="cm-string">"Antibody Capture"</span>]][, <span class="cm-variable">colnames</span>(<span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">pbmc10k</span>)])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc10k</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">NormalizeData</span>(<span class="cm-variable">pbmc10k</span>, <span class="cm-variable">assay</span> <span class="cm-operator">=</span> <span class="cm-string">"ADT"</span>, <span class="cm-variable">normalization.method</span> <span class="cm-operator">=</span> <span class="cm-string">"CLR"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FeatureScatter</span>(<span class="cm-variable">pbmc10k</span>, <span class="cm-variable">feature1</span> <span class="cm-operator">=</span> <span class="cm-string">"adt_CD19"</span>, <span class="cm-variable">feature2</span> <span class="cm-operator">=</span> <span class="cm-string">"adt_CD3"</span>, <span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FeatureScatter</span>(<span class="cm-variable">pbmc10k</span>, <span class="cm-variable">feature1</span> <span class="cm-operator">=</span> <span class="cm-string">"adt_CD4"</span>, <span class="cm-variable">feature2</span> <span class="cm-operator">=</span> <span class="cm-string">"adt_CD8a"</span>, <span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot3</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FeatureScatter</span>(<span class="cm-variable">pbmc10k</span>, <span class="cm-variable">feature1</span> <span class="cm-operator">=</span> <span class="cm-string">"adt_CD3"</span>, <span class="cm-variable">feature2</span> <span class="cm-operator">=</span> <span class="cm-string">"CD3E"</span>, <span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-variable">plot1</span> <span class="cm-operator">+</span> <span class="cm-variable">plot2</span> <span class="cm-operator">+</span> <span class="cm-variable">plot3</span>) <span class="cm-operator">&amp;</span> <span class="cm-variable">NoLegend</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 418px;"></div><div class="CodeMirror-gutters" style="display: none; height: 418px;"></div></div></div></pre><p><img src="images/pbmc10x-1.png" referrerpolicy="no-referrer"></p><h2 id='ä¸‹æ¸¸åˆ†æ'><span>ä¸‹æ¸¸åˆ†æ</span></h2><h3 id='ç»†èƒæ°´å¹³'><span>ç»†èƒæ°´å¹³</span></h3><h4 id='ç°‡'><span>ç°‡</span></h4><h5 id='èšç±»åˆ†æ'><span>èšç±»åˆ†æ</span></h5><ol start='' ><li><span>SeuratåŒ…</span></li></ol><p><span>åº”ç”¨ï¼š scRNA-seq æ•°æ®ã€CyTOF æ•°æ®</span></p><ul><li><span>è¿™äº›æ–¹æ³•å°†ç»†èƒåµŒå…¥åˆ°ä¸€ä¸ªå›¾ç»“æ„ä¸­â€”â€”ä¾‹å¦‚ä¸€ä¸ª K-æœ€è¿‘é‚» (KNN) å›¾ï¼Œåœ¨å…·æœ‰ç›¸ä¼¼åŸºå› è¡¨è¾¾æ¨¡å¼çš„å•å…ƒä¹‹é—´ç»˜åˆ¶è¾¹ï¼Œç„¶åå°è¯•å°†è¯¥å›¾åˆ’åˆ†ä¸ºé«˜åº¦äº’è¿çš„â€œå‡†é›†å›¢â€æˆ–â€œç¾¤ä½“â€ã€‚</span></li><li><span>é¦–å…ˆåŸºäº PCA ç©ºé—´ä¸­çš„æ¬§å‡ é‡Œå¾·è·ç¦»æ„å»ºä¸€ä¸ª KNN å›¾ï¼Œå¹¶åŸºäºå…¶å±€éƒ¨é‚»åŸŸä¸­çš„å…±äº«é‡å ï¼ˆJaccard ç›¸ä¼¼æ€§ï¼‰ç»†åŒ–ä»»æ„ä¸¤ä¸ªå•å…ƒä¹‹é—´çš„è¾¹æƒé‡ã€‚æ­¤æ­¥éª¤ä½¿ç”¨è¯¥</span><code>FindNeighbors()</code><span>å‡½æ•°æ‰§è¡Œï¼Œå¹¶å°†å…ˆå‰å®šä¹‰çš„æ•°æ®é›†ç»´åº¦ï¼ˆå‰ 10 ä¸ª PCï¼‰ä½œä¸ºè¾“å…¥ã€‚</span></li><li><span>ä¸ºäº†å¯¹ç»†èƒè¿›è¡Œèšç±»ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥åº”ç”¨æ¨¡å—åŒ–ä¼˜åŒ–æŠ€æœ¯ï¼Œä¾‹å¦‚ Louvain ç®—æ³•ï¼ˆé»˜è®¤ï¼‰æˆ– SLM ï¼Œä»¥è¿­ä»£æ–¹å¼å°†ç»†èƒåˆ†ç»„åœ¨ä¸€èµ·ï¼Œç›®æ ‡æ˜¯ä¼˜åŒ–æ ‡å‡†æ¨¡å—åŒ–å‡½æ•°. è¯¥FindClusters()å‡½æ•°å®ç°äº†è¿™ä¸ªè¿‡ç¨‹ï¼Œå¹¶åŒ…å«ä¸€ä¸ªåˆ†è¾¨ç‡å‚æ•°ï¼Œç”¨äºè®¾ç½®ä¸‹æ¸¸èšç±»çš„â€œåˆ†è¾¨ç‡ï¼ˆresolutionï¼‰â€ï¼Œ</span><mark><span>åˆ†è¾¨ç‡å¢åŠ ä¼šå¾—åˆ°æ›´å¤šçš„ç°‡ã€‚æˆ‘ä»¬å‘ç°ï¼Œå°†è¿™ä¸ªå‚æ•°è®¾ç½®åœ¨ 0.4-1.2 ä¹‹é—´é€šå¸¸ä¼šä¸ºå¤§çº¦ 3K ç»†èƒçš„å•ç»†èƒæ•°æ®é›†è¿”å›è¾ƒå¥½çš„èšç±»ç»“æœã€‚</span></mark><span>å¯¹äºè¾ƒå¤§çš„æ•°æ®é›†ï¼Œæœ€ä½³åˆ†è¾¨ç‡é€šå¸¸ä¼šå¢åŠ ã€‚å¯ä»¥ä½¿ç”¨è¯¥</span><code>Idents()</code><span>å‡½æ•°æ‰¾åˆ°ç°‡ã€‚</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindNeighbors</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">10</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindClusters</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">resolution</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><img src="images/2021-10-24-22-19-43.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Look at cluster IDs of the first 5 cells</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">head</span>(<span class="cm-variable">Idents</span>(<span class="cm-variable">pbmc</span>), <span class="cm-number">5</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><img src="images/2021-10-24-22-20-14.png" referrerpolicy="no-referrer"></p><ol start='2' ><li><span>é€šè¿‡ä¼ªæ—¶é—´è¡¨è¾¾æ¨¡å¼èšç±»åŸºå› </span></li></ol><p><span>åœ¨ç ”ç©¶æ—¶é—´åºåˆ—åŸºå› è¡¨è¾¾ç ”ç©¶æ—¶å‡ºç°çš„ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯ï¼šâ€œå“ªäº›åŸºå› éµå¾ªç›¸ä¼¼çš„åŠ¨åŠ›å­¦è¶‹åŠ¿â€ï¼ŸMonocle å¯ä»¥é€šè¿‡å¯¹å…·æœ‰ç›¸ä¼¼è¶‹åŠ¿çš„åŸºå› è¿›è¡Œåˆ†ç»„æ¥å¸®åŠ©æ‚¨å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå› æ­¤æ‚¨å¯ä»¥åˆ†æè¿™äº›ç»„ä»¥æŸ¥çœ‹å®ƒä»¬çš„å…±åŒç‚¹ã€‚Monocle æä¾›äº†ä¸€ç§å¯è§†åŒ–æ‰€æœ‰ä¼ªæ—¶é—´ä¾èµ–æ€§åŸºå› çš„ä¾¿æ·æ–¹æ³•ã€‚è¯¥å‡½æ•°</span><code>plot_pseudotime_heatmap</code><span>æ¥å—ä¸€ä¸ª</span><code>CellDataSet</code><span>å¯¹è±¡ï¼ˆé€šå¸¸åªåŒ…å«é‡è¦åŸºå› çš„ä¸€ä¸ªå­é›†ï¼‰å¹¶ç”Ÿæˆå¹³æ»‘çš„è¡¨è¾¾æ›²çº¿ï¼Œå°±åƒ</span><code>plot_genes_in_pseudotime</code><span>ã€‚ç„¶åï¼Œå®ƒå¯¹è¿™äº›åŸºå› è¿›è¡Œèšç±»å¹¶ä½¿ç”¨pheatmapåŒ…ç»˜åˆ¶å®ƒä»¬ï¼Œå¯ä»¥</span><strong><span>å¯è§†åŒ–è·¨ä¼ªæ—¶é—´å…±å˜çš„åŸºå› æ¨¡å—</span></strong><span>ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">diff_test_res</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">differentialGeneTest</span>(<span class="cm-variable">HSMM_myo</span>[<span class="cm-variable">marker_genes</span>,],</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">fullModelFormulaStr</span> <span class="cm-operator">=</span> <span class="cm-string">"~sm.ns(Pseudotime)"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sig_gene_names</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">row.names</span>(<span class="cm-variable">subset</span>(<span class="cm-variable">diff_test_res</span>, <span class="cm-variable">qval</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0.1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_pseudotime_heatmap</span>(<span class="cm-variable">HSMM_myo</span>[<span class="cm-variable">sig_gene_names</span>,],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_clusters</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cores</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">show_rownames</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><img src="images/2021-10-25-14-30-50.png" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h5 id='å¯¹ç°‡è¿›è¡Œç»†èƒç±»å‹æ³¨é‡Š'><span>å¯¹ç°‡è¿›è¡Œç»†èƒç±»å‹æ³¨é‡Š</span></h5><ol start='' ><li><span>SeuratåŒ…</span>
<span>å°†æ— åèšç±»ä¸å·²çŸ¥ç»†èƒç±»å‹åŒ¹é…ï¼Œå¹¶è¿›è¡Œæ³¨é‡Šï¼Œ</span><mark><span>å±äºå…ˆéªŒçŸ¥è¯†è¿›è¡Œæ³¨é‡Šï¼Œä¸ºæ— ç›‘ç£å­¦ä¹ ã€‚</span></mark></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">new.cluster.ids</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">c</span>(<span class="cm-string">"Naive CD4 T"</span>, <span class="cm-string">"CD14+ Mono"</span>, <span class="cm-string">"Memory CD4 T"</span>, <span class="cm-string">"B"</span>, <span class="cm-string">"CD8 T"</span>, <span class="cm-string">"FCGR3A+ Mono"</span>,<span class="cm-string">"NK"</span>, <span class="cm-string">"DC"</span>, <span class="cm-string">"Platelet"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">names</span>(<span class="cm-variable">new.cluster.ids</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">levels</span>(<span class="cm-variable">pbmc</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RenameIdents</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">new.cluster.ids</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"umap"</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>, <span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>)<span class="cm-operator">+</span><span class="cm-variable">NoLegend</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">saveRDS</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"../output/pbmc3k_final.rds"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><img src="images/2021-10-25-14-38-05.png" referrerpolicy="no-referrer"></p><ol start='2' ><li><span>SingleRåŒ…</span></li></ol><p><span>SingleRåˆ©ç”¨çº¯ç»†èƒç±»å‹çš„å‚è€ƒè½¬å½•ç»„æ•°æ®é›†æ¥ç‹¬ç«‹æ¨æ–­æ¯ä¸ªå•ç»†èƒçš„ç»†èƒå¯èƒ½ç±»å‹ã€‚SingleRçš„æ³¨é‡Šä¸Seurat(ä¸€ä¸ªä¸ºscRNA-seqè®¾è®¡çš„å¤„ç†å’Œåˆ†æåŒ…)ç›¸ç»“åˆï¼Œä¸ºç ”ç©¶scRNA-seqæ•°æ®æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ã€‚SingleRæä¾›äº†å†…ç½®çš„åŒ…è£…å‡½æ•°ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°è¿è¡Œå®Œæ•´çš„æµç¨‹ã€‚SingleRä¸Seuratäº¤äº’è¾ƒå¥½ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–scRNA-seqåŒ…ï¼Œä½¿ç”¨è¯¥åŒ…æ‰€æœ‰çš„æ•°æ®é›†,ç½‘å€å¦‚ä¸‹ã€‚</span>
<a href='https://bioconductor.org/packages/release/data/experiment/vignettes/scRNAseq/inst/doc/scRNAseq.html#references' target='_blank' class='url'>https://bioconductor.org/packages/release/data/experiment/vignettes/scRNAseq/inst/doc/scRNAseq.html#references</a></p><p><span>åŸç†ï¼šé¦–å…ˆï¼Œè®¡ç®—å‚è€ƒæ•°æ®é›†ä¸­æ¯ä¸ªæ ·æœ¬çš„å•ç»†èƒè¡¨è¾¾çš„spearmanç³»æ•°ã€‚ç›¸å…³åˆ†æä»…å¯¹å‚è€ƒæ•°æ®é›†ä¸­çš„å¯å˜åŸºå› ï¼ˆvariable genesï¼‰è¿›è¡Œã€‚æ¥ç€ï¼Œæ ¹æ®å‚è€ƒæ•°æ®é›†çš„å‘½åæ³¨é‡Šèšåˆæ¯ä¸ªç»†èƒç±»å‹çš„å¤šä¸ªç›¸å…³ç³»æ•°ï¼Œä»è€Œä¸ºæ¯ä¸ªç»†èƒç±»å‹æä¾›ä¸€ä¸ªå€¼ã€‚æ¥ç€SingleRå°†é‡æ–°è¿è¡Œç›¸å…³åˆ†æï¼Œä½†åªé’ˆå¯¹ä¸Šä¸€æ­¥ä¸­çš„ç›¸å…³æ€§è¾ƒé«˜çš„ç»†èƒç±»å‹ã€‚è¯¥åˆ†æä»…å¯¹è¿™äº›ç»†èƒç±»å‹ä¹‹é—´çš„å¯å˜åŸºå› è¿›è¡Œã€‚ç§»é™¤æœ€ä½å€¼çš„ç»†èƒç±»å‹(æˆ–æ¯”æœ€é«˜å€¼ä½0.05çš„è¾¹ç¼˜)ï¼Œç„¶åé‡å¤æ­¤æ­¥éª¤ï¼Œç›´åˆ°åªä¿ç•™ä¸¤ç§ç»†èƒç±»å‹ã€‚æœ€åä¸€æ¬¡è¿è¡Œåï¼Œä¸é¡¶éƒ¨å€¼å¯¹åº”çš„ç»†èƒç±»å‹è¢«åˆ†é…ç»™å•ä¸ªç»†èƒã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æ ¹æ®éœ€æ±‚é€‰æ‹©ä¸Šè¿°ç½‘ç«™çš„æ•°æ®é›†ä½œä¸ºSingleRçš„å‚è€ƒæ•°æ®é›†</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">imm_ref</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DatabaseImmuneCellExpressionData</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># è¿›è¡Œç»†èƒç±»å‹æ³¨é‡Šï¼ˆä¸€èˆ¬é€‰æ‹©ç¬¬äºŒç§ï¼Œå¯ä»¥ç›´æ¥æ³¨é‡ŠSeuratèšç±»ç»“æœï¼‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pred_single</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SingleR</span>(<span class="cm-variable">test</span> <span class="cm-operator">=</span> <span class="cm-variable">pbmc</span>@<span class="cm-variable">assays</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">SCT</span>@<span class="cm-variable">data</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">ref</span> <span class="cm-operator">=</span> <span class="cm-variable">imm_ref</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">labels</span> <span class="cm-operator">=</span> <span class="cm-variable">imm_ref</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">label.main</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">genes</span> <span class="cm-operator">=</span> <span class="cm-string">"de"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">de.method</span> <span class="cm-operator">=</span> <span class="cm-string">"wilcox"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pred_cluster</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SingleR</span>(<span class="cm-variable">test</span> <span class="cm-operator">=</span> <span class="cm-variable">pbmc</span>@<span class="cm-variable">assays</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">SCT</span>@<span class="cm-variable">data</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ref</span> <span class="cm-operator">=</span> <span class="cm-variable">imm_ref</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">labels</span> <span class="cm-operator">=</span> <span class="cm-variable">imm_ref</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">label.main</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">clusters</span> <span class="cm-operator">=</span> <span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">SCT_snn_res.0.6</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">genes</span> <span class="cm-operator">=</span> <span class="cm-string">"de"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">de.method</span> <span class="cm-operator">=</span> <span class="cm-string">"wilcox"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">save</span>(<span class="cm-variable">pred_single</span>, <span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"pred_single.rda"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">save</span>(<span class="cm-variable">pred_cluster</span>, <span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"pred_cluster.rda"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># plot</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">seurat_celltype</span> <span class="cm-operator">=</span> <span class="cm-variable">Idents</span>(<span class="cm-variable">pbmc</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sr_single_first_ct</span> <span class="cm-operator">=</span> <span class="cm-variable">pred_single</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">first.labels</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sr_single_ct</span> <span class="cm-operator">=</span> <span class="cm-variable">pred_single</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sr_single_pruned_ct</span> <span class="cm-operator">=</span> <span class="cm-variable">pred_single</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">pruned.labels</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sr_cluster_first_ct</span> <span class="cm-operator">=</span> <span class="cm-variable">RenameCluster</span>(<span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">SCT_snn_res.0.6</span>, <span class="cm-variable">pred_cluster</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">first.labels</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sr_cluster_ct</span> <span class="cm-operator">=</span> <span class="cm-variable">RenameCluster</span>(<span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">SCT_snn_res.0.6</span>, <span class="cm-variable">pred_cluster</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sr_cluster_pruned_ct</span> <span class="cm-operator">=</span> <span class="cm-variable">RenameCluster</span>(<span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">SCT_snn_res.0.6</span>, <span class="cm-variable">pred_cluster</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">pruned.labels</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stringsAsFactors</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cbind</span>(<span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span>, <span class="cm-variable">x</span>, <span class="cm-variable">stringsAsFactors</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plist</span> <span class="cm-operator">=</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">colnames</span>(<span class="cm-variable">x</span>), <span class="cm-keyword">function</span>(<span class="cm-variable">col</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">DimPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">reduction</span><span class="cm-operator">=</span><span class="cm-string">"umap"</span>, <span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-variable">col</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>, <span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">1.5</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">labs</span>(<span class="cm-variable">title</span> <span class="cm-operator">=</span> <span class="cm-variable">col</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">scale_colour_d3</span>(<span class="cm-string">"category20"</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">rj.ftheme</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"singer_compare_all.png"</span>, <span class="cm-variable">CombinePlots</span>(<span class="cm-variable">plist</span>, <span class="cm-variable">ncol</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>), <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">20</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">15</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plist</span> <span class="cm-operator">=</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">colnames</span>(<span class="cm-variable">x</span>)[<span class="cm-variable">c</span>(<span class="cm-number">1</span>,<span class="cm-number">6</span>,<span class="cm-number">3</span>)], <span class="cm-keyword">function</span>(<span class="cm-variable">col</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">DimPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">reduction</span><span class="cm-operator">=</span><span class="cm-string">"umap"</span>, <span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-variable">col</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>, <span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">1.5</span>) <span class="cm-operator">+</span> <span class="cm-variable">labs</span>(<span class="cm-variable">title</span> <span class="cm-operator">=</span> <span class="cm-variable">col</span>) <span class="cm-operator">+</span> <span class="cm-variable">scale_colour_d3</span>(<span class="cm-string">"category20"</span>) <span class="cm-operator">+</span> <span class="cm-variable">rj.ftheme</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"singer_compare_ct.png"</span>, <span class="cm-variable">CombinePlots</span>(<span class="cm-variable">plist</span>, <span class="cm-variable">ncol</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>), <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">20</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">https</span><span class="cm-operator">://</span><span class="cm-variable">nbisweden.github.io</span><span class="cm-operator">/</span><span class="cm-variable">excelerate</span><span class="cm-operator">-</span><span class="cm-variable">scRNAseq</span><span class="cm-operator">/</span><span class="cm-variable">session</span><span class="cm-operator">-</span><span class="cm-variable">celltypeid</span><span class="cm-operator">/</span><span class="cm-variable">celltypeid.html</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1188px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1188px;"></div></div></div></pre><hr /><p><span>Updateï¼šSingleRåŒ…è¿›è¡Œæ”¹ç‰ˆå’Œæ›´æ–° å»ºè®®ä½¿ç”¨ä»¥ä¸‹çš„ä»£ç ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="R" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Cell_typing</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># SingleRç»†èƒç±»å‹æ³¨é‡Š</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Seurat.data</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readRDS</span>(<span class="cm-string">"Markers/Markers_0.5.rds"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># SCTransform()å‡½æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Seurat.data</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SCTransform</span>(<span class="cm-variable">Seurat.data</span>, <span class="cm-variable">vars.to.regress</span> <span class="cm-operator">=</span> <span class="cm-string">"percent.mt"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Load the SingleRdata &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Seurat.data_for_SingleR</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">GetAssayData</span>(<span class="cm-variable">Seurat.data</span>, <span class="cm-variable">slot</span><span class="cm-operator">=</span><span class="cm-string">"data"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">clusters</span><span class="cm-operator">=</span><span class="cm-variable">Seurat.data</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">seurat_clusters</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æ ¹æ®éœ€æ±‚é€‰æ‹©ä¸Šè¿°ç½‘ç«™çš„æ•°æ®é›†ä½œä¸ºSingleRçš„å‚è€ƒæ•°æ®é›†</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">library</span>(<span class="cm-variable">SingleR</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">library</span>(<span class="cm-variable">scRNAseq</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">library</span>(<span class="cm-variable">celldex</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#### Human being ####</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#####################</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## Using multiple references</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">library</span>(<span class="cm-variable">celldex</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">hpca</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">HumanPrimaryCellAtlasData</span>(<span class="cm-variable">ensembl</span><span class="cm-operator">=</span><span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">bpe</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">BlueprintEncodeData</span>(<span class="cm-variable">ensembl</span><span class="cm-operator">=</span><span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## annotation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">pred.human</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SingleR</span>(<span class="cm-variable">test</span> <span class="cm-operator">=</span> <span class="cm-variable">Seurat.data_for_SingleR</span>, <span class="cm-variable">assay.type.test</span><span class="cm-operator">=</span><span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ref</span> <span class="cm-operator">=</span> <span class="cm-builtin">list</span>(<span class="cm-variable">BPE</span><span class="cm-operator">=</span><span class="cm-variable">bpe</span>, <span class="cm-variable">HPCA</span><span class="cm-operator">=</span><span class="cm-variable">hpca</span>), </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">labels</span> <span class="cm-operator">=</span> <span class="cm-builtin">list</span>(<span class="cm-variable">bpe</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">label.main</span>, <span class="cm-variable">hpca</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">label.main</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## Check the final label from the combined assignment.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">table</span>(<span class="cm-variable">pred.human</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">head</span>(<span class="cm-variable">pred.human</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orig.results</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">BPE</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">head</span>(<span class="cm-variable">pred.human</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orig.results</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">HPCA</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## visualization</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Seurat.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">hpca_type</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pred.human</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orig.results</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">HPCA</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Seurat.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">bpe_typ</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pred.human</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orig.results</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">BPE</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## visualization</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">library</span>(<span class="cm-variable">ggsci</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">p1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">Seurat.data</span>, <span class="cm-variable">group.by</span><span class="cm-operator">=</span><span class="cm-string">'hpca_type'</span>,<span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>)<span class="cm-operator">+</span><span class="cm-variable">scale_color_ucscgb</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">p2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">Seurat.data</span>, <span class="cm-variable">group.by</span><span class="cm-operator">=</span><span class="cm-string">'bpe_type'</span>,<span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>)<span class="cm-operator">+</span><span class="cm-variable">scale_color_ucscgb</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">library</span>(<span class="cm-variable">cowplot</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">p</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">plot_grid</span>(<span class="cm-variable">p1</span>, <span class="cm-variable">p2</span>, <span class="cm-variable">nrow</span><span class="cm-operator">=</span><span class="cm-number">1</span>, <span class="cm-variable">ncol</span><span class="cm-operator">=</span><span class="cm-number">2</span>, <span class="cm-variable">labels</span><span class="cm-operator">=</span><span class="cm-variable">panel.labels</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ggsave</span>(<span class="cm-string">"singler.pdf"</span>, <span class="cm-variable">plot</span> <span class="cm-operator">=</span> <span class="cm-variable">p</span>, <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">15</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">####### Mouse #######</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#####################</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">library</span>(<span class="cm-variable">celldex</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">#immgen &lt;- ImmGenData()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">immgen</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">celldex</span><span class="cm-operator">::</span><span class="cm-variable">ImmGenData</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">mouseRNA</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">celldex</span><span class="cm-operator">::</span><span class="cm-variable">MouseRNAseqData</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">monacoImm</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">celldex</span><span class="cm-operator">::</span><span class="cm-variable">MonacoImmuneData</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## annotation</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">pred.mouse</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SingleR</span>(<span class="cm-variable">test</span> <span class="cm-operator">=</span> <span class="cm-variable">Seurat.data_for_SingleR</span>, <span class="cm-variable">assay.type.test</span><span class="cm-operator">=</span><span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ref</span> <span class="cm-operator">=</span> <span class="cm-builtin">list</span>(<span class="cm-variable">Immgen</span><span class="cm-operator">=</span><span class="cm-variable">immgen</span>, <span class="cm-variable">MouseRNA</span><span class="cm-operator">=</span><span class="cm-variable">mouseRNA</span>,<span class="cm-variable">MonacoImmune</span><span class="cm-operator">=</span><span class="cm-variable">monacoImm</span>), </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">labels</span> <span class="cm-operator">=</span> <span class="cm-builtin">list</span>(<span class="cm-variable">immgen</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">label.main</span>, <span class="cm-variable">mouseRNA</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">label.main</span>,<span class="cm-variable">monacoImm</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">label.main</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## Check the final label from the combined assignment.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">table</span>(<span class="cm-variable">pred.mouse</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## Check the 'winning' reference for each cell.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">table</span>(<span class="cm-variable">pred.mouse</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">reference</span>) &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">head</span>(<span class="cm-variable">pred.mouse</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orig.results</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Immgen</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span>) &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">head</span>(<span class="cm-variable">pred.mouse</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orig.results</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">MouseRNA</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">head</span>(<span class="cm-variable">pred.mouse</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orig.results</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">MonacoImmune</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## visualization</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Seurat.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">immgen</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pred.mouse</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orig.results</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">Immgen</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Seurat.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">MouseRNA</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pred.mouse</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orig.results</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">MouseRNA</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Seurat.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">MonacoImmun</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pred.mouse</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">orig.results</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">MonacoImmune</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">labels</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">library</span>(<span class="cm-variable">ggsci</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">p1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">Seurat.data</span>, <span class="cm-variable">group.by</span><span class="cm-operator">=</span><span class="cm-string">'immgen'</span>,<span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>)<span class="cm-operator">+</span><span class="cm-variable">scale_color_ucscgb</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">p2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">Seurat.data</span>, <span class="cm-variable">group.by</span><span class="cm-operator">=</span><span class="cm-string">'MouseRNA'</span>,<span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>)<span class="cm-operator">+</span><span class="cm-variable">scale_color_ucscgb</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">p3</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">DimPlot</span>(<span class="cm-variable">Seurat.data</span>, <span class="cm-variable">group.by</span><span class="cm-operator">=</span><span class="cm-string">'MonacoImmun'</span>,<span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>)<span class="cm-operator">+</span><span class="cm-variable">scale_color_ucscgb</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">library</span>(<span class="cm-variable">cowplot</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">p</span><span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">plot_grid</span>(<span class="cm-variable">p1</span>, <span class="cm-variable">p2</span>,<span class="cm-variable">p3</span>,<span class="cm-variable">nrow</span><span class="cm-operator">=</span><span class="cm-number">1</span>, <span class="cm-variable">ncol</span><span class="cm-operator">=</span><span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ggsave</span>(<span class="cm-string">"singler.pdf"</span>, <span class="cm-variable">plot</span> <span class="cm-operator">=</span> <span class="cm-variable">p</span>, <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">15</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>) &nbsp; </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1716px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1716px;"></div></div></div></pre><ol start='3' ><li><span>GarnettåŒ…</span>
<span>ï¼ˆåŸºäºç›‘ç£å­¦ä¹ çš„ä»å•ç»†èƒè¡¨è¾¾æ•°æ®ä¸­å®ç°è‡ªåŠ¨ç»†èƒç±»å‹åˆ†ç±»çš„è½¯ä»¶åŒ…ï¼‰</span></li></ol><p><font color=#FF0000><span>ï¼ï¼ï¼</span></p><p><span>è¯¥åŒ…ä¸å†æ”¯æŒåé¢æåˆ°çš„monocle2åŒ…ï¼Œç›®å‰åªæ”¯æŒmonocle3ã€‚</span></font></p><p><span>åŸç†ï¼šè·å–å•ç»†èƒæ•°æ®å’Œç»†èƒç±»å‹å®šä¹‰(marker)æ–‡ä»¶ï¼Œå¹¶è®­ç»ƒä¸€ä¸ªåŸºäºå›å½’çš„åˆ†ç±»å™¨ã€‚ä¸€æ—¦è¢«è®­ç»ƒæˆä¸€ä¸ªé’ˆå¯¹æŸä¸€ç»„ç»‡/æ ·æœ¬ç±»å‹çš„ä¸€ä¸ªåˆ†ç±»å™¨ï¼Œå®ƒå°±å¯ä»¥åº”ç”¨äºä»ç›¸ä¼¼ç»„ç»‡ä¸­å¯¹æœªæ¥çš„æ•°æ®é›†è¿›è¡Œåˆ†ç±»ï¼Œå…¶ä¸­åˆ†ç±»å™¨å¯ä»¥æ˜¯ä¸‹è½½ç°æœ‰çš„åˆ†ç±»å™¨æˆ–è€…è®­ç»ƒè‡ªå·±çš„åˆ†ç±»å™¨ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggsci</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">Seurat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">dplyr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">tibble</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">garnett</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">monocle</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 1. create monocle object from seurat</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">load</span>(<span class="cm-string">"~/project/sc_standard_procedure/1_framework/Seurat/3.2.3_with_SCTransform/regress_nothing/pc10/pbmc.rda"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mat</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pbmc</span>@<span class="cm-variable">assays</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">SCT</span>@<span class="cm-variable">counts</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fdata</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">mat</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">gene_short_name</span> <span class="cm-operator">=</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">mat</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stringsAsFactors</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pdata</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pbmc</span>@<span class="cm-variable">reductions</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">tsne</span>@<span class="cm-variable">cell.embeddings</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stringsAsFactors</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rownames</span>(<span class="cm-variable">mat</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">fdata</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">colnames</span>(<span class="cm-variable">mat</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">pdata</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pd</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">new</span>(<span class="cm-string">"AnnotatedDataFrame"</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">pdata</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fd</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">new</span>(<span class="cm-string">"AnnotatedDataFrame"</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">fdata</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc3k_cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">newCellDataSet</span>(<span class="cm-variable">as</span>(<span class="cm-variable">mat</span>, <span class="cm-string">"dgCMatrix"</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">phenoData</span> <span class="cm-operator">=</span> <span class="cm-variable">pd</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">featureData</span> <span class="cm-operator">=</span> <span class="cm-variable">fd</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc3k_cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">estimateSizeFactors</span>(<span class="cm-variable">pbmc3k_cds</span>) <span class="cm-comment"># å½’ä¸€åŒ–</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 2. choose classifier and  classify</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">classifier</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readRDS</span>(<span class="cm-string">"~/project/sc_standard_procedure/2_annotation/garnett/pre_trained_classifier/hsPBMC_20191017.RDS"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">org.Hs.eg.db</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc3k_cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">classify_cells</span>(<span class="cm-variable">pbmc3k_cds</span>, <span class="cm-variable">classifier</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">db</span> <span class="cm-operator">=</span> <span class="cm-variable">org.Hs.eg.db</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cluster_extend</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cds_gene_id_type</span> <span class="cm-operator">=</span> <span class="cm-string">"SYMBOL"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">table</span>(<span class="cm-variable">pData</span>(<span class="cm-variable">pbmc3k_cds</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">cell_type</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">table</span>(<span class="cm-variable">pData</span>(<span class="cm-variable">pbmc3k_cds</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">cluster_ext_type</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 3. plot</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">seurat_celltype</span> <span class="cm-operator">=</span> <span class="cm-variable">Idents</span>(<span class="cm-variable">pbmc</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">garnett_cell_type</span> <span class="cm-operator">=</span> <span class="cm-variable">pData</span>(<span class="cm-variable">pbmc3k_cds</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">cell_type</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">garnett_cluster_ext_type</span> <span class="cm-operator">=</span> <span class="cm-variable">pData</span>(<span class="cm-variable">pbmc3k_cds</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">cluster_ext_type</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stringsAsFactors</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cbind</span>(<span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span>, <span class="cm-variable">x</span>, <span class="cm-variable">stringsAsFactors</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plist</span> <span class="cm-operator">=</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">colnames</span>(<span class="cm-variable">x</span>), <span class="cm-keyword">function</span>(<span class="cm-variable">col</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">DimPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">reduction</span><span class="cm-operator">=</span><span class="cm-string">"umap"</span>, <span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-variable">col</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>, <span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">1.5</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">labs</span>(<span class="cm-variable">title</span> <span class="cm-operator">=</span> <span class="cm-variable">col</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">scale_colour_d3</span>(<span class="cm-string">"category20"</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">rj.ftheme</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"garnett_compare_all_1.png"</span>, <span class="cm-variable">CombinePlots</span>(<span class="cm-variable">plist</span>, <span class="cm-variable">ncol</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>), <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">16</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">4</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"garnett_compare_all_2.png"</span>, <span class="cm-variable">CombinePlots</span>(<span class="cm-variable">plist</span>, <span class="cm-variable">ncol</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>), <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">16</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">4</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">writeLines</span>(<span class="cm-variable">capture.output</span>(<span class="cm-variable">sessionInfo</span>()), <span class="cm-string">"sessionInfo.txt"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#----------------------------------------------------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; test &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  -</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#----------------------------------------------------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 1 create monocle object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mat</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">Matrix</span><span class="cm-operator">::</span><span class="cm-variable">readMM</span>(<span class="cm-variable">system.file</span>(<span class="cm-string">"extdata"</span>, <span class="cm-string">"exprs_sparse.mtx"</span>, <span class="cm-variable">package</span> <span class="cm-operator">=</span> <span class="cm-string">"garnett"</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fdata</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.table</span>(<span class="cm-variable">system.file</span>(<span class="cm-string">"extdata"</span>, <span class="cm-string">"fdata.txt"</span>, <span class="cm-variable">package</span> <span class="cm-operator">=</span> <span class="cm-string">"garnett"</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pdata</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.table</span>(<span class="cm-variable">system.file</span>(<span class="cm-string">"extdata"</span>, <span class="cm-string">"pdata.txt"</span>, <span class="cm-variable">package</span> <span class="cm-operator">=</span> <span class="cm-string">"garnett"</span>), <span class="cm-variable">sep</span><span class="cm-operator">=</span><span class="cm-string">"</span><span class="cm-string-2">\t</span><span class="cm-string">"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">row.names</span>(<span class="cm-variable">mat</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">row.names</span>(<span class="cm-variable">fdata</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">colnames</span>(<span class="cm-variable">mat</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">row.names</span>(<span class="cm-variable">pdata</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pd</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">new</span>(<span class="cm-string">"AnnotatedDataFrame"</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">pdata</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fd</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">new</span>(<span class="cm-string">"AnnotatedDataFrame"</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">fdata</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc_cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">newCellDataSet</span>(<span class="cm-variable">as</span>(<span class="cm-variable">mat</span>, <span class="cm-string">"dgCMatrix"</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">phenoData</span> <span class="cm-operator">=</span> <span class="cm-variable">pd</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">featureData</span> <span class="cm-operator">=</span> <span class="cm-variable">fd</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc_cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">estimateSizeFactors</span>(<span class="cm-variable">pbmc_cds</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 2 check marker</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">org.Hs.eg.db</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marker_file_path</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">system.file</span>(<span class="cm-string">"extdata"</span>, <span class="cm-string">"pbmc_bad_markers.txt"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">package</span> <span class="cm-operator">=</span> <span class="cm-string">"garnett"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marker_check</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">check_markers</span>(<span class="cm-variable">pbmc_cds</span>, <span class="cm-variable">marker_file_path</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">db</span><span class="cm-operator">=</span><span class="cm-variable">org.Hs.eg.db</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cds_gene_id_type</span> <span class="cm-operator">=</span> <span class="cm-string">"SYMBOL"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">marker_file_gene_id_type</span> <span class="cm-operator">=</span> <span class="cm-string">"SYMBOL"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_markers</span>(<span class="cm-variable">marker_check</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 3 train classifier</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">org.Hs.eg.db</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set.seed</span>(<span class="cm-number">260</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marker_file_path</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">system.file</span>(<span class="cm-string">"extdata"</span>, <span class="cm-string">"pbmc_test.txt"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">package</span> <span class="cm-operator">=</span> <span class="cm-string">"garnett"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc_classifier</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">train_cell_classifier</span>(<span class="cm-variable">cds</span> <span class="cm-operator">=</span> <span class="cm-variable">pbmc_cds</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">marker_file</span> <span class="cm-operator">=</span> <span class="cm-variable">marker_file_path</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">db</span><span class="cm-operator">=</span><span class="cm-variable">org.Hs.eg.db</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cds_gene_id_type</span> <span class="cm-operator">=</span> <span class="cm-string">"SYMBOL"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">num_unknown</span> <span class="cm-operator">=</span> <span class="cm-number">50</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">marker_file_gene_id_type</span> <span class="cm-operator">=</span> <span class="cm-string">"SYMBOL"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">feature_genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">get_feature_genes</span>(<span class="cm-variable">pbmc_classifier</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">node</span> <span class="cm-operator">=</span> <span class="cm-string">"root"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">db</span> <span class="cm-operator">=</span> <span class="cm-variable">org.Hs.eg.db</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">get_classifier_references</span>(<span class="cm-variable">pbmc_classifier</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 4 classify your cells</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">org.Hs.eg.db</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc_cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">classify_cells</span>(<span class="cm-variable">pbmc_cds</span>, <span class="cm-variable">pbmc_classifier</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">db</span> <span class="cm-operator">=</span> <span class="cm-variable">org.Hs.eg.db</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cluster_extend</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cds_gene_id_type</span> <span class="cm-operator">=</span> <span class="cm-string">"SYMBOL"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">table</span>(<span class="cm-variable">pData</span>(<span class="cm-variable">pbmc_cds</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">cell_type</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">table</span>(<span class="cm-variable">pData</span>(<span class="cm-variable">pbmc_cds</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">cluster_ext_type</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pdf</span>(<span class="cm-string">"result.pdf"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qplot</span>(<span class="cm-variable">tsne_1</span>, <span class="cm-variable">tsne_2</span>, <span class="cm-variable">color</span> <span class="cm-operator">=</span> <span class="cm-variable">cell_type</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">pData</span>(<span class="cm-variable">pbmc_cds</span>)) <span class="cm-operator">+</span> <span class="cm-variable">theme_bw</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qplot</span>(<span class="cm-variable">tsne_1</span>, <span class="cm-variable">tsne_2</span>, <span class="cm-variable">color</span> <span class="cm-operator">=</span> <span class="cm-variable">cluster_ext_type</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">pData</span>(<span class="cm-variable">pbmc_cds</span>)) <span class="cm-operator">+</span> <span class="cm-variable">theme_bw</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qplot</span>(<span class="cm-variable">tsne_1</span>, <span class="cm-variable">tsne_2</span>, <span class="cm-variable">color</span> <span class="cm-operator">=</span> <span class="cm-variable">FACS_type</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">pData</span>(<span class="cm-variable">pbmc_cds</span>)) <span class="cm-operator">+</span> <span class="cm-variable">theme_bw</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dev.off</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 3212px;"></div><div class="CodeMirror-gutters" style="display: none; height: 3212px;"></div></div></div></pre><ol start='4' ><li><span>scibetåŒ…</span></li></ol><p><span>åŸç†ï¼šç»è¿‡å¤§é‡çš„ç»Ÿè®¡åˆ†æå’Œåç»­çš„å®éªŒéªŒè¯ï¼Œå•ç»†èƒåŸºå› è¡¨è¾¾çš„count(æ¯”å¦‚UMI count)çš„åˆ†å¸ƒå¯ä»¥ç”¨è´ŸäºŒé¡¹åˆ†å¸ƒå¾ˆå¥½çš„æ‹Ÿåˆ,ä¸”ç›¸åŒç»†èƒç±»å‹çš„å•ç»†èƒè¡¨è¾¾è°±æœä»åŒä¸€ä¸ªåˆ†å¸ƒã€‚å› æ­¤å°†å•ç»†èƒåŸºå› è¡¨è¾¾çš„countè¡¨ç¤ºä¸ºæ³Šæ¾åˆ†å¸ƒçš„ä¼½é©¬åˆ†å¸ƒçš„æ··åˆåˆ†å¸ƒï¼Œæ¥ç€æ ¹æ®è¡¨è¾¾æ•°æ®è®¡ç®—ä¿¡æ¯ç†µï¼ŒæŒ‘å‡ºé‚£äº›èƒ½è¡¨ç¤ºä¸åŒç°‡ç»†èƒä¹‹é—´å·®å¼‚è¡¨è¾¾çš„åŸºå› ï¼Œä½¿ç”¨E-testä»¥æœ‰ç›‘ç£å’Œå‚æ•°åŒ–çš„æ–¹å¼ä»è®­ç»ƒé›†ä¸­é€‰æ‹©ç»†èƒç±»å‹ç‰¹å¼‚æ€§åŸºå› ï¼Œä»¥å»é™¤å˜ˆæ‚çš„åŸºå› ä»¥åŠé€šè¿‡å‹ç¼©æ¨¡å‹æ¥åŠ é€Ÿä¸‹æ¸¸åˆ†ç±»ï¼Œæœ€åæ„å»ºå‡ºåŸºäºç›‘ç£å­¦ä¹ çš„æ¨¡å‹ï¼Œä»è€Œå¯¹ç»†èƒç±»å‹è¿›è¡Œæ³¨é‡Šã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">scibet</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">celldex</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggsci</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">Seurat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">dplyr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">tibble</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">viridis</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#----------------------------------------------------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-test &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  -</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#----------------------------------------------------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">load</span>(<span class="cm-string">"~/project/sc_standard_procedure/1_framework/Seurat/3.2.3_with_SCTransform/regress_nothing/pc10/pbmc.rda"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">expr</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">as.data.frame</span>(<span class="cm-variable">t</span>(<span class="cm-variable">pbmc</span>@<span class="cm-variable">assays</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">SCT</span>@<span class="cm-variable">data</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">expr</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">label</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">Idents</span>(<span class="cm-variable">pbmc</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">etest_gene</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SelectGene</span>(<span class="cm-variable">expr</span>, <span class="cm-variable">k</span> <span class="cm-operator">=</span> <span class="cm-number">500</span>, <span class="cm-variable">r</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"marker_heatmap.png"</span>, <span class="cm-variable">Marker_heatmap</span>(<span class="cm-variable">expr</span>, <span class="cm-variable">etest_gene</span>), <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">30</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">6</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#----------------------------------------------------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; training model &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  -</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#----------------------------------------------------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">num2</span> <span class="cm-operator">=</span> <span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">num1</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">while</span> ( (<span class="cm-variable">num2</span><span class="cm-operator">/</span><span class="cm-variable">num1</span>) <span class="cm-operator">&lt;</span> <span class="cm-number">0.92</span> ) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># traning </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">tibble</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ID</span> <span class="cm-arg-is">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-variable">nrow</span>(<span class="cm-variable">expr</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">label</span> <span class="cm-arg-is">=</span> <span class="cm-variable">expr</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">label</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ) <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">dplyr</span><span class="cm-operator">::</span><span class="cm-variable">sample_frac</span>(<span class="cm-number">0.7</span>) <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">dplyr</span><span class="cm-operator">::</span><span class="cm-variable">pull</span>(<span class="cm-variable">ID</span>) <span class="cm-operator cm-arrow">-&gt;</span> <span class="cm-variable">ID</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">train_set</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">expr</span>[<span class="cm-variable">ID</span>,] &nbsp; &nbsp; &nbsp;<span class="cm-comment">#construct reference set</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">test_set</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">expr</span>[<span class="cm-operator">-</span><span class="cm-variable">ID</span>,] &nbsp; &nbsp; &nbsp;<span class="cm-comment">#construct query set</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">prd</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">SciBet</span>(<span class="cm-variable">train_set</span>, <span class="cm-variable">test_set</span>[,<span class="cm-operator">-</span><span class="cm-variable">ncol</span>(<span class="cm-variable">test_set</span>)], <span class="cm-variable">k</span> <span class="cm-operator">=</span> <span class="cm-number">500</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># check accuracy</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">ori_label</span> <span class="cm-operator">=</span> <span class="cm-variable">test_set</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">label</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">prd</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">num1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">length</span>(<span class="cm-variable">ori_label</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">num2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">tibble</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ori</span> <span class="cm-arg-is">=</span> <span class="cm-variable">ori_label</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">prd</span> <span class="cm-arg-is">=</span> <span class="cm-variable">label</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ) <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">dplyr</span><span class="cm-operator">::</span><span class="cm-variable">filter</span>(<span class="cm-variable">ori</span> <span class="cm-operator">==</span> <span class="cm-variable">prd</span>) <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">nrow</span>(<span class="cm-variable">.</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">print</span>(<span class="cm-variable">num2</span><span class="cm-operator">/</span><span class="cm-variable">num1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span> <span class="cm-operator">=</span> <span class="cm-variable">Learn</span>(<span class="cm-variable">train_set</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">export_model</span> <span class="cm-operator">=</span> <span class="cm-variable">ExportModel</span>(<span class="cm-variable">model</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">write.csv</span>(<span class="cm-variable">t</span>(<span class="cm-variable">export_model</span>), <span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"pbmc3k_export_model.csv"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># check model</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"confusion_heatmap.png"</span>, <span class="cm-variable">Confusion_heatmap</span>(<span class="cm-variable">as.character</span>(<span class="cm-variable">test_set</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">label</span>), <span class="cm-variable">prd</span>), <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">8</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">7</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#----------------------------------------------------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; annotation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  -</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#----------------------------------------------------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">load</span>(<span class="cm-string">"~/project/sc_standard_procedure/1_preprocessing_clustering/Seurat/3.2.3_with_SCTransform/regress_nothing/pc10/pbmc.rda"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">expr</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">as.data.frame</span>(<span class="cm-variable">t</span>(<span class="cm-variable">pbmc</span>@<span class="cm-variable">assays</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">SCT</span>@<span class="cm-variable">data</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ori_label</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">SCT_snn_res.0.6</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># reference</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ref_list</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">c</span>(<span class="cm-string">"./reference/major_human_cell_types.csv"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"./reference/GSE84465_scibet_core.csv"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"./reference/GSE109774_scibet_core.csv"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"./50gene_training_model/50gene_pbmc3k_export_model.csv"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"./500gene_training_model/500gene_pbmc3k_export_model.csv"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># predict</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">label</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">sapply</span>(<span class="cm-variable">ref_list</span>, <span class="cm-keyword">function</span>(<span class="cm-variable">ref</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># load traning model</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">model</span> <span class="cm-operator">=</span> <span class="cm-variable">read.csv</span>(<span class="cm-variable">ref</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">colnames</span>(<span class="cm-variable">model</span>) <span class="cm-operator">=</span> <span class="cm-variable">toupper</span>(<span class="cm-variable">colnames</span>(<span class="cm-variable">model</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">model</span> <span class="cm-operator">=</span> <span class="cm-variable">pro.core</span>(<span class="cm-variable">model</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment"># predict</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">prd</span> <span class="cm-operator">=</span> <span class="cm-variable">LoadModel</span>(<span class="cm-variable">model</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">prd</span>(<span class="cm-variable">expr</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">label_df</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">label</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">colnames</span>(<span class="cm-variable">label_df</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">stringr</span><span class="cm-operator">::</span><span class="cm-variable">str_split_fixed</span>(<span class="cm-variable">colnames</span>(<span class="cm-variable">label_df</span>),<span class="cm-string">"</span><span class="cm-string-2">\\</span><span class="cm-string">."</span>,<span class="cm-number">5</span>)[,<span class="cm-number">4</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># plot</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">x</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">seurat_celltype</span> <span class="cm-operator">=</span> <span class="cm-variable">Idents</span>(<span class="cm-variable">pbmc</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">label_df</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stringsAsFactors</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cbind</span>(<span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span>, <span class="cm-variable">x</span>, <span class="cm-variable">stringsAsFactors</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plist</span> <span class="cm-operator">=</span> <span class="cm-variable">lapply</span>(<span class="cm-variable">colnames</span>(<span class="cm-variable">x</span>), <span class="cm-keyword">function</span>(<span class="cm-variable">col</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">DimPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">reduction</span><span class="cm-operator">=</span><span class="cm-string">"umap"</span>, <span class="cm-variable">group.by</span> <span class="cm-operator">=</span> <span class="cm-variable">col</span>, <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>, <span class="cm-variable">pt.size</span> <span class="cm-operator">=</span> <span class="cm-number">1.5</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">labs</span>(<span class="cm-variable">title</span> <span class="cm-operator">=</span> <span class="cm-variable">col</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">#scale_colour_d3("category20") + </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">rj.ftheme</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"scibet_compare_all_1.png"</span>, <span class="cm-variable">CombinePlots</span>(<span class="cm-variable">plist</span>[<span class="cm-operator">-</span><span class="cm-number">4</span>], <span class="cm-variable">ncol</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>), <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">11</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">11</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"scibet_compare_all_2.png"</span>, <span class="cm-variable">CombinePlots</span>(<span class="cm-variable">plist</span>[<span class="cm-number">4</span>], <span class="cm-variable">ncol</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>), <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">11</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">writeLines</span>(<span class="cm-variable">capture.output</span>(<span class="cm-variable">sessionInfo</span>()), <span class="cm-string">"sessionInfo.txt"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 2728px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2728px;"></div></div></div></pre><ol start='5' ><li><span>PanglaoDB</span></li></ol><p><img src="images/image-20220107171424266.png" referrerpolicy="no-referrer"></p><p><span>æ ¹æ®æ•°æ®ç±»å‹ï¼Œé€‰æ‹©æ‰€æƒ³è¦çš„markerå‚è€ƒåŸºå› é›†ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">celltype</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.table</span>(<span class="cm-string">'PanglaoDB_markers_27_Mar_2020.tsv'</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">sep</span> <span class="cm-operator">=</span> <span class="cm-string">'</span><span class="cm-string-2">\t</span><span class="cm-string">'</span>,<span class="cm-variable">header</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>,<span class="cm-variable">stringsAsFactors</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">iHyperGD</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-keyword">function</span>(<span class="cm-variable">backGround</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">geneNum.pathway</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">geneNum.check</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">geneNum.located</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">1</span><span class="cm-operator">-</span><span class="cm-variable">phyper</span>(<span class="cm-variable">geneNum.located</span><span class="cm-operator">-</span><span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">geneNum.pathway</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">backGround</span> <span class="cm-operator">-</span> <span class="cm-variable">geneNum.pathway</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">geneNum.check</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">lower.tail</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">hyperType</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-keyword">function</span>(<span class="cm-variable">genes</span>,<span class="cm-variable">type</span>,<span class="cm-variable">backGround</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geneNum.pathway</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">length</span>(<span class="cm-variable">which</span>(<span class="cm-variable">celltype</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cell.type</span> <span class="cm-operator">==</span> <span class="cm-variable">type</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geneNum.check</span> &nbsp; <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">length</span>(<span class="cm-variable">genes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">geneNum.located</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">sum</span>(<span class="cm-variable">genes</span> <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">celltype</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">official.gene.symbol</span>[<span class="cm-variable">which</span>(<span class="cm-variable">celltype</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cell.type</span> <span class="cm-operator">==</span> <span class="cm-variable">type</span>)])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">iHyperGD</span>(<span class="cm-variable">backGround</span>,<span class="cm-variable">geneNum.pathway</span>,<span class="cm-variable">geneNum.check</span>,<span class="cm-variable">geneNum.located</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cellTypeEst_hyper</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-keyword">function</span>(<span class="cm-variable">cluster</span>,<span class="cm-variable">m</span>,<span class="cm-variable">backGround</span> <span class="cm-operator">=</span> <span class="cm-number">2000</span>,<span class="cm-variable">type</span> <span class="cm-operator">=</span> <span class="cm-atom">NA</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">m</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">gene</span>[<span class="cm-variable">which</span>(<span class="cm-variable">m</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cluster</span> <span class="cm-operator">==</span> <span class="cm-variable">cluster</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">p.val</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">c</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">is.na</span>(<span class="cm-variable">type</span>)){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">Type</span> <span class="cm-keyword">in</span> <span class="cm-variable">unique</span>(<span class="cm-variable">celltype</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cell.type</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">p.val</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">c</span>(<span class="cm-variable">p.val</span>,<span class="cm-variable">hyperType</span>(<span class="cm-variable">genes</span>,<span class="cm-variable">Type</span>,<span class="cm-variable">backGround</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">names</span>(<span class="cm-variable">p.val</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">unique</span>(<span class="cm-variable">celltype</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">cell.type</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">sort</span>(<span class="cm-variable">p.val</span>,<span class="cm-variable">decreasing</span> <span class="cm-operator">=</span> <span class="cm-variable">F</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ä¸€æ¬¡ä¸€ä¸ªåˆ†ç°‡</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cellTypeEst_hyper</span>(<span class="cm-number">2</span>,<span class="cm-variable">m</span><span class="cm-operator">=</span><span class="cm-variable">pbmc.markers</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-keyword">in</span> (<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">6</span>)){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">print</span>(<span class="cm-variable">cellTypeEst_hyper</span>(<span class="cm-variable">i</span>,<span class="cm-variable">m</span><span class="cm-operator">=</span><span class="cm-variable">pbmc.markers</span>)[<span class="cm-number">1</span>])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 880px;"></div><div class="CodeMirror-gutters" style="display: none; height: 880px;"></div></div></div></pre><p>&nbsp;</p><h4 id='æ„å»ºå•ç»†èƒè½¨è¿¹'><span>æ„å»ºå•ç»†èƒè½¨è¿¹</span></h4><p><span>ä¸»è¦ä½¿ç”¨Monocle2å’ŒMonocle3åŒ…ã€‚</span></p><blockquote><p><span>ä¼ªæ—¶é—´åˆ†æ</span></p></blockquote><p><span>å…¶åŠŸèƒ½åŸºäºå•ç»†èƒè½¬å½•ç»„çš„è¡¨è¾¾çŸ©é˜µï¼Œé€šè¿‡æ— ç›‘ç£å­¦ä¹ ï¼ˆReversed Graph Embeddingç®—æ³•ï¼‰çš„æ–¹å¼å°†ç»†èƒç½®äºå‘è‚²è½¨è¿¹çš„ä¸åŒåˆ†æ”¯ä¸Šï¼Œä»è€Œæ¨¡æ‹Ÿç»†èƒç¾¤ä½“ç”Ÿç‰©å­¦è¿‡ç¨‹ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„æ‹Ÿæ—¶åºï¼ˆpseudotimeï¼‰åˆ†æï¼Œåˆç§°ç»†èƒè½¨è¿¹ï¼ˆcell trajectoryï¼‰åˆ†æã€‚é€šè¿‡æ‹Ÿæ—¶åºåˆ†æå¯ä»¥æ¨æ–­å‡ºå‘è‚²è¿‡ç¨‹ç»†èƒçš„åˆ†åŒ–è½¨è¿¹æˆ–ç»†èƒäºšå‹çš„æ¼”åŒ–è¿‡ç¨‹ï¼Œä¸»è¦åŸºäºå…³é”®åŸºå› çš„è¡¨è¾¾æ¨¡å¼ï¼Œé€šè¿‡å­¦ä¹ æ¯ä¸ªç»†èƒå¿…é¡»ç»å†çš„åŸºå› è¡¨è¾¾å˜åŒ–çš„åºåˆ—ï¼Œæ ¹æ®æ‹Ÿæ—¶é—´å€¼ä¸­å¯¹å•ä¸ªç»†èƒè¿›è¡Œæ’åºï¼Œæ¨¡æ‹Ÿå‡ºæ—¶é—´å‘è‚²è¿‡ç¨‹çš„åŠ¨æ€å˜åŒ–ã€‚</span>
<br><span> </span>
<b><mark><span>ä¼ªæ—¶é—´æ˜¯è¡¡é‡å•ä¸ªç»†èƒé€šè¿‡ç»†èƒåˆ†åŒ–ç­‰è¿‡ç¨‹å–å¾—å¤šå°‘è¿›å±•çš„æŒ‡æ ‡ </span></mark></b><span>Monocle ä¸æ˜¯è·Ÿè¸ªä½œä¸ºæ—¶é—´å‡½æ•°çš„è¡¨è¾¾å˜åŒ–ï¼Œè€Œæ˜¯è·Ÿè¸ªä½œä¸ºæ²¿è½¨è¿¹è¿›å±•çš„å‡½æ•°çš„å˜åŒ–ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä¼ªæ—¶é—´ã€‚ä¼ªæ—¶é—´æ˜¯ä¸€ä¸ªæŠ½è±¡çš„è¿›ç¨‹å•ä½ï¼šå®ƒåªæ˜¯ä¸€ä¸ªå•å…ƒæ ¼å’Œè½¨è¿¹èµ·ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œæ²¿ç€æœ€çŸ­è·¯å¾„æµ‹é‡ã€‚è½¨è¿¹çš„æ€»é•¿åº¦æ˜¯æ ¹æ®ç»†èƒä»èµ·å§‹çŠ¶æ€ç§»åŠ¨åˆ°ç»“æŸçŠ¶æ€æ—¶æ‰€ç»å†çš„è½¬å½•å˜åŒ–æ€»é‡æ¥å®šä¹‰çš„ã€‚</span></p><blockquote><p><span>æ­¥éª¤</span></p></blockquote><ol start='' ><li><span>å¯¼å…¥æ•°æ®ï¼Œåˆ›å»ºCellDataSet ç±»çš„å¯¹è±¡</span></li></ol><ul><li><span>å¯¼å…¥æ•°æ®ï¼Œåˆ›å»ºCellDataSet ç±»çš„å¯¹è±¡</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM_expr_matrix</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.table</span>(<span class="cm-string">"fpkm_matrix.txt"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM_sample_sheet</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.delim</span>(<span class="cm-string">"cell_sample_sheet.txt"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM_gene_annotation</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.delim</span>(<span class="cm-string">"gene_annotations.txt"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pd</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">new</span>(<span class="cm-string">"AnnotatedDataFrame"</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">HSMM_sample_sheet</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fd</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">new</span>(<span class="cm-string">"AnnotatedDataFrame"</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">HSMM_gene_annotation</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">newCellDataSet</span>(<span class="cm-variable">as.matrix</span>(<span class="cm-variable">HSMM_expr_matrix</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">phenoData</span> <span class="cm-operator">=</span> <span class="cm-variable">pd</span>, <span class="cm-variable">featureData</span> <span class="cm-operator">=</span> <span class="cm-variable">fd</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rm</span>(<span class="cm-builtin">list</span><span class="cm-operator">=</span><span class="cm-variable">ls</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># åŠ è½½éœ€è¦çš„RåŒ…</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">Seurat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">monocle</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># è®¾ç½®cell rangerè¾“å‡ºç»“æœç›®å½•</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">input_dir</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"/Users/hecate/ç ”ä¸€/blood_vessels_scRNA/matrix/BK-1111_matrix_10X"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># è¯»å–æ•°æ®</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">Read10X</span>(<span class="cm-variable">input_dir</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">CreateSeuratObject</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">project</span> <span class="cm-operator">=</span> <span class="cm-string">"pbmc10k"</span>, <span class="cm-variable">min.cells</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>, <span class="cm-variable">min.features</span> <span class="cm-operator">=</span> <span class="cm-number">200</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">data</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">as</span>(<span class="cm-variable">as.matrix</span>(<span class="cm-variable">pbmc</span>@<span class="cm-variable">assays</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">RNA</span>@<span class="cm-variable">data</span>), <span class="cm-string">'sparseMatrix'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pd</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">new</span>(<span class="cm-string">'AnnotatedDataFrame'</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">pbmc</span>@<span class="cm-variable">meta.data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fData</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">gene_short_name</span> <span class="cm-operator">=</span> <span class="cm-variable">row.names</span>(<span class="cm-variable">data</span>), <span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-variable">row.names</span>(<span class="cm-variable">data</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fd</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">new</span>(<span class="cm-string">'AnnotatedDataFrame'</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">fData</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Construct monocle cds</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">newCellDataSet</span>(<span class="cm-variable">data</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">phenoData</span> <span class="cm-operator">=</span> <span class="cm-variable">pd</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">featureData</span> <span class="cm-operator">=</span> <span class="cm-variable">fd</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lowerDetectionLimit</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">expressionFamily</span> <span class="cm-operator">=</span> <span class="cm-variable">negbinomial.size</span>())</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 726px;"></div><div class="CodeMirror-gutters" style="display: none; height: 726px;"></div></div></div></pre><p><b><span>å¯¼å…¥å’Œå¯¼å‡ºSeuratæˆ–è€…scateråŒ…çš„æ•°æ®</span><font color=#FF0000><span>ï¼ˆåœ¨åšæ‹Ÿæ—¶åºä¹‹å‰ï¼Œæœ€å¥½å…ˆè·‘å®Œseuratæ ‡å‡†æµç¨‹ï¼Œå¹¶æ³¨é‡Šå¥½ç»†èƒç±»å‹ã€‚ï¼‰</span></b></font></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM_expr_matrix</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.table</span>(<span class="cm-string">"fpkm_matrix.txt"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM_sample_sheet</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.delim</span>(<span class="cm-string">"cell_sample_sheet.txt"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM_gene_annotation</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.delim</span>(<span class="cm-string">"gene_annotations.txt"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pd</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">new</span>(<span class="cm-string">"AnnotatedDataFrame"</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">HSMM_sample_sheet</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fd</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">new</span>(<span class="cm-string">"AnnotatedDataFrame"</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">HSMM_gene_annotation</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">newCellDataSet</span>(<span class="cm-variable">as.matrix</span>(<span class="cm-variable">HSMM_expr_matrix</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">phenoData</span> <span class="cm-operator">=</span> <span class="cm-variable">pd</span>, <span class="cm-variable">featureData</span> <span class="cm-operator">=</span> <span class="cm-variable">fd</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ä¸Seuratï¼Œscaterç­‰RåŒ…çš„äº¤äº’</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## å¯¼å…¥ importCDS()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Where 'data_to_be_imported' can either be a Seurat object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># or an SCESet.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">importCDS</span>(<span class="cm-variable">data_to_be_imported</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># We can set the parameter 'import_all' to TRUE if we'd like to</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># import all the slots from our Seurat object or SCESet.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># (Default is FALSE or only keep minimal dataset)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">importCDS</span>(<span class="cm-variable">data_to_be_imported</span>, <span class="cm-variable">import_all</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## å¯¼å‡º exportCDS()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># To convert to Seurat object</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">lung_seurat</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">exportCDS</span>(<span class="cm-variable">lung</span>, <span class="cm-string">'Seurat'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># To convert to SCESet</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">lung_SCESet</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">exportCDS</span>(<span class="cm-variable">lung</span>, <span class="cm-string">'Scater'</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 594px;"></div><div class="CodeMirror-gutters" style="display: none; height: 594px;"></div></div></div></pre><ul><li><span>é€‰æ‹©æ•°æ®çš„åˆ†å¸ƒç±»å‹â—â—â—ï¸</span>
<span>Monocle é€‚ç”¨äºç›¸å¯¹è¡¨è¾¾æ•°æ®å’ŒåŸºäºè®¡æ•°çš„æµ‹é‡ï¼ˆä¾‹å¦‚ UMIï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå®ƒæœ€é€‚ç”¨äºè½¬å½•æœ¬è®¡æ•°æ•°æ®ï¼Œå°¤å…¶æ˜¯ UMI æ•°æ®ã€‚</span><font color=#FF0000><span>FPKM/TPM å€¼é€šå¸¸å‘ˆå¯¹æ•°æ­£æ€åˆ†å¸ƒï¼Œè€Œ UMI æˆ–è¯»å–è®¡æ•°æ›´é€‚åˆä½¿ç”¨è´ŸäºŒé¡¹å¼åˆ†å¸ƒå»ºæ¨¡ã€‚</span></font></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">newCellDataSet</span>(<span class="cm-variable">count_matrix</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">phenoData</span> <span class="cm-operator">=</span> <span class="cm-variable">pd</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">featureData</span> <span class="cm-operator">=</span> <span class="cm-variable">fd</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">expressionFamily</span><span class="cm-operator">=</span><span class="cm-variable">negbinomial.size</span>())</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><table>
<tbody><tr><td>negbinomial.size()</td><td>UMIã€æ¥è‡ªæºå…¥å®éªŒçš„è½¬å½•æœ¬è®¡æ•°æˆ–relative2abs()åŸå§‹è¯»å–è®¡æ•°</td></tr>
<tr><td>negbinomial()</td><td>UMIã€æ¥è‡ªæºå…¥å®éªŒçš„è½¬å½•æœ¬è®¡æ•°æˆ–relative2absåŸå§‹è¯»å–è®¡æ•°</td></tr>
<tr><td>tobit()</td><td>FPKMã€TPM</td></tr>
<tr><td>gaussianff()</td><td>å¯¹æ•°è½¬æ¢çš„ FPKM/TPMï¼Œæ¥è‡ªå•ç»†èƒ qPCR çš„ Ct å€¼</td></tr>
</tbody></table><ul><li><span>ä½¿ç”¨å¤§å‹æ•°æ®é›†ï¼ˆæ¨èï¼‰</span>
<span>ä½¿ç”¨</span><em><span>ç¨€ç–çŸ©é˜µ</span></em><span>å¯ä»¥å¸®åŠ©æ‚¨åœ¨å…¸å‹è®¡ç®—æœºä¸Šå¤„ç†å¤§é‡æ•°æ®é›†ã€‚æˆ‘ä»¬é€šå¸¸å»ºè®®å¤§å¤šæ•°ç”¨æˆ·ä½¿ç”¨ sparseMatricesï¼Œå› ä¸ºå®ƒå¯ä»¥åŠ é€Ÿè®¸å¤šè®¡ç®—ï¼Œå³ä½¿å¯¹äºè¾ƒå°è§„æ¨¡çš„æ•°æ®é›†ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">newCellDataSet</span>(<span class="cm-variable">as</span>(<span class="cm-variable">umi_matrix</span>, <span class="cm-string">"sparseMatrix"</span>),</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">phenoData</span> <span class="cm-operator">=</span> <span class="cm-variable">pd</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">featureData</span> <span class="cm-operator">=</span> <span class="cm-variable">fd</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lowerDetectionLimit</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">expressionFamily</span> <span class="cm-operator">=</span> <span class="cm-variable">negbinomial.size</span>())</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>â—â—â—ï¸è®¸å¤š RNA-Seq æµç¨‹ï¼ˆåŒ…æ‹¬ CellRangerï¼‰çš„è¾“å‡ºå·²ç»æ˜¯ç¨€ç–çŸ©é˜µæ ¼å¼ï¼ˆä¾‹å¦‚ MTXï¼‰ã€‚è¿™æ—¶ç›´æ¥å°†å…¶ä¼ é€’ç»™newCellDataSetï¼Œè€Œæ— éœ€å…ˆå°†å…¶è½¬æ¢ä¸ºå¯†é›†çŸ©é˜µï¼ˆé€šè¿‡as.matrix()ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šè¶…å‡ºå¯ç”¨å†…å­˜ã€‚</span>
<br><span>å¦‚æœä½¿ç”¨çš„æ˜¯</span><font color=#0000FF><span>10X Genomics æ•°æ®å¹¶ä¸”æ­£åœ¨ä½¿ç”¨cellrangerRkitï¼Œä½¿ç”¨ä¸‹åˆ—ä»£ç è¿›è¡ŒåŠ è½½è¯¥æ•°æ®ã€‚</span></font></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cellranger_pipestance_path</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"/path/to/your/pipeline/output/directory"</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gbm</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">load_cellranger_matrix</span>(<span class="cm-variable">cellranger_pipestance_path</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fd</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fData</span>(<span class="cm-variable">gbm</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># The number 2 is picked arbitrarily in the line below.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Where "2" is placed you should place the column number that corresponds to your</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># featureData's gene short names.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">colnames</span>(<span class="cm-variable">fd</span>)[<span class="cm-number">2</span>] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"gene_short_name"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gbm_cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">newCellDataSet</span>(<span class="cm-variable">exprs</span>(<span class="cm-variable">gbm</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">phenoData</span> <span class="cm-operator">=</span> <span class="cm-variable">new</span>(<span class="cm-string">"AnnotatedDataFrame"</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">pData</span>(<span class="cm-variable">gbm</span>)),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">featureData</span> <span class="cm-operator">=</span> <span class="cm-variable">new</span>(<span class="cm-string">"AnnotatedDataFrame"</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">fd</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lowerDetectionLimit</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">expressionFamily</span> <span class="cm-operator">=</span> <span class="cm-variable">negbinomial.size</span>())</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><ul><li><span>ğŸ”ºä¼°è®¡å°ºå¯¸å› å­å’Œåˆ†æ•£</span><font color=#FF0000><span>ï¼ˆéœ€è¦ï¼‰</span></font>
<br><span>å°ºå¯¸å› å­å¸®åŠ©æˆ‘ä»¬å¯¹è·¨ç»†èƒæ¢å¤çš„ mRNA å·®å¼‚è¿›è¡Œæ ‡å‡†åŒ–ã€‚</span>
<br><span>â€œåˆ†æ•£â€å€¼å°†å¸®åŠ©æˆ‘ä»¬ç¨åè¿›è¡Œå·®å¼‚è¡¨è¾¾åˆ†æã€‚</span>
<br><b><span>è¦æ±‚ï¼š</span></b>
<code>stimateSizeFactors()</code><span>å’Œ</span><code>estimateDispersions()</code><span>ä»…åœ¨ä½¿ç”¨å¸¦æœ‰</span><code>negbinomial()``ornegbinomial.size()</code><span>çš„ </span><code>CellDataSet</code><span> æ—¶æ‰æœ‰æ•ˆã€‚</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">estimateSizeFactors</span>(<span class="cm-variable">HSMM</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">estimateDispersions</span>(<span class="cm-variable">HSMM</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><ul><li><span>è¿‡æ»¤ä½è´¨é‡ç»†èƒï¼ˆæ¨èï¼‰</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æŸ¥çœ‹ç»†èƒä¸­ mRNA æ€»æ•°çš„åˆ†å¸ƒ</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pData</span>(<span class="cm-variable">HSMM</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">Total_mRNAs</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">Matrix</span><span class="cm-operator">::</span><span class="cm-variable">colSums</span>(<span class="cm-variable">exprs</span>(<span class="cm-variable">HSMM</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">HSMM</span>[,<span class="cm-variable">pData</span>(<span class="cm-variable">HSMM</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">Total_mRNAs</span> <span class="cm-operator">&lt;</span> <span class="cm-number">1</span><span class="cm-variable">e6</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">upper_bound</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-number">10</span><span class="cm-operator">^</span>(<span class="cm-variable">mean</span>(<span class="cm-variable">log10</span>(<span class="cm-variable">pData</span>(<span class="cm-variable">HSMM</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">Total_mRNAs</span>)) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2</span><span class="cm-operator">*</span><span class="cm-variable">sd</span>(<span class="cm-variable">log10</span>(<span class="cm-variable">pData</span>(<span class="cm-variable">HSMM</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">Total_mRNAs</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">lower_bound</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-number">10</span><span class="cm-operator">^</span>(<span class="cm-variable">mean</span>(<span class="cm-variable">log10</span>(<span class="cm-variable">pData</span>(<span class="cm-variable">HSMM</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">Total_mRNAs</span>)) <span class="cm-operator">-</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">2</span><span class="cm-operator">*</span><span class="cm-variable">sd</span>(<span class="cm-variable">log10</span>(<span class="cm-variable">pData</span>(<span class="cm-variable">HSMM</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">Total_mRNAs</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qplot</span>(<span class="cm-variable">Total_mRNAs</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">pData</span>(<span class="cm-variable">HSMM</span>), <span class="cm-variable">color</span> <span class="cm-operator">=</span> <span class="cm-variable">Hours</span>, <span class="cm-variable">geom</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"density"</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">geom_vline</span>(<span class="cm-variable">xintercept</span> <span class="cm-operator">=</span> <span class="cm-variable">lower_bound</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">geom_vline</span>(<span class="cm-variable">xintercept</span> <span class="cm-operator">=</span> <span class="cm-variable">upper_bound</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 308px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p><img src="images/2021-10-25-15-16-27.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">HSMM</span>[,<span class="cm-variable">pData</span>(<span class="cm-variable">HSMM</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">Total_mRNAs</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">lower_bound</span> <span class="cm-operator">&amp;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">pData</span>(<span class="cm-variable">HSMM</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">Total_mRNAs</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">upper_bound</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">detectGenes</span>(<span class="cm-variable">HSMM</span>, <span class="cm-variable">min_expr</span> <span class="cm-operator">=</span> <span class="cm-number">0.1</span>) <span class="cm-comment">#è®¡ç®—æ¯ä¸ªåŸºå› åœ¨å¤šå°‘ç»†èƒä¸­è¡¨è¾¾</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># éªŒè¯CellDataSet æ˜¯å¦éµå¾ªå¤§è‡´å¯¹æ•°æ­£æ€åˆ†å¸ƒ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Log-transform each value in the expression matrix.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">L</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">log</span>(<span class="cm-variable">exprs</span>(<span class="cm-variable">HSMM</span>[<span class="cm-variable">expressed_genes</span>,]))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Standardize each gene, so that they are all on the same scale,</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Then melt the data with plyr so we can plot it easily</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">melted_dens_df</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">melt</span>(<span class="cm-variable">Matrix</span><span class="cm-operator">::</span><span class="cm-variable">t</span>(<span class="cm-variable">scale</span>(<span class="cm-variable">Matrix</span><span class="cm-operator">::</span><span class="cm-variable">t</span>(<span class="cm-variable">L</span>))))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Plot the distribution of the standardized gene expression values.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qplot</span>(<span class="cm-variable">value</span>, <span class="cm-variable">geom</span> <span class="cm-operator">=</span> <span class="cm-string">"density"</span>, <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">melted_dens_df</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">stat_function</span>(<span class="cm-variable">fun</span> <span class="cm-operator">=</span> <span class="cm-variable">dnorm</span>, <span class="cm-variable">size</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>, <span class="cm-variable">color</span> <span class="cm-operator">=</span> <span class="cm-string">'red'</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">xlab</span>(<span class="cm-string">"Standardized log(FPKM)"</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ylab</span>(<span class="cm-string">"Density"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 374px;"></div><div class="CodeMirror-gutters" style="display: none; height: 374px;"></div></div></div></pre><p><img src="images/2021-10-25-15-16-45.png" referrerpolicy="no-referrer"></p><ol start='2' ><li><span>èšç±»å’Œç»†èƒç±»å‹æ³¨é‡Šï¼ˆä¸€èˆ¬æ¨èä½¿ç”¨Seuratçš„æ ‡å‡†æµç¨‹ï¼‰</span></li></ol><ul><li><b><span>Step1: é€‰æ‹©å®šä¹‰ç»†èƒè¿›ç¨‹çš„åŸºå› ï¼ˆç‰¹å¾é€‰æ‹©ï¼‰</span></b></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># é€‰æ‹©çš„åŸºå› éšç€æˆ‘ä»¬æ­£åœ¨ç ”ç©¶çš„è¿‡ç¨‹çš„è¿›å±•è€Œå¢åŠ ï¼ˆæˆ–å‡å°‘ï¼‰è¡¨è¾¾ï¼ˆå·®å¼‚è¡¨è¾¾çš„åŸºå› ï¼‰</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## åˆ†ç¦»ä¸€ç»„æ’åºåŸºå› çš„ä¸€ç§æœ‰æ•ˆæ–¹æ³•æ˜¯ç®€å•åœ°å°†è¿‡ç¨‹å¼€å§‹æ—¶æ”¶é›†çš„ç»†èƒä¸è¿‡ç¨‹ç»“æŸæ—¶æ”¶é›†çš„ç»†èƒè¿›è¡Œæ¯”è¾ƒï¼Œå¹¶æ‰¾åˆ°å·®å¼‚è¡¨è¾¾çš„åŸºå› </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">diff_test_res</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">differentialGeneTest</span>(<span class="cm-variable">HSMM_myo</span>[<span class="cm-variable">expressed_genes</span>,],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">fullModelFormulaStr</span> <span class="cm-operator">=</span> <span class="cm-string">"~Media"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ordering_genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">row.names</span> (<span class="cm-variable">subset</span>(<span class="cm-variable">diff_test_res</span>, <span class="cm-variable">qval</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0.01</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æ— æ—¶é—´åºåˆ—æ•°æ®æ—¶</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM_myo</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">setOrderingFilter</span>(<span class="cm-variable">HSMM_myo</span>, <span class="cm-variable">ordering_genes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_ordering_genes</span>(<span class="cm-variable">HSMM_myo</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><ul><li><b><span>Step2:é™ä½æ•°æ®ç»´åº¦</span></b><span> </span>
<br><span>DDRTree: å°†é«˜ç»´ç©ºé—´çš„æ•°æ®ç‚¹é™è‡³äºŒç»´ï¼Œæ–¹ä¾¿å¯è§†åŒ–</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM_myo</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">reduceDimension</span>(<span class="cm-variable">HSMM_myo</span>, <span class="cm-variable">max_components</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">method</span> <span class="cm-operator">=</span> <span class="cm-string">'DDRTree'</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>â—â—â—ï¸Monocle3ä½¿ç”¨çš„é™ç»´æ–¹æ³•ä¸ºUMAPå’ŒtSNE</span></p><ul><li><b><span>Step3: æ²¿è½¨è¿¹å¯¹ç»†èƒè¿›è¡Œæ’åº</span></b>
<br><span>è½¨è¿¹å…·æœ‰æ ‘çŠ¶ç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ—¶é—´é›¶æ”¶é›†çš„ç»†èƒä½äºæ ‘å°–ä¹‹ä¸€é™„è¿‘ï¼Œè€Œå…¶ä»–ç»†èƒåˆ†å¸ƒåœ¨ä¸¤ä¸ªâ€œæ ‘æâ€ä¹‹é—´ã€‚Monocle ä¸çŸ¥é“å…ˆéªŒåœ° å°†æ ‘çš„å“ªä¸ªè½¨è¿¹ç§°ä¸ºâ€œå¼€å§‹â€ï¼Œå› æ­¤å¯¹</span><code>orderCells</code><span>ä½¿ç”¨</span><code>root_state</code><span>å‚æ•°å†æ¬¡è°ƒç”¨ä»¥æŒ‡å®šå¼€å§‹ã€‚</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM_myo</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">orderCells</span>(<span class="cm-variable">HSMM_myo</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## â—ï¸è®¾å®šæ ¹ç»“ç‚¹ï¼Œéœ€è¦æ ¹æ®åç»­çš„å›¾æ¥è¿›ä¸€æ­¥ç¡®å®šæœ€ä½³çš„æ ¹ç»“ç‚¹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mycds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">orderCells</span>(<span class="cm-variable">mycds</span>, <span class="cm-variable">root_state</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## ç»“æœå¯è§†åŒ–</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## Hoursè½¨è¿¹åˆ†å¸ƒå›¾</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_cell_trajectory</span>(<span class="cm-variable">HSMM_myo</span>, <span class="cm-variable">color_by</span> <span class="cm-operator">=</span> <span class="cm-string">"Hours"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><img src="images/2021-10-25-15-19-54.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># åœ¨æ—¶é—´é›¶æ”¶é›†çš„ç»†èƒä½äºæ ‘å°–ä¹‹ä¸€é™„è¿‘ï¼Œè€Œå…¶ä»–ç»†èƒåˆ†å¸ƒåœ¨ä¸¤ä¸ªâ€œæ ‘æâ€ä¹‹é—´ã€‚Monocle ä¸çŸ¥é“å…ˆéªŒåœ°å°†æ ‘çš„å“ªä¸ªè½¨è¿¹ç§°ä¸ºâ€œå¼€å§‹â€ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å†æ¬¡è°ƒå‚ä»¥æŒ‡å®šå¼€å§‹ã€‚</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># é€šè¿‡â€œstateâ€ä¸ºç»†èƒç€è‰²</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_cell_trajectory</span>(<span class="cm-variable">HSMM_myo</span>, <span class="cm-variable">color_by</span> <span class="cm-operator">=</span> <span class="cm-string">"State"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><img src="images/2021-10-25-15-20-16.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># é€šè¿‡è¯†åˆ«åŒ…å«ä»æ—¶é—´é›¶å¼€å§‹çš„å¤§éƒ¨åˆ†ç»†èƒçš„çŠ¶æ€</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">GM_state</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-keyword">function</span>(<span class="cm-variable">cds</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">length</span>(<span class="cm-variable">unique</span>(<span class="cm-variable">pData</span>(<span class="cm-variable">cds</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">State</span>)) <span class="cm-operator">&gt;</span> <span class="cm-number">1</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T0_counts</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">table</span>(<span class="cm-variable">pData</span>(<span class="cm-variable">cds</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">State</span>, <span class="cm-variable">pData</span>(<span class="cm-variable">cds</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">Hours</span>)[,<span class="cm-string">"0"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-builtin">return</span>(<span class="cm-variable">as.numeric</span>(<span class="cm-variable">names</span>(<span class="cm-variable">T0_counts</span>)[<span class="cm-variable">which</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">T0_counts</span> <span class="cm-operator">==</span> <span class="cm-variable">max</span>(<span class="cm-variable">T0_counts</span>))]))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-builtin">return</span> (<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##Pseudotimeè½¨è¿¹å›¾</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM_myo</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">orderCells</span>(<span class="cm-variable">HSMM_myo</span>, <span class="cm-variable">root_state</span> <span class="cm-operator">=</span> <span class="cm-variable">GM_state</span>(<span class="cm-variable">HSMM_myo</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_cell_trajectory</span>(<span class="cm-variable">HSMM_myo</span>, <span class="cm-variable">color_by</span> <span class="cm-operator">=</span> <span class="cm-string">"Pseudotime"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><img src="images/2021-10-25-15-24-53.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># â€œåˆ†é¢â€è½¨è¿¹å›¾</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_cell_trajectory</span>(<span class="cm-variable">HSMM_myo</span>, <span class="cm-variable">color_by</span> <span class="cm-operator">=</span> <span class="cm-string">"State"</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">facet_wrap</span>(<span class="cm-operator">~</span><span class="cm-variable">State</span>, <span class="cm-variable">nrow</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><img src="images/2021-10-25-15-25-09.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æ— æ—¶é—´åºåˆ—ï¼Œéœ€å…ˆéªŒçŸ¥è¯†ï¼Œæ ¹æ®æŸäº›æ ‡è®°åŸºå› çš„è¡¨è¾¾ä½ç½®æ¥è®¾ç½®æ ¹</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">blast_genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">row.names</span>(<span class="cm-variable">subset</span>(<span class="cm-variable">fData</span>(<span class="cm-variable">HSMM_myo</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gene_short_name</span> <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">c</span>(<span class="cm-string">"CCNB2"</span>, <span class="cm-string">"MYOD1"</span>, <span class="cm-string">"MYOG"</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_genes_jitter</span>(<span class="cm-variable">HSMM_myo</span>[<span class="cm-variable">blast_genes</span>,],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">grouping</span> <span class="cm-operator">=</span> <span class="cm-string">"State"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">min_expr</span> <span class="cm-operator">=</span> <span class="cm-number">0.1</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><img src="images/2021-10-25-15-25-26.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ä¸ºäº†ç¡®è®¤æ’åºæ˜¯æ­£ç¡®çš„ï¼Œç»˜åˆ¶é€‰æ‹©çš„åŸºå› çš„è¡¨è¾¾æ°´å¹³</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM_expressed_genes</span> <span class="cm-operator cm-arrow">&lt;-</span> &nbsp;<span class="cm-variable">row.names</span>(<span class="cm-variable">subset</span>(<span class="cm-variable">fData</span>(<span class="cm-variable">HSMM_myo</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">num_cells_expressed</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">10</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HSMM_filtered</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">HSMM_myo</span>[<span class="cm-variable">HSMM_expressed_genes</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">my_genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">row.names</span>(<span class="cm-variable">subset</span>(<span class="cm-variable">fData</span>(<span class="cm-variable">HSMM_filtered</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">gene_short_name</span> <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">c</span>(<span class="cm-string">"CDK1"</span>, <span class="cm-string">"MEF2C"</span>, <span class="cm-string">"MYH3"</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds_subset</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">HSMM_filtered</span>[<span class="cm-variable">my_genes</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_genes_in_pseudotime</span>(<span class="cm-variable">cds_subset</span>, <span class="cm-variable">color_by</span> <span class="cm-operator">=</span> <span class="cm-string">"Hours"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><img src="images/2021-10-25-15-25-47.png" referrerpolicy="no-referrer"></p><p><b><span>è¡¥å……ï¼š</span></b><span>å¯ä»¥é€šè¿‡é€‰æ‹©å‘è‚²å·®å¼‚è¡¨è¾¾åŸºå› ï¼Œé€‰æ‹©clusterså·®å¼‚è¡¨è¾¾åŸºå› ï¼Œé€‰æ‹©ç¦»æ•£ç¨‹åº¦é«˜çš„åŸºå› ã€‚è‡ªå®šä¹‰å‘è‚²markeråŸºå› æ¥é€‰æ‹©åŸºå› ï¼Œå‰ä¸‰ä¸ªä¸ºæ— ç›‘ç£æ–¹æ³•ï¼Œæœ€åä¸€ä¸ªä¸ºåŠç›‘ç£åˆ†æï¼Œéœ€è¦å…ˆéªŒçŸ¥è¯†ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##ä½¿ç”¨seuraté€‰æ‹©çš„é«˜å˜åŸºå› âš ï¸</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">express_genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">VariableFeatures</span>(<span class="cm-variable">pbmc</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">setOrderingFilter</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">express_genes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_ordering_genes</span>(<span class="cm-variable">cds</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##ä½¿ç”¨clusterså·®å¼‚è¡¨è¾¾markeråŸºå› </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">deg.cluster</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindAllMarkers</span>(<span class="cm-variable">pbmc</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">express_genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">subset</span>(<span class="cm-variable">deg.cluster</span>,<span class="cm-variable">p_val_adj</span><span class="cm-operator">&lt;</span><span class="cm-number">0.05</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">gene</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">setOrderingFilter</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">express_genes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_ordering_genes</span>(<span class="cm-variable">cds</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##ä½¿ç”¨monocleé€‰æ‹©çš„é«˜å˜åŸºå› âš ï¸</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">disp_table</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">dispersionTable</span>(<span class="cm-variable">cds</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">disp.genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">subset</span>(<span class="cm-variable">disp_table</span>, <span class="cm-variable">mean_expression</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">0.1</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">dispersion_empirical</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">1</span> <span class="cm-operator">*</span> <span class="cm-variable">dispersion_fit</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">gene_id</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">setOrderingFilter</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">disp.genes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_ordering_genes</span>(<span class="cm-variable">cds</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><blockquote><p><span>Monocle3</span>
<span>å…¶ä¸­ï¼ŒMonocle3ä¸Monocle2çš„åŒºåˆ«åœ¨äºï¼š</span></p></blockquote><ul><li><span>ä»UMAPå›¾è¯†åˆ«å‘è‚²è½¨è¿¹ï¼Œå¯ä»¥ç»§æ‰¿Seuratçš„è´¨æ§ã€æ‰¹æ¬¡æ ¡æ­£å’Œé™ç»´åˆ†æç»“æœï¼Œå®ç°â€œä¸€å¼ å›¾â€å±•ç°ç»†èƒçš„èšç±»ã€é‰´å®šå’Œè½¨è¿¹åˆ†æç»“æœã€‚</span></li><li><span>è‡ªåŠ¨å¯¹UMAPå›¾åˆ†åŒºï¼ˆpartitionï¼‰ï¼Œå¯ä»¥é€‰æ‹©å¤šä¸ªèµ·ç‚¹ï¼Œè½¨è¿¹åˆ†æç®—æ³•çš„é€»è¾‘æ›´ç¬¦åˆç”Ÿç‰©å­¦ç°å®ã€‚</span></li><li><span>å°†æ‹Ÿåˆä¸€ä¸ªä¸»å›¾åœ¨æ¯ä¸ªåˆ†åŒºå†…ä½¿ç”¨learn_graph()å‡½æ•°ï¼Œä¸ºäº†å°†ç»†èƒæ’åˆ—æ•´é½ï¼Œæˆ‘ä»¬é€šè¿‡é€‰æ‹©æˆ‘ä»¬æ ‡è®°ä¸ºè½¨è¿¹â€œæ ¹â€çš„å›¾å½¢åŒºåŸŸæ¥ç¡®å®šç”Ÿç‰©è¿‡ç¨‹çš„â€œå¼€å§‹â€åœ¨å“ªé‡Œã€‚</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">monocle3</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">Seurat</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggsci</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 1. create</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># pbmc.data &lt;- Read10X(data.dir = "~/project/10x_sc/data/pbmc3k/filtered_gene_bc_matrices_h19")</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc.data</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">Read10X</span>(<span class="cm-variable">data.dir</span> <span class="cm-operator">=</span> <span class="cm-string">"~/filtered_gene_bc_matrices_h19"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">satija</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">readRDS</span>(<span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"/home/renjun/filtered_gene_bc_matrices_h19/pbmc3k_final.rds"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">expr_matrix</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">as.matrix</span>(<span class="cm-variable">pbmc.data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sample_sheet</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-variable">colnames</span>(<span class="cm-variable">pbmc.data</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">colnames</span>(<span class="cm-variable">pbmc.data</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">stringsAsFactors</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gene_annotation</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">data.frame</span>(<span class="cm-variable">row.names</span> <span class="cm-operator">=</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">pbmc.data</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">pbmc.data</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">gene_short_name</span> <span class="cm-operator">=</span> <span class="cm-variable">rownames</span>(<span class="cm-variable">pbmc.data</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stringsAsFactors</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">new_cell_data_set</span>(<span class="cm-variable">expr_matrix</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cell_metadata</span> <span class="cm-operator">=</span> <span class="cm-variable">sample_sheet</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">gene_metadata</span> <span class="cm-operator">=</span> <span class="cm-variable">gene_annotation</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># cds &lt;- load_mm_data(mat_path = "~/filtered_gene_bc_matrices_h19/matrix.mtx", </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; feature_anno_path = "~/filtered_gene_bc_matrices_h19/genes.tsv", </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cell_anno_path = "~/filtered_gene_bc_matrices_h19/barcodes.tsv")</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 2. preprocessing</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">preprocess_cds</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">num_dim</span> <span class="cm-operator">=</span> <span class="cm-number">50</span>, <span class="cm-variable">norm_method</span> <span class="cm-operator">=</span> <span class="cm-string">"log"</span>, <span class="cm-variable">scaling</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"pv_variance.png"</span>, <span class="cm-variable">plot_pc_variance_explained</span>(<span class="cm-variable">cds</span>), <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 3. reduce dimension</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">reduce_dimension</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">max_components</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>, <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"UMAP"</span>, <span class="cm-variable">preprocess_method</span> <span class="cm-operator">=</span> <span class="cm-string">"PCA"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">reduce_dimension</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">max_components</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>, <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"tSNE"</span>, <span class="cm-variable">preprocess_method</span> <span class="cm-operator">=</span> <span class="cm-string">"PCA"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># cds &lt;- align_cds(cds, alignment_group = "batch", residual_model_formula_str = "~ bg.300.loading + bg.400.loading")</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># marker &lt;- c("MS4A1", "GNLY", "CD3E", "CD14", "FCER1A", "FCGR3A", </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "LYZ", "PPBP", "CD8A","IL7R","CCR7","S100A4")</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 4. clustering</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cluster_cells</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"UMAP"</span>, <span class="cm-variable">k</span> <span class="cm-operator">=</span> <span class="cm-number">20</span>, <span class="cm-variable">cluster_method</span> <span class="cm-operator">=</span> <span class="cm-string">"leiden"</span>, <span class="cm-variable">resolution</span> <span class="cm-operator">=</span> <span class="cm-number">1e-4</span>) <span class="cm-comment">#default</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cluster_cells</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"tSNE"</span>, <span class="cm-variable">k</span> <span class="cm-operator">=</span> <span class="cm-number">20</span>, <span class="cm-variable">cluster_method</span> <span class="cm-operator">=</span> <span class="cm-string">"leiden"</span>, <span class="cm-variable">resolution</span> <span class="cm-operator">=</span> <span class="cm-number">1e-2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cluster_cells</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"PCA"</span>, <span class="cm-variable">k</span> <span class="cm-operator">=</span> <span class="cm-number">20</span>, <span class="cm-variable">cluster_method</span> <span class="cm-operator">=</span> <span class="cm-string">"louvain"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># cds@clusters@listData$PCA$clusters</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># plot cell with cluster</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">plot_cells</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"UMAP"</span>, <span class="cm-variable">color_cells_by</span> <span class="cm-operator">=</span> <span class="cm-string">"cluster"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cell_size</span> <span class="cm-operator">=</span> <span class="cm-number">2.3</span>, <span class="cm-variable">alpha</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>, <span class="cm-variable">group_label_size</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_colour_d3</span>(<span class="cm-string">"category20"</span>) <span class="cm-operator">+</span> &nbsp;<span class="cm-variable">rj.ftheme</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">plot_cells</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"tSNE"</span>, <span class="cm-variable">color_cells_by</span> <span class="cm-operator">=</span> <span class="cm-string">"cluster"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cell_size</span> <span class="cm-operator">=</span> <span class="cm-number">2.3</span>, <span class="cm-variable">alpha</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>, <span class="cm-variable">group_label_size</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_colour_d3</span>(<span class="cm-string">"category20"</span>) <span class="cm-operator">+</span> &nbsp;<span class="cm-variable">rj.ftheme</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p3</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">plot_cells</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"PCA"</span>, <span class="cm-variable">color_cells_by</span> <span class="cm-operator">=</span> <span class="cm-string">"cluster"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cell_size</span> <span class="cm-operator">=</span> <span class="cm-number">2.3</span>, <span class="cm-variable">alpha</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>, <span class="cm-variable">group_label_size</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_colour_d3</span>(<span class="cm-string">"category20"</span>) <span class="cm-operator">+</span> &nbsp;<span class="cm-variable">rj.ftheme</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"2d_cluster.png"</span>, <span class="cm-variable">CombinePlots</span>(<span class="cm-builtin">list</span>(<span class="cm-variable">p1</span>,<span class="cm-variable">p2</span>,<span class="cm-variable">p3</span>), <span class="cm-variable">ncol</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>), <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">12</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">4</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># plot cell with partition</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p1</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">plot_cells</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"UMAP"</span>, <span class="cm-variable">color_cells_by</span> <span class="cm-operator">=</span> <span class="cm-string">"partition"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cell_size</span> <span class="cm-operator">=</span> <span class="cm-number">2.3</span>, <span class="cm-variable">alpha</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>, <span class="cm-variable">group_label_size</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_colour_d3</span>(<span class="cm-string">"category20"</span>) <span class="cm-operator">+</span> &nbsp;<span class="cm-variable">rj.ftheme</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p2</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">plot_cells</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"tSNE"</span>, <span class="cm-variable">color_cells_by</span> <span class="cm-operator">=</span> <span class="cm-string">"partition"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cell_size</span> <span class="cm-operator">=</span> <span class="cm-number">2.3</span>, <span class="cm-variable">alpha</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>, <span class="cm-variable">group_label_size</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_colour_d3</span>(<span class="cm-string">"category20"</span>) <span class="cm-operator">+</span> &nbsp;<span class="cm-variable">rj.ftheme</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p3</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">plot_cells</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"PCA"</span>, <span class="cm-variable">color_cells_by</span> <span class="cm-operator">=</span> <span class="cm-string">"partition"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cell_size</span> <span class="cm-operator">=</span> <span class="cm-number">2.3</span>, <span class="cm-variable">alpha</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>, <span class="cm-variable">group_label_size</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>) <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">scale_colour_d3</span>(<span class="cm-string">"category20"</span>) <span class="cm-operator">+</span> &nbsp;<span class="cm-variable">rj.ftheme</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"2d_partition.png"</span>, <span class="cm-variable">CombinePlots</span>(<span class="cm-builtin">list</span>(<span class="cm-variable">p1</span>,<span class="cm-variable">p2</span>,<span class="cm-variable">p3</span>), <span class="cm-variable">ncol</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>), <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">12</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">4</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 5. find marker</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">marker_test_res</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">top_markers</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">group_cells_by</span> <span class="cm-operator">=</span> <span class="cm-string">"cluster"</span>, <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"UMAP"</span>, <span class="cm-variable">reference_cells</span> <span class="cm-operator">=</span> <span class="cm-number">1000</span>, <span class="cm-variable">cores</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">top_specific_markers</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">marker_test_res</span> <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">filter</span>(<span class="cm-variable">fraction_expressing</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">0.10</span>) <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">group_by</span>(<span class="cm-variable">cell_group</span>) <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">top_n</span>(<span class="cm-number">10</span>, <span class="cm-variable">pseudo_R2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">top_specific_marker_ids</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">unique</span>(<span class="cm-variable">top_specific_markers</span> <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">pull</span>(<span class="cm-variable">gene_id</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">plot_genes_by_group</span>(<span class="cm-variable">cds</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">top_specific_marker_ids</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">group_cells_by</span> <span class="cm-operator">=</span> <span class="cm-string">"cluster"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"UMAP"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">ordering_type</span> <span class="cm-operator">=</span> <span class="cm-string">"maximal_on_diag"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">max.size</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"top_gene10_heatmap.png"</span>, <span class="cm-variable">p</span>, <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">6</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">8</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 6. choose cells for a subset</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds_subset</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">choose_cells</span>(<span class="cm-variable">cds</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 7. learn the trajectory</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">learn_graph</span>(<span class="cm-variable">cds</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Passing the programatically selected root node to order_cells() via the root_pr_nodeargument yields:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">order_cells</span>(<span class="cm-variable">cds</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">plot_cells</span>(<span class="cm-variable">cds</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">color_cells_by</span> <span class="cm-operator">=</span> <span class="cm-string">"pseudotime"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">reduction_method</span> <span class="cm-operator">=</span> <span class="cm-string">"UMAP"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">label_groups_by_cluster</span><span class="cm-operator">=</span><span class="cm-variable">FALSE</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">label_leaves</span><span class="cm-operator">=</span><span class="cm-variable">TRUE</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">label_branch_points</span><span class="cm-operator">=</span><span class="cm-variable">FALSE</span>) <span class="cm-operator">+</span> <span class="cm-variable">rj.ftheme</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggsave</span>(<span class="cm-string">"pseudotime2.png"</span>, <span class="cm-variable">p</span>, <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">6</span>, <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">6</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">save</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"cds.rda"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 2882px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2882px;"></div></div></div></pre><h3 id='åŸºå› æ°´å¹³'><span>åŸºå› æ°´å¹³</span></h3><h4 id='åŸºå› çš„å·®å¼‚è¡¨è¾¾åˆ†æ'><span>åŸºå› çš„å·®å¼‚è¡¨è¾¾åˆ†æ</span></h4><p><span>[â—ï¸â—ï¸â—ï¸è¯¥æ­¥éª¤ä¸€èˆ¬åœ¨èšç±»åˆ†æä¹‹åï¼Œç»†èƒç±»å‹æ³¨é‡Šä¹‹å‰è¿›è¡Œ]</span></p><h5 id='å¯»æ‰¾å·®å¼‚è¡¨è¾¾çš„ç‰¹å¾åŸºå› ç°‡ç”Ÿç‰©æ ‡å¿—ç‰©ï¼‰'><span>å¯»æ‰¾å·®å¼‚è¡¨è¾¾çš„ç‰¹å¾åŸºå› ï¼ˆç°‡ç”Ÿç‰©æ ‡å¿—ç‰©ï¼‰</span></h5><blockquote><p><span>SeuratåŒ…</span></p></blockquote><ol start='' ><li><span>è¿è¡Œéçº¿æ€§é™ç»´â—ï¸â—ï¸â—ï¸</span></li></ol><p><span>Seuratæä¾›å‡ ä¸ªéçº¿æ€§é™ç»´æ–¹æ³•ï¼Œå¦‚tSNEå’ŒUMAPï¼Œæ¥å¯è§†åŒ–å’Œæ¢ç´¢è¿™äº›æ•°æ®é›†ã€‚è¿™äº›ç®—æ³•çš„ç›®æ ‡æ˜¯å­¦ä¹ æ•°æ®çš„åº•å±‚æµå½¢ï¼Œä»¥ä¾¿å°†ç›¸ä¼¼çš„ç»†èƒæ”¾åœ¨ä½ç»´ç©ºé—´ä¸­ã€‚ä¸Šé¢ç¡®å®šçš„åŸºäºå›¾å½¢çš„ç°‡ä¸­çš„ç»†èƒåº”è¯¥å…±åŒå®šä½åœ¨è¿™äº›é™ç»´å›¾ä¸­ã€‚ä½œä¸º UMAP å’Œ tSNE çš„è¾“å…¥ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ç›¸åŒçš„ PC ä½œä¸ºèšç±»åˆ†æçš„è¾“å…¥ã€‚ç”±äºt-SNEæ‰€ä½¿ç”¨çš„æ—¶é—´è¾ƒé•¿ï¼Œä¸€èˆ¬ä½¿ç”¨UMAPã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># If you haven't installed UMAP, you can do so via reticulate::py_install(packages =</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 'umap-learn')</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">RunUMAP</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">dims</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># note that you can set `label = TRUE` or use the LabelClusters function to help label</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># individual clusters</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DimPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">reduction</span> <span class="cm-operator">=</span> <span class="cm-string">"umap"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># save the data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">saveRDS</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"../output/pbmc_tutorial.rds"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><img src="images/2021-10-25-15-40-12.png" referrerpolicy="no-referrer">
<br></p><ol start='2' ><li><span>markeråŸºå› çš„è¯†åˆ«</span>
<br><span>æ‰¾åˆ°é€šè¿‡å·®å¼‚è¡¨è¾¾å®šä¹‰èšç±»çš„æ ‡è®°åŸºå› ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ</span><code>ident.1</code><span>ä¸æ‰€æœ‰å…¶ä»–ç»†èƒç›¸æ¯”ï¼Œå®ƒè¯†åˆ«å•ä¸ªç°‡ï¼ˆåœ¨</span><code>ident.1</code><span>ä¸­æŒ‡å®šï¼‰çš„é˜³æ€§å’Œé˜´æ€§æ ‡è®°ã€‚</span><code>FindAllMarkers()</code><span>ä¸ºæ‰€æœ‰ç°‡è‡ªåŠ¨æ‰§è¡Œæ­¤è¿‡ç¨‹ï¼Œä½†ä¹Ÿå¯ä»¥æµ‹è¯•ç°‡ä¸ç°‡ä¹‹é—´çš„å¯¹æ¯”ï¼Œæˆ–é’ˆå¯¹æ‰€æœ‰ç»†èƒè¿›è¡Œæµ‹è¯•ã€‚</span>
<br><span>è¯¥</span><code>min.pct</code><span>å‚æ•°è¦æ±‚åœ¨ä¸¤ç»„ç»†èƒä¸­çš„ä»»ä½•ä¸€ç»„ä¸­ä»¥æœ€å°ç™¾åˆ†æ¯”æ£€æµ‹åˆ°ä¸€ä¸ªåŸºå› ï¼Œè€Œ </span><code>thresh.test</code><span>å‚æ•°è¦æ±‚ä¸€ä¸ªåŸºå› åœ¨ä¸¤ç»„ä¹‹é—´å·®å¼‚è¡¨è¾¾ï¼ˆå¹³å‡ï¼‰ä¸€å®šé‡ã€‚å¯ä»¥å°†è¿™ä¸¤ä¸ªéƒ½è®¾ç½®ä¸º 0ï¼Œä½†æ—¶é—´ä¼šæ˜¾ç€å¢åŠ ï¼Œå› ä¸ºè¿™å°†æµ‹è¯•å¤§é‡ä¸å¤ªå¯èƒ½å…·æœ‰é«˜åº¦æ­§è§†æ€§çš„åŸºå› ã€‚ä½œä¸ºåŠ é€Ÿè¿™äº›è®¡ç®—çš„å¦ä¸€ä¸ªé€‰é¡¹ï¼Œ</span><code>max.cells.per.ident</code><span>å¯ä»¥è®¾ç½®ã€‚</span>
<br><span>Seurat æœ‰å‡ ç§å·®å¼‚è¡¨è¾¾æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨ test.use å‚æ•°è¿›è¡Œè®¾ç½®ï¼Œæ¥ç€å¯è§†åŒ–ã€‚</span>
<br><span>ç›®å‰æ”¯æŒä»¥ä¸‹å·®å¼‚è¡¨è¾¾æµ‹è¯•ï¼š</span></li></ol><table>
   <tbody><tr>
      <td>â€œwilcoxâ€ï¼šWilcoxon ç§©å’Œæ£€éªŒï¼ˆé»˜è®¤ï¼‰</td>
   </tr>
   <tr>
      <td>â€œbimodâ€ï¼šå•ç»†èƒç‰¹å¾è¡¨è¾¾çš„ä¼¼ç„¶æ¯”æ£€éªŒã€é»˜è®¤ã€‘</td>
   </tr>
   <tr>
      <td>â€œrocâ€ï¼šæ ‡å‡† AUC åˆ†ç±»å™¨</td>
   </tr>
   <tr>
      <td>â€œtâ€ï¼šå­¦ç”Ÿçš„ t æ£€éªŒ</td>
   </tr>
   <tr>
      <td>â€œæ³Šæ¾â€ï¼šå‡è®¾æ½œåœ¨è´ŸäºŒé¡¹å¼åˆ†å¸ƒçš„ä¼¼ç„¶æ¯”æ£€éªŒã€‚ä»…ç”¨äºåŸºäº UMI çš„æ•°æ®é›†</td>
   </tr>
   <tr>
      <td>â€œnegbinomâ€ï¼šå‡è®¾æ½œåœ¨è´ŸäºŒé¡¹å¼åˆ†å¸ƒçš„ä¼¼ç„¶æ¯”æ£€éªŒã€‚ä»…ç”¨äºåŸºäº UMI çš„æ•°æ®é›†</td>
   </tr>
   <tr>
      <td>â€œLRâ€ï¼šä½¿ç”¨é€»è¾‘å›å½’æ¡†æ¶æ¥ç¡®å®šå·®å¼‚è¡¨è¾¾çš„åŸºå› ã€‚æ„å»ºé€»è¾‘å›å½’æ¨¡å‹ï¼Œåˆ†åˆ«åŸºäºæ¯ä¸ªç‰¹å¾é¢„æµ‹ç»„æˆå‘˜èº«ä»½ï¼Œå¹¶å°†å…¶ä¸å…·æœ‰ä¼¼ç„¶æ¯”æ£€éªŒçš„ç©ºæ¨¡å‹è¿›è¡Œæ¯”è¾ƒã€‚</td>
   </tr>
   <tr>
      <td>â€œMASTâ€ï¼šå°†ç»†èƒæ£€æµ‹ç‡è§†ä¸ºåå˜é‡çš„ GLM æ¡†æ¶</td>
   </tr>
   <tr>
      <td>â€œDESeq2â€ï¼šDE åŸºäºä½¿ç”¨è´ŸäºŒé¡¹åˆ†å¸ƒçš„æ¨¡å‹</td>
   </tr>
   <tr>
      <td></td>
   </tr>
</tbody></table><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># find all markers of cluster 2</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cluster2.markers</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindMarkers</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">ident.1</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>, <span class="cm-variable">min.pct</span> <span class="cm-operator">=</span> <span class="cm-number">0.25</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">head</span>(<span class="cm-variable">cluster2.markers</span>, <span class="cm-variable">n</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># find all markers distinguishing cluster 5 from clusters 0 and 3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cluster5.markers</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindMarkers</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">ident.1</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>, <span class="cm-variable">ident.2</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-number">0</span>, <span class="cm-number">3</span>), <span class="cm-variable">min.pct</span> <span class="cm-operator">=</span> <span class="cm-number">0.25</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">head</span>(<span class="cm-variable">cluster5.markers</span>, <span class="cm-variable">n</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># find markers for every cluster compared to all remaining cells, report only the positive ones</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc.markers</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">FindAllMarkers</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">only.pos</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>, <span class="cm-variable">min.pct</span> <span class="cm-operator">=</span> <span class="cm-number">0.25</span>, <span class="cm-variable">logfc.threshold</span> <span class="cm-operator">=</span> <span class="cm-number">0.25</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc.markers</span> <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">group_by</span>(<span class="cm-variable">cluster</span>) <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">slice_max</span>(<span class="cm-variable">n</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>, <span class="cm-variable">order_by</span> <span class="cm-operator">=</span> <span class="cm-variable">avg_log2FC</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">VlnPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"MS4A1"</span>, <span class="cm-string">"CD79A"</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 308px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p><img src="images/2021-10-25-15-46-35.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># you can plot raw counts as well</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">VlnPlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"NKG7"</span>, <span class="cm-string">"PF4"</span>), <span class="cm-variable">slot</span> <span class="cm-operator">=</span> <span class="cm-string">"counts"</span>, <span class="cm-variable">log</span> <span class="cm-operator">=</span> <span class="cm-variable">TRUE</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><img src="images/2021-10-25-15-47-12.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FeaturePlot</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-string">"MS4A1"</span>, <span class="cm-string">"GNLY"</span>, <span class="cm-string">"CD3E"</span>, <span class="cm-string">"CD14"</span>, <span class="cm-string">"FCER1A"</span>, <span class="cm-string">"FCGR3A"</span>, <span class="cm-string">"LYZ"</span>, <span class="cm-string">"PPBP"</span>,<span class="cm-string">"CD8A"</span>))</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><img src="images/2021-10-25-15-47-32.png" referrerpolicy="no-referrer"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># DoHeatmap()ä¸ºç»™å®šçš„ç»†èƒå’Œç‰¹å¾ç”Ÿæˆä¸€ä¸ªè¡¨è¾¾çƒ­å›¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªç°‡ç»˜åˆ¶å‰ 20 ä¸ªæ ‡è®°ï¼ˆæˆ–æ‰€æœ‰æ ‡è®°ï¼Œå¦‚æœå°äº 20ï¼‰ã€‚</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pbmc.markers</span> <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">group_by</span>(<span class="cm-variable">cluster</span>) <span class="cm-operator cm-variable-2">%&gt;%</span><span class="cm-variable">top_n</span>(<span class="cm-variable">n</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>, <span class="cm-variable">wt</span> <span class="cm-operator">=</span> <span class="cm-variable">avg_log2FC</span>) <span class="cm-operator cm-arrow">-&gt;</span> <span class="cm-variable">top10</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DoHeatmap</span>(<span class="cm-variable">pbmc</span>, <span class="cm-variable">features</span> <span class="cm-operator">=</span> <span class="cm-variable">top10</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">gene</span>) <span class="cm-operator">+</span> <span class="cm-variable">NoLegend</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><img src="images/2021-10-25-15-47-46.png" referrerpolicy="no-referrer"></p><h5 id='ä¸ä¼ªæ—¶é—´åˆ†æç›¸å…³çš„å·®å¼‚è¡¨è¾¾åˆ†æ'><span>ä¸ä¼ªæ—¶é—´åˆ†æç›¸å…³çš„å·®å¼‚è¡¨è¾¾åˆ†æ </span></h5><blockquote><p><span>Monocle2åŒ…</span></p></blockquote><ol start='' ><li><span>å¯»æ‰¾éšä¼ªæ—¶é—´å˜åŒ–çš„åŸºå› </span></li></ol><p><span>Monocle çš„ä¸»è¦å·¥ä½œæ˜¯åœ¨ä¸çŸ¥é“æå‰æŸ¥çœ‹å“ªäº›åŸºå› çš„æƒ…å†µä¸‹ï¼Œå°†ç»†èƒæŒ‰ç”Ÿç‰©è¿‡ç¨‹ï¼ˆä¾‹å¦‚ç»†èƒåˆ†åŒ–ï¼‰çš„è¿›å±•é¡ºåºæ’åˆ—ã€‚å¯ä»¥åˆ†æç»†èƒä»¥æ‰¾åˆ°éšç€ç»†èƒè¿›å±•è€Œå‘ç”Ÿå˜åŒ–çš„åŸºå› ã€‚</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">to_be_tested</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">row.names</span>(<span class="cm-variable">subset</span>(<span class="cm-variable">fData</span>(<span class="cm-variable">HSMM</span>),</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gene_short_name</span> <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">c</span>(<span class="cm-string">"MYH3"</span>, <span class="cm-string">"MEF2C"</span>, <span class="cm-string">"CCNB2"</span>, <span class="cm-string">"TNNT1"</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cds_subset</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">HSMM_myo</span>[<span class="cm-variable">to_be_tested</span>,]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Monocle ä½¿ç”¨VGAMåŒ…å°†åŸºå› çš„è¡¨è¾¾æ°´å¹³å»ºæ¨¡ä¸ºä¼ªæ—¶é—´çš„å¹³æ»‘éçº¿æ€§å‡½æ•°</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">diff_test_res</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">differentialGeneTest</span>(<span class="cm-variable">cds_subset</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fullModelFormulaStr</span> <span class="cm-operator">=</span> <span class="cm-string">"~sm.ns(Pseudotime)"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">diff_test_res</span>[,<span class="cm-variable">c</span>(<span class="cm-string">"gene_short_name"</span>, <span class="cm-string">"pval"</span>, <span class="cm-string">"qval"</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_genes_in_pseudotime</span>(<span class="cm-variable">cds_subset</span>, <span class="cm-variable">color_by</span> <span class="cm-operator">=</span> <span class="cm-string">"Hours"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><img src="images/2021-10-25-16-05-17.png" referrerpolicy="no-referrer"></p><ol start='2' ><li><span>åˆ†æå•ç»†èƒè½¨è¿¹ä¸­çš„åˆ†æ”¯</span>
<br><span>åˆ†æå•ç»†èƒè½¨è¿¹ä¸­çš„åˆ†æ”¯</span>
<span>e.g. è€ƒè™‘ä¸€ä¸‹ Steve Quake å®éªŒå®¤ç”± Barbara Treutlein å’ŒåŒäº‹è¿›è¡Œçš„å®éªŒï¼Œä»–ä»¬ä»å‘è‚²ä¸­çš„å°é¼ è‚ºä¸­æ•è·äº†ç»†èƒã€‚ä»–ä»¬åœ¨å‘è‚²æ—©æœŸæ•è·äº†ç»†èƒï¼Œåæ¥å½“è‚ºåŒ…å«ä¸¤ç§ä¸»è¦ç±»å‹çš„ä¸Šçš®ç»†èƒï¼ˆAT1 å’Œ AT2ï¼‰ï¼Œä»¥åŠå³å°†å†³å®šæˆä¸º AT1 æˆ– AT2 çš„ç»†èƒæ—¶ã€‚Monocle å¯ä»¥å°†æ­¤è¿‡ç¨‹é‡å»ºä¸ºåˆ†æ”¯è½¨è¿¹ï¼Œè®©æ‚¨å¯ä»¥éå¸¸è¯¦ç»†åœ°åˆ†æå†³ç­–ç‚¹ã€‚ä¸‹å›¾æ˜¾ç¤ºäº† Monocle ä½¿ç”¨ä»–ä»¬çš„ä¸€äº›æ•°æ®é‡å»ºçš„è½¨è¿¹ã€‚æœ‰ä¸€ä¸ªåˆ†æ”¯ï¼Œæ ‡è®°ä¸ºâ€œ1â€ã€‚å½“ç»†èƒä»æ ‘çš„å·¦ä¸Šè§’çš„æ—©æœŸå‘è‚²é˜¶æ®µé€šè¿‡æ ‘ææ—¶ï¼Œå“ªäº›åŸºå› ä¼šå‘ç”Ÿå˜åŒ–ï¼Ÿå“ªäº›åŸºå› åœ¨åˆ†æ”¯ä¹‹é—´å·®å¼‚è¡¨è¾¾ï¼Ÿä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼ŒMonocle ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„ç»Ÿè®¡æµ‹è¯•ï¼šåˆ†æ”¯è¡¨è¾¾å¼åˆ†æå»ºæ¨¡ï¼Œæˆ–BEAMã€‚</span>
<br></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">lung</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">load_lung</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_cell_trajectory</span>(<span class="cm-variable">lung</span>, <span class="cm-variable">color_by</span> <span class="cm-operator">=</span> <span class="cm-string">"Time"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><br><p><img src="images/init_treutlein-1.png" referrerpolicy="no-referrer"></p><p><br>
<span>å•ç»†èƒè½¨è¿¹åŒ…æ‹¬åˆ†æ”¯ã€‚åˆ†æ”¯çš„å‡ºç°æ˜¯å› ä¸ºç»†èƒæ‰§è¡Œæ›¿ä»£åŸºå› è¡¨è¾¾ç¨‹åºã€‚åˆ†æ”¯å‡ºç°åœ¨å‘è‚²è¿‡ç¨‹ä¸­çš„è½¨è¿¹ä¸­ï¼Œå½“ç»†èƒåšå‡ºå‘½è¿é€‰æ‹©æ—¶ï¼šä¸€ä¸ªå‘è‚²è°±ç³»æ²¿ç€ä¸€æ¡è·¯å¾„å‰è¿›ï¼Œè€Œå¦ä¸€ä¸ªè°±ç³»äº§ç”Ÿç¬¬äºŒæ¡è·¯å¾„ã€‚Monocleé‡‡ç”¨åˆ†æ”¯è¡¨è¾¾å¼åˆ†æå»ºæ¨¡ï¼Œä¸»è¦æ˜¯BEAM(Branched expression analysis modeling)å‡½æ•°ï¼Œå¯ä»¥å°†åˆ†å‰è¿‡ç¨‹é‡æ„ä¸ºä¸€ä¸ªåˆ†æ”¯è½¨è¿¹ï¼Œæ¯”è¾ƒåˆ†æç‚¹ä¸åˆ†ææœ«ç«¯çš„å·®å¼‚ï¼Œä»è€Œåˆ†æä¸åŒç»†èƒå‘½è¿ä¸‹çš„å·®å¼‚ã€‚</span><mark><span>Monocleå¯ä»¥æ¨¡æ‹Ÿå‡ºæ¯ä¸ªç»†èƒæ‰€å¤„çš„åˆ†åŒ–æ—¶é—´ï¼Œå¹¶å¯»æ‰¾éšç€åˆ†åŒ–æ—¶é—´é€æ¸å‡é«˜æˆ–é™ä½çš„åŸºå› è¡¨è¾¾çƒ­å›¾å’Œåˆ†å¸ƒå›¾ã€‚</span></mark></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># BEAMå°†å·²æ’åºçš„CellDataSetorderCellså’Œè½¨è¿¹ä¸­åˆ†æ”¯ç‚¹çš„åç§°ä½œä¸ºè¾“å…¥ã€‚å®ƒè¿”å›æ¯ä¸ªåŸºå› çš„æ˜¾ç€æ€§åˆ†æ•°è¡¨ã€‚å¾—åˆ†æ˜¾ç€çš„åŸºå› åœ¨å…¶è¡¨è¾¾ä¸­è¢«è®¤ä¸ºæ˜¯åˆ†æ”¯ä¾èµ–æ€§çš„ã€‚</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">BEAM_res</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">BEAM</span>(<span class="cm-variable">lung</span>, <span class="cm-variable">branch_point</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>, <span class="cm-variable">cores</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">BEAM_res</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">BEAM_res</span>[<span class="cm-variable">order</span>(<span class="cm-variable">BEAM_res</span><span class="cm-operator cm-dollar">$</span><span class="cm-variable">qval</span>),]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">BEAM_res</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">BEAM_res</span>[,<span class="cm-variable">c</span>(<span class="cm-string">"gene_short_name"</span>, <span class="cm-string">"pval"</span>, <span class="cm-string">"qval"</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å¯ä»¥ä½¿ç”¨ç‰¹æ®Šç±»å‹çš„çƒ­å›¾å¯è§†åŒ–æ‰€æœ‰æ˜¾ç€ä¾èµ–äºåˆ†æ”¯çš„åŸºå› çš„å˜åŒ–ã€‚æ­¤çƒ­å›¾åŒæ—¶æ˜¾ç¤ºäº†ä¸¤ä¸ªè°±ç³»çš„å˜åŒ–ã€‚å®ƒè¿˜è¦æ±‚é€‰æ‹©è¦æ£€æŸ¥çš„åˆ†æ”¯ç‚¹ã€‚åˆ—æ˜¯ä¼ªæ—¶é—´ä¸­çš„ç‚¹ï¼Œè¡Œæ˜¯åŸºå› ï¼Œä¼ªæ—¶é—´çš„å¼€å§‹ä½äºçƒ­å›¾çš„ä¸­é—´ã€‚branch_point=1ï¼Œåˆ†æ”¯ç‚¹é€‰ä¸º1ï¼Œåˆ†æbranch_point = 1è¿™ä¸ªåˆ†æ”¯å¤„çš„ç»†èƒå‘½ååˆ†å‰æ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚num_clusters=4ï¼Œå°†åŸºå› æ ¹æ®è¡¨è¾¾ç›¸ä¼¼æ€§åˆ†æˆ4ä¸ªæ¨¡å—ã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_genes_branched_heatmap</span>(<span class="cm-variable">lung</span>[<span class="cm-variable">row.names</span>(<span class="cm-variable">subset</span>(<span class="cm-variable">BEAM_res</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qval</span> <span class="cm-operator">&lt;</span> <span class="cm-number">1e-4</span>)),],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">branch_point</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">num_clusters</span> <span class="cm-operator">=</span> <span class="cm-number">4</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cores</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">use_gene_short_name</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">show_rownames</span> <span class="cm-operator">=</span> <span class="cm-variable">T</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># å¯è§†åŒ–æ‰€æƒ³è¦ç ”ç©¶çš„åŸºå› </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">lung_genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">row.names</span>(<span class="cm-variable">subset</span>(<span class="cm-variable">fData</span>(<span class="cm-variable">lung</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">gene_short_name</span> <span class="cm-operator cm-variable-2">%in%</span> <span class="cm-variable">c</span>(<span class="cm-string">"Ccnd2"</span>, <span class="cm-string">"Sftpb"</span>, <span class="cm-string">"Pdpn"</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_genes_branched_pseudotime</span>(<span class="cm-variable">lung</span>[<span class="cm-variable">lung_genes</span>,],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">branch_point</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">color_by</span> <span class="cm-operator">=</span> <span class="cm-string">"Time"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">ncol</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 528px;"></div><div class="CodeMirror-gutters" style="display: none; height: 528px;"></div></div></div></pre><blockquote><p><span>Monocle3åŒ…</span></p></blockquote><ol start='' ><li><b><span>å›å½’åˆ†æï¼š</span>
<br></b><span>ä½¿ç”¨</span><code>fit_models()</code><span>ï¼Œå¯ä»¥è¯„ä¼°æ¯ä¸ªåŸºå› æ˜¯å¦ä¾èµ–äºæ—¶é—´ã€æ²»ç–—ç­‰å˜é‡ã€‚</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># é€‚ç”¨äºç ”ç©¶çš„ç”Ÿç‰©è¿‡ç¨‹ä¸­å‘ç°åŠ¨æ€è°ƒèŠ‚çš„åŸºå› </span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gene_fits</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fit_models</span>(<span class="cm-variable">cds_subset</span>, <span class="cm-variable">model_formula_str</span> <span class="cm-operator">=</span> <span class="cm-string">"~embryo.time"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fit_coefs</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">coefficient_table</span>(<span class="cm-variable">gene_fits</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æ‰¾å‡ºå…·æœ‰é‡è¦æ—¶é—´åˆ†é‡çš„åŸºå› </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">emb_time_terms</span> <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">filter</span> (<span class="cm-variable">q_value</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0.05</span>) <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">select</span>(<span class="cm-variable">gene_short_name</span>, <span class="cm-variable">term</span>, <span class="cm-variable">q_value</span>, <span class="cm-variable">estimate</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å¯è§†åŒ–ä¸Šè¿°æµ‹è¯•æ‰€æ­ç¤ºçš„å·®å¼‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_genes_violin</span>(<span class="cm-variable">cds_subset</span>, <span class="cm-variable">group_cells_by</span><span class="cm-operator">=</span><span class="cm-string">"embryo.time.bin"</span>, <span class="cm-variable">ncol</span><span class="cm-operator">=</span><span class="cm-number">2</span>) <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">theme</span>(<span class="cm-variable">axis.text.x</span><span class="cm-operator">=</span><span class="cm-variable">element_text</span>(<span class="cm-variable">angle</span><span class="cm-operator">=</span><span class="cm-number">45</span>, <span class="cm-variable">hjust</span><span class="cm-operator">=</span><span class="cm-number">1</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># æ§åˆ¶æ‰¹æ¬¡æ•ˆåº”å’Œå…¶ä»–å› ç´ </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gene_fits</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fit_models</span>(<span class="cm-variable">cds_subset</span>, <span class="cm-variable">model_formula_str</span> <span class="cm-operator">=</span> <span class="cm-string">"~embryo.time + batch"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fit_coefs</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">coefficient_table</span>(<span class="cm-variable">gene_fits</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fit_coefs</span> <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">filter</span>(<span class="cm-variable">term</span> <span class="cm-operator">!=</span> <span class="cm-string">"(Intercept)"</span>) <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">select</span>(<span class="cm-variable">gene_short_name</span>, <span class="cm-variable">term</span>, <span class="cm-variable">q_value</span>, <span class="cm-variable">estimate</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># è¯„ä¼°åŸºå› è¡¨è¾¾æ¨¡å‹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">evaluate_fits</span>(<span class="cm-variable">gene_fits</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># å®Œæ•´æ¨¡å‹ï¼šçŸ¥é“æ¯ä¸ªç»†èƒè¢«æ”¶é›†çš„æ—¶é—´å’Œæ¥è‡ªå“ªä¸€æ‰¹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">time_batch_models</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fit_models</span>(<span class="cm-variable">cds_subset</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">model_formula_str</span> <span class="cm-operator">=</span> <span class="cm-string">"~embryo.time + batch"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">expression_family</span><span class="cm-operator">=</span><span class="cm-string">"negbinomial"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ç¼©å‡æ¨¡å‹ï¼šåªçŸ¥é“æ¯ä¸ªç»†èƒè¢«æ”¶é›†çš„æ—¶é—´</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">time_models</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">fit_models</span>(<span class="cm-variable">cds_subset</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">model_formula_str</span> <span class="cm-operator">=</span> <span class="cm-string">"~embryo.time"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">expression_family</span><span class="cm-operator">=</span><span class="cm-string">"negbinomial"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">compare_models</span>(<span class="cm-variable">time_batch_models</span>, <span class="cm-variable">time_models</span>) <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">select</span>(<span class="cm-variable">gene_short_name</span>, <span class="cm-variable">q_value</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 550px;"></div><div class="CodeMirror-gutters" style="display: none; height: 550px;"></div></div></div></pre><p><span>Monocleçš„fit_models()æ”¯æŒè´ŸäºŒé¡¹åˆ†å¸ƒå’Œä¸‹è¡¨ä¸­åˆ—å‡ºçš„å…¶ä»–å‡ ä¸ªåˆ†å¸ƒã€‚</span></p><table>
   <tbody><tr>
      <td>quasipoisson</td>
      <td>å‡†æ³Šæ¾</td>
      <td>é»˜è®¤ä¸ºfit_models()</td>
   </tr>
   <tr>
      <td>negbinomial</td>
      <td>è´ŸäºŒé¡¹å¼</td>
      <td>æ¨èç”¨äºæ•°æ®é›†è¾ƒå°ï¼ˆå°‘äº 1,000 ä¸ªç»†èƒï¼‰</td>
   </tr>
   <tr>
      <td>poisson</td>
      <td>æ³Šæ¾</td>
      <td>ä¸å»ºè®®ã€‚ä»…ç”¨äºè°ƒè¯•å’Œæµ‹è¯•ã€‚</td>
   </tr>
   <tr>
      <td>binomial</td>
      <td>äºŒé¡¹å¼</td>
      <td>æ¨èç”¨äºå•ç»†èƒ ATAC-seq</td>
   </tr>
</tbody></table><ol start='2' ><li><b><span>å›¾è‡ªç›¸å…³åˆ†æï¼š</span><b>
<br><span>ä½¿ç”¨</span><code>graph_test()</code><span>ï¼Œå¯ä»¥æ‰¾åˆ°åœ¨è½¨è¿¹ä¸Šæˆ–ç°‡ä¹‹é—´å˜åŒ–çš„åŸºå› ã€‚</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="r" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##å¯»æ‰¾æ‹Ÿæ—¶è½¨è¿¹å·®å¼‚åŸºå› </span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#graph_teståˆ†ææœ€é‡è¦çš„ç»“æœæ˜¯è«å…°æŒ‡æ•°ï¼ˆmorans_Iï¼‰ï¼Œå…¶å€¼åœ¨-1è‡³1ä¹‹é—´ï¼Œ0ä»£è¡¨æ­¤åŸºå› æ²¡æœ‰</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#ç©ºé—´å…±è¡¨è¾¾æ•ˆåº”ï¼Œ1ä»£è¡¨æ­¤åŸºå› åœ¨ç©ºé—´è·ç¦»ç›¸è¿‘çš„ç»†èƒä¸­è¡¨è¾¾å€¼é«˜åº¦ç›¸ä¼¼ã€‚</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Track_genes</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">graph_test</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">neighbor_graph</span><span class="cm-operator">=</span><span class="cm-string">"principal_graph"</span>, <span class="cm-variable">cores</span><span class="cm-operator">=</span><span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#æŒ‘é€‰top10ç”»å›¾å±•ç¤º</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Track_genes_sig</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">Track_genes</span> <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">top_n</span>(<span class="cm-variable">n</span><span class="cm-operator">=</span><span class="cm-number">10</span>, <span class="cm-variable">morans_I</span>) <span class="cm-operator cm-variable-2">%&gt;%</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pull</span>(<span class="cm-variable">gene_short_name</span>) <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">as.character</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#åŸºå› è¡¨è¾¾è¶‹åŠ¿å›¾</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_genes_in_pseudotime</span>(<span class="cm-variable">cds</span>[<span class="cm-variable">Track_genes_sig</span>,], <span class="cm-variable">color_cells_by</span><span class="cm-operator">=</span><span class="cm-string">"predicted.id"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">min_expr</span><span class="cm-operator">=</span><span class="cm-number">0.5</span>, <span class="cm-variable">ncol</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#FeaturePlotå›¾</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot_cells</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">genes</span><span class="cm-operator">=</span><span class="cm-variable">Track_genes_sig</span>, <span class="cm-variable">show_trajectory_graph</span><span class="cm-operator">=</span><span class="cm-variable">FALSE</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">label_cell_groups</span><span class="cm-operator">=</span><span class="cm-variable">FALSE</span>, &nbsp;<span class="cm-variable">label_leaves</span><span class="cm-operator">=</span><span class="cm-variable">FALSE</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##å¯»æ‰¾å…±è¡¨è¾¾æ¨¡å—</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">genelist</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">pull</span>(<span class="cm-variable">Track_genes</span>, <span class="cm-variable">gene_short_name</span>) <span class="cm-operator cm-variable-2">%&gt;%</span> <span class="cm-variable">as.character</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gene_module</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">find_gene_modules</span>(<span class="cm-variable">cds</span>[<span class="cm-variable">genelist</span>,], <span class="cm-variable">resolution</span><span class="cm-operator">=</span><span class="cm-number">1</span><span class="cm-variable">e2</span>, <span class="cm-variable">cores</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cell_group</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">tibble</span><span class="cm-operator">::</span><span class="cm-variable">tibble</span>(<span class="cm-variable">cell</span><span class="cm-operator">=</span><span class="cm-variable">row.names</span>(<span class="cm-variable">colData</span>(<span class="cm-variable">cds</span>)), </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cell_group</span><span class="cm-operator">=</span><span class="cm-variable">colData</span>(<span class="cm-variable">cds</span>)<span class="cm-operator cm-dollar">$</span><span class="cm-variable">predicted.id</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">agg_mat</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">aggregate_gene_expression</span>(<span class="cm-variable">cds</span>, <span class="cm-variable">gene_module</span>, <span class="cm-variable">cell_group</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">row.names</span>(<span class="cm-variable">agg_mat</span>) <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">stringr</span><span class="cm-operator">::</span><span class="cm-variable">str_c</span>(<span class="cm-string">"Module "</span>, <span class="cm-variable">row.names</span>(<span class="cm-variable">agg_mat</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pheatmap</span><span class="cm-operator">::</span><span class="cm-variable">pheatmap</span>(<span class="cm-variable">agg_mat</span>, <span class="cm-variable">scale</span><span class="cm-operator">=</span><span class="cm-string">"column"</span>, <span class="cm-variable">clustering_method</span><span class="cm-operator">=</span><span class="cm-string">"ward.D2"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 462px;"></div><div class="CodeMirror-gutters" style="display: none; height: 462px;"></div></div></div></pre><h4 id='åŸºå› é›†åˆ†æ'><span>åŸºå› é›†åˆ†æ</span></h4><h5 id='è¡¨è§‚é—ä¼ åˆ†æ'><span>è¡¨è§‚é—ä¼ åˆ†æ</span></h5><h5 id='å¯Œé›†åˆ†æ'><span>å¯Œé›†åˆ†æ</span></h5><h4 id='åŸºå› è°ƒæ§ç½‘ç»œåˆ†æ'><span>åŸºå› è°ƒæ§ç½‘ç»œåˆ†æ</span></h4><h5 id='åŸºå› å…±è¡¨è¾¾'><span>åŸºå› å…±è¡¨è¾¾</span></h5><h5 id='è›‹ç™½è´¨äº’ä½œç½‘ç»œ'><span>è›‹ç™½è´¨äº’ä½œç½‘ç»œ</span></h5><h5 id='å›å½’æ¨¡å‹'><span>å›å½’æ¨¡å‹</span></h5><p>&nbsp;</p></div></div>
</body>
</html>